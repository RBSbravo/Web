import{u as be,r as p,j as r,B as f,b as m,Z as ee,s as re,K as te,n as ne,aa as ye,k as je,ap as ve,q as oe,I as se,P as ae,J as ie,av as Ce,z as C,v as q,w as V,y as G,a6 as Se,p as Ae,aQ as _e,h as Q,az as Le,ar as Fe,x as Te}from"./mui-DmyK1VYO.js";const ke=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(n){return console.error("Error formatting date:",n),"N/A"}},Pe=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(n){return console.error("Error formatting date time:",n),"N/A"}},Re=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"warning";case"in_progress":case"in progress":return"primary";case"completed":case"resolved":return"success";case"declined":case"cancelled":return"error";default:return"default"}},ze=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"Schedule";case"in_progress":case"in progress":return"Schedule";case"completed":case"resolved":return"CheckCircle";case"declined":case"cancelled":return"Error";default:return"ConfirmationNumber"}},Ne=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"error";case"medium":case"normal":return"warning";case"low":return"success";default:return"default"}},$e=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"PriorityHigh";case"medium":case"normal":return"Remove";case"low":return"LowPriority";default:return"Remove"}},Me=e=>{const n=new Date,a=new Date(e.created_at||e.createdAt),i=e.due_date?new Date(e.due_date):null,l=(e.status||"").toLowerCase();if(l==="completed"||l==="resolved"||l==="declined"||l==="cancelled")return null;if(i&&i<n)return"error";if(l==="in_progress"||l==="in progress"){const s=(n-a)/36e5;return s<=72?"success":s<=144?"warning":"error"}if((l==="pending"||l==="open")&&i){const s=(i-n)/36e5;if(s<0)return"error";if(s<=24)return"error";if(s<=72)return"warning"}return null},Be=e=>{const n=new Date,a=new Date(e.created_at||e.createdAt),i=e.due_date?new Date(e.due_date):null,l=(e.status||"").toLowerCase();if(l==="completed"||l==="resolved"||l==="declined"||l==="cancelled")return null;if(i&&i<n){const s=Math.floor((n-i)/864e5);return`Overdue by ${s} day${s!==1?"s":""}`}if(l==="in_progress"||l==="in progress"){const s=(n-a)/36e5;return s<=72?"Fresh":s<=144?"Aging":"Stale"}if((l==="pending"||l==="open")&&i){const s=(i-n)/36e5;if(s<0){const g=Math.floor(Math.abs(s)/24);return`Overdue by ${g} day${g!==1?"s":""}`}else{if(s<=24)return"Due Soon";if(s<=72)return"Due in 3 days"}}return null},Ee=(e,n,a,i,l,s,g,S)=>{const A=Array.isArray(e)?e:[],R=Array.isArray(n)?n:[],_=Array.isArray(a)?a:[],F=A.filter(u=>u.ticketCreator?.id===S||u.created_by===S||u.createdBy===S||u.original_creator_id===S);let U;switch(g){case 0:U=F;break;case 1:U=R;break;case 2:{const u=A.filter(x=>{const j=x.forwarded_from_id||x.forwardedFromId||x.forwardedFrom?.id,N=x.is_forwarded===!0||x.isForwarded===!0||typeof x.forward_chain_id<"u"||typeof x.forwardChainId<"u",$=j&&S&&String(j)===String(S);return N&&$}),D=[..._,...u],k=new Set;U=D.filter(x=>!x||!x.id||k.has(x.id)?!1:(k.add(x.id),!0));break}default:U=F}return U.filter(u=>{const D=!i||u.title?.toLowerCase().includes(i.toLowerCase())||u.description?.toLowerCase().includes(i.toLowerCase())||u.id?.toString().includes(i)||(u.ticketCreator?`${u.ticketCreator.firstname} ${u.ticketCreator.lastname}`:"").toLowerCase().includes(i.toLowerCase())||(u.ticketAssignee?`${u.ticketAssignee.firstname} ${u.ticketAssignee.lastname}`:"").toLowerCase().includes(i.toLowerCase()),k=l==="all"||(u.status||"").toLowerCase()===l.toLowerCase(),x=s==="all"||(u.priority||"").toLowerCase()===s.toLowerCase();return D&&k&&x})},Oe=e=>{let n="";if(e.due_date)try{const a=new Date(e.due_date);isNaN(a.getTime())||(n=a.toISOString().split("T")[0])}catch(a){console.error("Error formatting date:",a)}return{id:e.id,title:e.title||"",description:e.description||"",priority:e.priority?e.priority.charAt(0).toUpperCase()+e.priority.slice(1):"Medium",status:e.status||"pending",due_date:n,departmentId:e.departmentId||e.department_id||"",sendTo:e.assignedTo||e.assigned_to||"",createdBy:e.createdBy||e.created_by||"",desired_action:e.desired_action||"",remarks:e.remarks||""}},Ie=(e,n,a)=>{const i={title:e.title?.trim(),description:e.description?.trim(),priority:(e.priority||"Medium").toLowerCase(),status:e.status||"pending",desired_action:e.desired_action?.trim()};return e.id&&(i.id=e.id),e.due_date&&(i.due_date=e.due_date),e.remarks&&(i.remarks=e.remarks),e.departmentId?i.department_id=e.departmentId:a?.departmentId&&(i.department_id=a.departmentId),e.sendTo&&(i.assigned_to=e.sendTo),i},We=(e,n=!1)=>{const a=[];return e.title?.trim()||a.push("Ticket title is required."),e.description?.trim()||a.push("Ticket description is required."),e.priority||a.push("Please select a priority level."),e.desired_action?.trim()||a.push("Desired action is required."),e.sendTo||a.push("Please select who to send the ticket to."),n&&!e.id&&a.push("Ticket ID is required for updates."),n&&!e.remarks?.trim()&&a.push("Remarks are required when updating a ticket. Please provide remarks explaining the changes made."),a},He=(e,n)=>({id:`temp-${Date.now()}-${Math.random()}`,name:e.name,size:e.size,type:e.type,file:e,uploadedAt:new Date().toISOString(),uploadedBy:n.firstname+" "+n.lastname}),qe=e=>{if(e&&e.file){const n=URL.createObjectURL(e.file),a=document.createElement("a");a.href=n,a.download=e.name,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}},Ve=e=>{if(e===0)return"0 Bytes";const n=1024,a=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(2))+" "+a[i]},Ge=e=>e?typeof e=="string"?e:`${e.firstname||e.firstName||""} ${e.lastname||e.lastName||""}`.trim()||e.email||e.username||"Unknown User":"Unknown User",Je=({entityId:e,fetchComments:n,addComment:a,deleteComment:i,user:l})=>{const s=be(),[g,S]=p.useState([]),[A,R]=p.useState(!0),[_,F]=p.useState(""),[U,u]=p.useState(!1),[D,k]=p.useState(null),[x,j]=p.useState(!1),[N,$]=p.useState(""),M=t=>l?t.author_id===l.id||t.authorId===l.id||t.userId===l.id||t.author&&t.author.id===l.id||t.commentUser&&t.commentUser.id===l.id:!1,B=t=>l?t.author_id===l.id||t.authorId===l.id||t.userId===l.id||t.author&&t.author.id===l.id||t.commentUser&&t.commentUser.id===l.id:!1,L=async()=>{R(!0);try{const t=await n(e),y=t.data||t||[];S(y)}catch(t){console.error("Error loading comments:",t),S([])}finally{R(!1)}};p.useEffect(()=>{e&&L()},[e]);const O=async t=>{if(t.preventDefault(),!!_.trim()){u(!0),$("");try{console.log("Submitting comment:",{entityId:e,content:_}),await a(e,{content:_}),F(""),L()}catch(y){let P="Failed to add comment.";y.response&&y.response.data&&(y.response.data.error?P=y.response.data.error:y.response.data.errors&&Array.isArray(y.response.data.errors)?P=y.response.data.errors.map(T=>T.msg||T.error||JSON.stringify(T)).join(`
`):P=JSON.stringify(y.response.data)),$(P)}finally{u(!1)}}},J=t=>{k(t),j(!0)},E=async()=>{if(D)try{await i(D),j(!1),k(null),L()}catch{}};return r.jsxs(f,{sx:{mt:3},children:[r.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Comments"}),A?r.jsx(ee,{size:24}):r.jsxs(re,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2},children:[g.length===0&&r.jsx(m,{variant:"body2",color:"text.secondary",children:"No comments yet."}),g.map(t=>r.jsxs(te.Fragment,{children:[r.jsxs(ne,{alignItems:"flex-start",sx:{px:2,py:1.5,bgcolor:M(t)?"primary.light10":"transparent",border:M(t)?`1px solid ${s.palette.primary.light}`:"none",borderRadius:M(t)?1:0,"&:hover":{bgcolor:M(t)?"primary.light15":"action.hover"}},secondaryAction:B(t)&&r.jsx(se,{edge:"end","aria-label":"delete comment",onClick:()=>J(t.id),size:"small",sx:{color:s.palette.error.main,"&:hover":{backgroundColor:s.palette.error.light+"20",color:s.palette.error.dark},transition:"all 0.2s ease-in-out"},children:r.jsx(ae,{fontSize:"small"})}),children:[r.jsx(ye,{children:r.jsx(je,{children:r.jsx(ve,{})})}),r.jsx(oe,{primary:r.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[r.jsx(m,{sx:{fontWeight:500},component:"span",children:typeof t.commentUser=="object"?t.commentUser.firstname&&t.commentUser.lastname?`${t.commentUser.firstname} ${t.commentUser.lastname}`:t.commentUser.firstName&&t.commentUser.lastName?`${t.commentUser.firstName} ${t.commentUser.lastName}`:t.commentUser.username||t.commentUser.email||t.commentUser.id:t.commentUser}),r.jsx(m,{variant:"caption",color:"text.disabled",component:"span",children:new Date(t.createdAt).toLocaleString()})]}),secondary:r.jsx(m,{variant:"body2",color:"text.secondary",component:"span",sx:{lineHeight:1.5,fontSize:"0.875rem"},children:t.content&&t.content.startsWith("üìù **Task Updated**")?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Task Updated"}),r.jsxs(f,{sx:{color:s.palette.info.main,backgroundColor:s.palette.info.light,padding:"4px 8px",borderRadius:"4px",borderLeft:`4px solid ${s.palette.info.main}`,display:"inline-block"},children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:"Remarks:"}),r.jsx(m,{variant:"body2",children:t.content.replace("üìù **Task Updated**","").replace(/^\n+/,"").replace(/^Remarks:\n?/,"")})]})]}):t.comment_type==="update"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Updated"}),r.jsxs(f,{sx:{color:s.palette.info.main,backgroundColor:s.palette.info.light,padding:"4px 8px",borderRadius:"4px",borderLeft:`4px solid ${s.palette.info.main}`,display:"inline-block"},children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:.5},children:"Remarks:"}),r.jsx(m,{variant:"body2",children:t.content.split(`
`).slice(2).join(`
`).replace(`Remarks:
`,"")})]})]}):t.comment_type==="forward"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Forwarded"}),r.jsxs(f,{sx:{color:s.palette.info.main,backgroundColor:s.palette.info.light,padding:"4px 8px",borderRadius:"4px",borderLeft:`4px solid ${s.palette.info.main}`,display:"inline-block",mb:1},children:[r.jsxs(m,{variant:"body2",sx:{mb:.5},children:[r.jsx("strong",{children:"To:"})," ",t.content.split(`
`)[2]?.replace("To: ","")]}),r.jsxs(m,{variant:"body2",children:[r.jsx("strong",{children:"Reason:"})," ",t.content.split(`
`)[3]?.replace("Reason: ","")]})]})]}):t.comment_type==="response"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Forward Response"}),r.jsxs(m,{variant:"body2",sx:{mb:.5},children:["Action: ",t.content.split(`
`)[2]?.replace("Action: ","")]}),t.content.split(`
`)[3]&&r.jsx(m,{variant:"body2",sx:{mb:1},children:t.content.split(`
`)[3]})]}):t.content})})]}),r.jsx(ie,{variant:"inset",component:"li"})]},t.id))]}),r.jsxs(f,{component:"form",onSubmit:O,sx:{display:"flex",gap:1,mt:1},children:[r.jsx(Ce,{size:"small",fullWidth:!0,placeholder:"Add a comment...",value:_,onChange:t=>F(t.target.value),disabled:U}),r.jsx(C,{type:"submit",variant:"contained",disabled:U||!_.trim(),children:"Post"})]}),N&&r.jsx(m,{color:"error",variant:"body2",sx:{mb:1},children:N}),r.jsxs(q,{open:x,onClose:()=>j(!1),children:[r.jsx(V,{sx:{pb:1},children:"Delete this comment?"}),r.jsxs(G,{sx:{px:3,pb:2},children:[r.jsx(C,{onClick:()=>j(!1),variant:"outlined",sx:{borderColor:s.palette.divider,color:"text.secondary","&:hover":{borderColor:s.palette.action.hover,backgroundColor:s.palette.action.hover}},children:"Cancel"}),r.jsx(C,{color:"error",variant:"contained",onClick:E,sx:{backgroundColor:"error.main","&:hover":{backgroundColor:"error.dark"},boxShadow:"0 2px 4px rgba(244, 67, 54, 0.3)","&:active":{boxShadow:"0 1px 2px rgba(244, 67, 54, 0.3)"}},children:"Delete"})]})]})]})},le=e=>{if(e===0)return"0 Bytes";const n=1024,a=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(2))+" "+a[i]},Ue=(e,n={})=>{const{maxFileSize:a=10*1024*1024,acceptedTypes:i=["*/*"],maxFiles:l=5,currentFileCount:s=0}=n,g=[];return s>=l&&g.push(`Maximum ${l} files allowed`),e.size>a&&g.push(`File size must be less than ${le(a)}`),i.length>0&&i[0]!=="*/*"&&(i.some(A=>A.endsWith("/*")?e.type.startsWith(A.replace("/*","")):e.type===A)||g.push(`File type not supported. Allowed: ${i.join(", ")}`)),{isValid:g.length===0,errors:g}},Ke=({entityId:e,fetchFiles:n,uploadFile:a,deleteFile:i,maxFiles:l=5,maxFileSize:s=10*1024*1024,acceptedTypes:g=["*/*"],disabled:S=!1,readOnly:A=!1,entityType:R="general"})=>{const[_,F]=p.useState([]),[U,u]=p.useState(!0),[D,k]=p.useState(!1),[x,j]=p.useState(""),[N,$]=p.useState(null),[M,B]=p.useState(!1),[L,O]=p.useState(null),[J,E]=p.useState(!1),[t,y]=p.useState(!1),[P,T]=p.useState("image"),[z,K]=p.useState(""),[X,I]=p.useState(""),[de,W]=p.useState(""),[ce,Y]=p.useState(!1),H=p.useCallback(async()=>{u(!0);try{const o=await n(e),d=o.data||o||[];if(!Array.isArray(d)){console.warn("Files data is not an array:",d),F([]);return}F(d.map(c=>({...c,name:c.name||c.file_name,file_name:c.file_name||c.name,file_size:c.file_size||c.size,url:c.url||`/api/files/${c.id}/download`,uploadedAt:c.uploadedAt||c.createdAt||c.created_at})))}catch(o){console.error("Error loading files:",o),F([])}finally{u(!1)}},[n,e]);p.useEffect(()=>{e?H():(u(!1),F([]))},[e]);const me=p.useCallback(async o=>{j("");const d=o.target.files[0];if(!d)return;let c=g;R==="task"&&g[0]==="*/*"&&(c=["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp"]);const v=Ue(d,{maxFileSize:s,acceptedTypes:c,maxFiles:l,currentFileCount:_.length});if(!v.isValid){j(v.errors.join(", "));return}k(!0);try{await a(e,d),e?await H():setTimeout(()=>{n&&n(e).then(w=>{const h=w.data||w||[];Array.isArray(h)&&F(h.map(b=>({...b,name:b.name||b.file_name,file_name:b.file_name||b.name,file_size:b.file_size||b.size,url:b.url||`/api/files/${b.id}/download`,uploadedAt:b.uploadedAt||b.createdAt||b.created_at})))}).catch(()=>{})},100)}catch(w){let h="Failed to upload file";w.message.includes("Network Error")||w.message.includes("Cannot connect")?h="Cannot connect to server. Please check if the backend is running.":w.response?.status===413?h="File is too large. Maximum size is 10MB.":w.response?.status===400?h=w.response?.data?.error||"Invalid file or request.":w.response?.status===401?h="Authentication required. Please log in again.":w.response?.status===404?h="Ticket not found. The ticket may have been deleted.":w.response?.data?.error?h=w.response.data.error:w.message&&(h=w.message),j(h)}finally{k(!1)}},[_.length,l,s,g,a,e,H,n]),ue=o=>{$(o),B(!0)},pe=async()=>{if(N)try{await i(e,N),B(!1),$(null),e&&await H()}catch(o){console.error("Error deleting file:",o),j("Failed to delete file")}},he=o=>{const d=o.uploadedAt||o.createdAt||o.created_at;if(!d)return"‚Äî";const c=new Date(d);return isNaN(c.getTime())?"‚Äî":c.toLocaleString()},fe=async o=>{const d=localStorage.getItem("token");try{const c=await fetch(o.url,{headers:{Authorization:`Bearer ${d}`}});if(!c.ok){alert("Failed to download file");return}const v=await c.blob();if(v.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");const w=window.URL.createObjectURL(v),h=document.createElement("a");h.href=w,h.download=o.name,document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(w)}catch{alert("Failed to download file")}},xe=o=>{O(o),E(!0)},ge=async()=>{if(L)try{if(e)await fe(L);else if(L.file){const o=URL.createObjectURL(L.file),d=document.createElement("a");d.href=o,d.download=L.name,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(o)}}catch(o){console.error("Error downloading file:",o),j("Failed to download file")}E(!1),O(null)},we=async o=>{try{let d,c;if(e){const b=`http://localhost:3000/api/files/${o.id}/download`,Z=await fetch(b,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!Z.ok)throw new Error(`HTTP error! status: ${Z.status}`);if(d=await Z.blob(),d.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");c=URL.createObjectURL(d)}else if(o.file)d=o.file,c=URL.createObjectURL(o.file);else throw new Error("File object not available for preview");let v=d.type;const h=(o.file_name||o.name||"").split(".").pop().toLowerCase();if((!v||v==="application/octet-stream")&&(["jpg","jpeg","png","gif","bmp","webp"].includes(h)?v="image/"+h:h==="pdf"?v="application/pdf":["txt","csv","json","md","log"].includes(h)&&(v="text/plain")),K(c),I(""),W(""),v.startsWith("image/"))T("image");else if(v==="application/pdf")T("pdf");else if(v.startsWith("text/")||["txt","csv","json","md","log"].includes(h)){const b=await d.text();I(b),T("text")}else T("unsupported");y(!0)}catch(d){console.error("Error viewing file:",d),W(d.message),T("error"),y(!0)}};return r.jsxs(f,{sx:{mt:3},children:[x&&r.jsx(Se,{severity:"error",sx:{mb:2},onClose:()=>j(""),children:x}),r.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Attachments"}),U?r.jsx(ee,{size:24}):r.jsxs(re,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2,scrollbarWidth:"none",msOverflowStyle:"none","&::-webkit-scrollbar":{display:"none"}},children:[_.length===0&&r.jsx(m,{variant:"body2",color:"text.secondary",children:"No attachments yet."}),_.map(o=>{const d=o.file_name||o.name||"Unknown File";return r.jsxs(te.Fragment,{children:[r.jsxs(ne,{secondaryAction:!A&&r.jsx(Q,{title:"Delete file",arrow:!0,children:r.jsx(se,{edge:"end",onClick:()=>ue(o.id),color:"error",size:"small",sx:{"&:hover":{backgroundColor:"error.light",color:"error.contrastText"}},children:r.jsx(ae,{fontSize:"small"})})}),children:[r.jsx(Ae,{children:r.jsx(_e,{})}),r.jsx(oe,{primary:r.jsx(Q,{title:"Click to download or view file",arrow:!0,children:r.jsx(m,{component:"span",sx:{cursor:"pointer",color:"primary.main",textDecoration:"underline","&:hover":{textDecoration:"none"}},onClick:()=>xe(o),children:d})}),secondary:r.jsxs(m,{variant:"caption",color:"text.disabled",children:[he(o)," ‚Ä¢ ",le(o.file_size||o.size||0)]})})]}),r.jsx(ie,{variant:"inset",component:"li"})]},o.id)})]}),!A&&r.jsxs(C,{variant:"outlined",component:"label",startIcon:r.jsx(Le,{}),disabled:S||D,sx:{mt:1},children:[D?"Uploading...":R==="task"?"Upload File (PDF & Images Only)":"Upload File",r.jsx("input",{type:"file",hidden:!0,onChange:me,accept:R==="task"?".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp,application/pdf,image/*":g.join(","),disabled:S||D})]}),!A&&R==="task"&&r.jsx(f,{sx:{mt:1,fontSize:"0.75rem",color:"text.secondary"},children:"Allowed file types: PDF, JPG, PNG, GIF, WebP, BMP (Max 10MB each)"}),r.jsxs(q,{open:M,onClose:()=>B(!1),children:[r.jsx(V,{children:"Delete this file?"}),r.jsxs(G,{children:[r.jsx(C,{onClick:()=>B(!1),children:"Cancel"}),r.jsx(C,{color:"error",variant:"contained",onClick:pe,children:"Delete"})]})]}),r.jsxs(q,{open:J,onClose:()=>E(!1),children:[r.jsx(V,{children:"Download this file?"}),r.jsxs(G,{children:[r.jsx(C,{onClick:()=>E(!1),children:"Cancel"}),r.jsx(C,{startIcon:r.jsx(Fe,{}),onClick:()=>we(L),disabled:!L,children:"View"}),r.jsx(C,{variant:"contained",onClick:ge,disabled:!L,children:"Download"})]})]}),r.jsxs(q,{open:t,onClose:()=>{y(!1),K(null),T(null),I(""),W(""),Y(!1)},maxWidth:"md",fullWidth:!0,children:[r.jsx(V,{children:"File Preview"}),r.jsxs(Te,{sx:{minHeight:400,display:"flex",alignItems:"center",justifyContent:"center"},children:[P==="image"&&z&&r.jsx("img",{src:z,alt:"Preview",style:{maxWidth:"100%",maxHeight:500,display:"block",margin:"0 auto"}}),P==="pdf"&&z&&r.jsxs(f,{sx:{width:"100%",height:500,display:"flex",flexDirection:"column"},children:[r.jsxs(f,{sx:{mb:2,display:"flex",gap:1},children:[r.jsx(C,{variant:"outlined",size:"small",onClick:()=>window.open(z,"_blank"),children:"Open in New Tab"}),r.jsx(C,{variant:"outlined",size:"small",onClick:()=>{const o=document.createElement("a");o.href=z,o.download="document.pdf",o.click()},children:"Download"})]}),ce?r.jsx(f,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${theme.palette.divider}`,borderRadius:1},children:r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"PDF Preview Unavailable"}),r.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The PDF could not be displayed in the preview. Please use the buttons above to view or download the file."})]})}):r.jsx(f,{sx:{flex:1,border:`1px solid ${theme.palette.divider}`,borderRadius:1,overflow:"hidden"},children:r.jsx("iframe",{src:`${z}#toolbar=1&navpanes=1&scrollbar=1`,title:"PDF Preview",width:"100%",height:"100%",style:{border:0},onError:()=>{Y(!0)},onLoad:()=>{Y(!1)}})})]}),P==="text"&&X&&r.jsx(f,{sx:{width:"100%",maxHeight:500,overflow:"auto",bgcolor:"background.default",p:2,borderRadius:2},children:r.jsx("pre",{style:{margin:0,fontFamily:"monospace",fontSize:14},children:X})}),P==="unsupported"&&r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Preview not available for this file type"}),r.jsx(C,{variant:"contained",onClick:()=>{const o=document.createElement("a");o.href=z,o.download="file",o.click()},children:"Download File"})]}),P==="error"&&r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsxs(m,{color:"error",gutterBottom:!0,children:["Error loading file: ",de]}),r.jsx(C,{variant:"outlined",onClick:()=>window.open(z,"_blank"),children:"Try Opening in New Tab"})]})]}),r.jsx(G,{children:r.jsx(C,{onClick:()=>{y(!1),K(null),T(null),I(""),W("")},children:"Close"})})]})]})};export{Je as C,Ke as F,Be as a,Ge as b,Ve as c,Pe as d,Ee as e,ke as f,Me as g,He as h,qe as i,Oe as j,$e as k,Ne as l,ze as m,Re as n,Ie as p,We as v};
