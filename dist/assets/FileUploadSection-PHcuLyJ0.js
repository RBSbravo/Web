import{u as re,r as u,j as r,B as f,b as m,Z as te,s as ne,K as oe,n as se,aa as je,k as ve,ap as Ce,q as ae,I as ie,P as le,J as de,av as Se,z as v,v as q,w as V,y as G,a6 as _e,p as Ae,aQ as Le,h as ee,az as Te,ar as Ue,x as Fe}from"./mui-BvrjgOXm.js";const Pe=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(n){return console.error("Error formatting date:",n),"N/A"}},Re=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(n){return console.error("Error formatting date time:",n),"N/A"}},ze=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"warning";case"in_progress":case"in progress":return"primary";case"completed":case"resolved":return"success";case"declined":case"cancelled":return"error";default:return"default"}},Ne=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"Schedule";case"in_progress":case"in progress":return"Schedule";case"completed":case"resolved":return"CheckCircle";case"declined":case"cancelled":return"Error";default:return"ConfirmationNumber"}},Me=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"error";case"medium":case"normal":return"warning";case"low":return"success";default:return"default"}},$e=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"PriorityHigh";case"medium":case"normal":return"Remove";case"low":return"LowPriority";default:return"Remove"}},Be=e=>{const n=new Date,s=new Date(e.created_at||e.createdAt),a=e.due_date?new Date(e.due_date):null,l=(e.status||"").toLowerCase();if(l==="completed"||l==="resolved"||l==="declined"||l==="cancelled")return null;if(a&&a<n)return"error";if(l==="in_progress"||l==="in progress"){const i=(n-s)/36e5;return i<=72?"success":i<=144?"warning":"error"}if((l==="pending"||l==="open")&&a){const i=(a-n)/36e5;if(i<0)return"error";if(i<=24)return"error";if(i<=72)return"warning"}return null},Ee=e=>{const n=new Date,s=new Date(e.created_at||e.createdAt),a=e.due_date?new Date(e.due_date):null,l=(e.status||"").toLowerCase();if(l==="completed"||l==="resolved"||l==="declined"||l==="cancelled")return null;if(a&&a<n){const i=Math.floor((n-a)/864e5);return`Overdue by ${i} day${i!==1?"s":""}`}if(l==="in_progress"||l==="in progress"){const i=(n-s)/36e5;return i<=72?"Fresh":i<=144?"Aging":"Stale"}if((l==="pending"||l==="open")&&a){const i=(a-n)/36e5;if(i<0){const g=Math.floor(Math.abs(i)/24);return`Overdue by ${g} day${g!==1?"s":""}`}else{if(i<=24)return"Due Soon";if(i<=72)return"Due in 3 days"}}return null},Oe=(e,n,s,a,l,i,g,C)=>{const S=Array.isArray(e)?e:[],P=Array.isArray(n)?n:[],T=Array.isArray(s)?s:[],U=S.filter(p=>p.ticketCreator?.id===C||p.created_by===C||p.createdBy===C||p.original_creator_id===C);let y;switch(g){case 0:y=U;break;case 1:y=P;break;case 2:{const p=S.filter(x=>{const k=x.forwarded_from_id||x.forwardedFromId||x.forwardedFrom?.id,L=x.is_forwarded===!0||x.isForwarded===!0||typeof x.forward_chain_id<"u"||typeof x.forwardChainId<"u",$=k&&C&&String(k)===String(C);return L&&$}),F=[...T,...p],A=new Set;y=F.filter(x=>!x||!x.id||A.has(x.id)?!1:(A.add(x.id),!0));break}default:y=U}return y.filter(p=>{const F=!a||p.title?.toLowerCase().includes(a.toLowerCase())||p.description?.toLowerCase().includes(a.toLowerCase())||p.id?.toString().includes(a)||(p.ticketCreator?`${p.ticketCreator.firstname} ${p.ticketCreator.lastname}`:"").toLowerCase().includes(a.toLowerCase())||(p.ticketAssignee?`${p.ticketAssignee.firstname} ${p.ticketAssignee.lastname}`:"").toLowerCase().includes(a.toLowerCase()),A=l==="all"||(p.status||"").toLowerCase()===l.toLowerCase(),x=i==="all"||(p.priority||"").toLowerCase()===i.toLowerCase();return F&&A&&x})},Ie=e=>{let n="";if(e.due_date)try{const s=new Date(e.due_date);isNaN(s.getTime())||(n=s.toISOString().split("T")[0])}catch(s){console.error("Error formatting date:",s)}return{id:e.id,title:e.title||"",description:e.description||"",priority:e.priority?e.priority.charAt(0).toUpperCase()+e.priority.slice(1):"Medium",status:e.status||"pending",due_date:n,departmentId:e.departmentId||e.department_id||"",sendTo:e.assignedTo||e.assigned_to||"",createdBy:e.createdBy||e.created_by||"",desired_action:e.desired_action||"",remarks:e.remarks||""}},We=(e,n,s)=>{const a={title:e.title?.trim(),description:e.description?.trim(),priority:(e.priority||"Medium").toLowerCase(),status:e.status||"pending",desired_action:e.desired_action?.trim()};return e.id&&(a.id=e.id),e.due_date&&(a.due_date=e.due_date),e.remarks&&(a.remarks=e.remarks),e.departmentId?a.department_id=e.departmentId:s?.departmentId&&(a.department_id=s.departmentId),e.sendTo&&(a.assigned_to=e.sendTo),a},He=(e,n=!1)=>{const s=[];return e.title?.trim()||s.push("Ticket title is required."),e.description?.trim()||s.push("Ticket description is required."),e.priority||s.push("Please select a priority level."),e.desired_action?.trim()||s.push("Desired action is required."),e.sendTo||s.push("Please select who to send the ticket to."),n&&!e.id&&s.push("Ticket ID is required for updates."),n&&!e.remarks?.trim()&&s.push("Remarks are required when updating a ticket. Please provide remarks explaining the changes made."),s},qe=(e,n)=>({id:`temp-${Date.now()}-${Math.random()}`,name:e.name,size:e.size,type:e.type,file:e,uploadedAt:new Date().toISOString(),uploadedBy:n.firstname+" "+n.lastname}),Ve=e=>{if(e&&e.file){const n=URL.createObjectURL(e.file),s=document.createElement("a");s.href=n,s.download=e.name,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}},Ge=e=>{if(e===0)return"0 Bytes";const n=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,a)).toFixed(2))+" "+s[a]},Je=e=>e?typeof e=="string"?e:`${e.firstname||e.firstName||""} ${e.lastname||e.lastName||""}`.trim()||e.email||e.username||"Unknown User":"Unknown User",Ke=({entityId:e,fetchComments:n,addComment:s,deleteComment:a,user:l})=>{const i=re(),[g,C]=u.useState([]),[S,P]=u.useState(!0),[T,U]=u.useState(""),[y,p]=u.useState(!1),[F,A]=u.useState(null),[x,k]=u.useState(!1),[L,$]=u.useState(""),B=t=>l?t.author_id===l.id||t.authorId===l.id||t.userId===l.id||t.author&&t.author.id===l.id||t.commentUser&&t.commentUser.id===l.id:!1,J=t=>!l||t.comment_type==="update"||t.content&&t.content.startsWith("üìù **Task Updated**")?!1:t.author_id===l.id||t.authorId===l.id||t.userId===l.id||t.author&&t.author.id===l.id||t.commentUser&&t.commentUser.id===l.id,N=async()=>{P(!0);try{const t=await n(e),_=t.data||t||[];C(_)}catch(t){console.error("Error loading comments:",t),C([])}finally{P(!1)}};u.useEffect(()=>{e&&N()},[e]);const D=async t=>{if(t.preventDefault(),!!T.trim()){p(!0),$("");try{console.log("Submitting comment:",{entityId:e,content:T}),await s(e,{content:T}),U(""),N()}catch(_){let R="Failed to add comment.";_.response&&_.response.data&&(_.response.data.error?R=_.response.data.error:_.response.data.errors&&Array.isArray(_.response.data.errors)?R=_.response.data.errors.map(z=>z.msg||z.error||JSON.stringify(z)).join(`
`):R=JSON.stringify(_.response.data)),$(R)}finally{p(!1)}}},O=t=>{A(t),k(!0)},K=async()=>{if(F)try{await a(F),k(!1),A(null),N()}catch{}};return r.jsxs(f,{sx:{mt:3},children:[r.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Comments"}),S?r.jsx(te,{size:24}):r.jsxs(ne,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2},children:[g.length===0&&r.jsx(m,{variant:"body2",color:"text.secondary",children:"No comments yet."}),g.map(t=>r.jsxs(oe.Fragment,{children:[r.jsxs(se,{alignItems:"flex-start",sx:{px:2,py:1.5,bgcolor:B(t)?"primary.light10":"transparent",border:B(t)?`1px solid ${i.palette.primary.light}`:"none",borderRadius:B(t)?1:0,"&:hover":{bgcolor:B(t)?"primary.light15":"action.hover"}},secondaryAction:J(t)&&r.jsx(ie,{edge:"end","aria-label":"delete comment",onClick:()=>O(t.id),size:"small",sx:{color:i.palette.error.main,"&:hover":{backgroundColor:i.palette.error.light+"20",color:i.palette.error.dark},transition:"all 0.2s ease-in-out"},children:r.jsx(le,{fontSize:"small"})}),children:[r.jsx(je,{children:r.jsx(ve,{children:r.jsx(Ce,{})})}),r.jsx(ae,{primary:r.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[r.jsx(m,{sx:{fontWeight:500},component:"span",children:typeof t.commentUser=="object"?t.commentUser.firstname&&t.commentUser.lastname?`${t.commentUser.firstname} ${t.commentUser.lastname}`:t.commentUser.firstName&&t.commentUser.lastName?`${t.commentUser.firstName} ${t.commentUser.lastName}`:t.commentUser.username||t.commentUser.email||t.commentUser.id:t.commentUser}),r.jsx(m,{variant:"caption",color:"text.disabled",component:"span",children:new Date(t.createdAt).toLocaleString()})]}),secondary:r.jsx(m,{variant:"body2",color:"text.secondary",component:"span",sx:{lineHeight:1.5,fontSize:"0.875rem"},children:t.content&&t.content.startsWith("üìù **Task Updated**")?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Task Updated"}),r.jsxs(f,{sx:{color:i.palette.text.primary,backgroundColor:"#f5f5f5",padding:"8px 12px",borderRadius:"6px",borderLeft:"3px solid #e0e0e0",display:"inline-block",width:"100%"},children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"normal",mb:.5,color:i.palette.text.secondary},children:"Remarks:"}),r.jsx(m,{variant:"body2",sx:{fontWeight:"normal"},children:t.content.replace("üìù **Task Updated**","").replace(/^\n+/,"").replace(/^Remarks:\n?/,"")})]})]}):t.comment_type==="update"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Updated"}),r.jsxs(f,{sx:{color:i.palette.text.primary,backgroundColor:"#f5f5f5",padding:"8px 12px",borderRadius:"6px",borderLeft:"3px solid #e0e0e0",display:"inline-block",width:"100%"},children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"normal",mb:.5,color:i.palette.text.secondary},children:"Remarks:"}),r.jsx(m,{variant:"body2",sx:{fontWeight:"normal"},children:t.content.split(`
`).slice(2).join(`
`).replace(`Remarks:
`,"")})]})]}):t.comment_type==="forward"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Forwarded"}),r.jsxs(f,{sx:{color:i.palette.info.main,backgroundColor:i.palette.info.light,padding:"4px 8px",borderRadius:"4px",borderLeft:`4px solid ${i.palette.info.main}`,display:"inline-block",mb:1},children:[r.jsxs(m,{variant:"body2",sx:{mb:.5},children:[r.jsx("strong",{children:"To:"})," ",t.content.split(`
`)[2]?.replace("To: ","")]}),r.jsxs(m,{variant:"body2",children:[r.jsx("strong",{children:"Reason:"})," ",t.content.split(`
`)[3]?.replace("Reason: ","")]})]})]}):t.comment_type==="response"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Forward Response"}),r.jsxs(m,{variant:"body2",sx:{mb:.5},children:["Action: ",t.content.split(`
`)[2]?.replace("Action: ","")]}),t.content.split(`
`)[3]&&r.jsx(m,{variant:"body2",sx:{mb:1},children:t.content.split(`
`)[3]})]}):t.content})})]}),r.jsx(de,{variant:"inset",component:"li"})]},t.id))]}),r.jsxs(f,{component:"form",onSubmit:D,sx:{display:"flex",gap:1,mt:1},children:[r.jsx(Se,{size:"small",fullWidth:!0,placeholder:"Add a comment...",value:T,onChange:t=>U(t.target.value),disabled:y}),r.jsx(v,{type:"submit",variant:"contained",disabled:y||!T.trim(),children:"Post"})]}),L&&r.jsx(m,{color:"error",variant:"body2",sx:{mb:1},children:L}),r.jsxs(q,{open:x,onClose:()=>k(!1),children:[r.jsx(V,{sx:{pb:1},children:"Delete this comment?"}),r.jsxs(G,{sx:{px:3,pb:2},children:[r.jsx(v,{onClick:()=>k(!1),variant:"outlined",sx:{borderColor:i.palette.divider,color:"text.secondary","&:hover":{borderColor:i.palette.action.hover,backgroundColor:i.palette.action.hover}},children:"Cancel"}),r.jsx(v,{color:"error",variant:"contained",onClick:K,sx:{backgroundColor:"error.main","&:hover":{backgroundColor:"error.dark"},boxShadow:"0 2px 4px rgba(244, 67, 54, 0.3)","&:active":{boxShadow:"0 1px 2px rgba(244, 67, 54, 0.3)"}},children:"Delete"})]})]})]})},ce=e=>{if(e===0)return"0 Bytes";const n=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,a)).toFixed(2))+" "+s[a]},ke=(e,n={})=>{const{maxFileSize:s=10*1024*1024,acceptedTypes:a=["*/*"],maxFiles:l=5,currentFileCount:i=0}=n,g=[];return i>=l&&g.push(`Maximum ${l} files allowed`),e.size>s&&g.push(`File size must be less than ${ce(s)}`),a.length>0&&a[0]!=="*/*"&&(a.some(S=>S.endsWith("/*")?e.type.startsWith(S.replace("/*","")):e.type===S)||g.push(`File type not supported. Allowed: ${a.join(", ")}`)),{isValid:g.length===0,errors:g}},Ye=({entityId:e,fetchFiles:n,uploadFile:s,deleteFile:a,maxFiles:l=5,maxFileSize:i=10*1024*1024,acceptedTypes:g=["*/*"],disabled:C=!1,readOnly:S=!1,entityType:P="general"})=>{const T=re(),[U,y]=u.useState([]),[p,F]=u.useState(!0),[A,x]=u.useState(!1),[k,L]=u.useState(""),[$,B]=u.useState(null),[J,N]=u.useState(!1),[D,O]=u.useState(null),[K,t]=u.useState(!1),[_,R]=u.useState(!1),[z,E]=u.useState("image"),[M,Y]=u.useState(""),[Q,I]=u.useState(""),[me,W]=u.useState(""),[ue,Z]=u.useState(!1),H=u.useCallback(async()=>{F(!0);try{const o=await n(e),d=o.data||o||[];if(!Array.isArray(d)){console.warn("Files data is not an array:",d),y([]);return}y(d.map(c=>({...c,name:c.name||c.file_name,file_name:c.file_name||c.name,file_size:c.file_size||c.size,url:c.url||`/api/files/${c.id}/download`,uploadedAt:c.uploadedAt||c.createdAt||c.created_at})))}catch(o){console.error("Error loading files:",o),y([])}finally{F(!1)}},[n,e]);u.useEffect(()=>{e?H():(F(!1),y([]))},[e]);const pe=u.useCallback(async o=>{L("");const d=o.target.files[0];if(!d)return;let c=g;P==="task"&&g[0]==="*/*"&&(c=["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp"]);const j=ke(d,{maxFileSize:i,acceptedTypes:c,maxFiles:l,currentFileCount:U.length});if(!j.isValid){L(j.errors.join(", "));return}x(!0);try{await s(e,d),e?await H():setTimeout(()=>{n&&n(e).then(w=>{const h=w.data||w||[];Array.isArray(h)&&y(h.map(b=>({...b,name:b.name||b.file_name,file_name:b.file_name||b.name,file_size:b.file_size||b.size,url:b.url||`/api/files/${b.id}/download`,uploadedAt:b.uploadedAt||b.createdAt||b.created_at})))}).catch(()=>{})},100)}catch(w){let h="Failed to upload file";w.message.includes("Network Error")||w.message.includes("Cannot connect")?h="Cannot connect to server. Please check if the backend is running.":w.response?.status===413?h="File is too large. Maximum size is 10MB.":w.response?.status===400?h=w.response?.data?.error||"Invalid file or request.":w.response?.status===401?h="Authentication required. Please log in again.":w.response?.status===404?h="Ticket not found. The ticket may have been deleted.":w.response?.data?.error?h=w.response.data.error:w.message&&(h=w.message),L(h)}finally{x(!1)}},[U.length,l,i,g,s,e,H,n]),he=o=>{B(o),N(!0)},fe=async()=>{if($)try{await a(e,$),N(!1),B(null),e&&await H()}catch(o){console.error("Error deleting file:",o),L("Failed to delete file")}},xe=o=>{const d=o.uploadedAt||o.createdAt||o.created_at;if(!d)return"‚Äî";const c=new Date(d);return isNaN(c.getTime())?"‚Äî":c.toLocaleString()},ge=async o=>{const d=localStorage.getItem("token");try{const c=await fetch(o.url,{headers:{Authorization:`Bearer ${d}`}});if(!c.ok){alert("Failed to download file");return}const j=await c.blob();if(j.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");const w=window.URL.createObjectURL(j),h=document.createElement("a");h.href=w,h.download=o.name,document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(w)}catch{alert("Failed to download file")}},we=o=>{O(o),t(!0)},be=async()=>{if(D)try{if(e)await ge(D);else if(D.file){const o=URL.createObjectURL(D.file),d=document.createElement("a");d.href=o,d.download=D.name,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(o)}}catch(o){console.error("Error downloading file:",o),L("Failed to download file")}t(!1),O(null)},ye=async o=>{try{let d,c;if(e){const b=`https://backend-ticketing-system.up.railway.app/api/files/${o.id}/download`,X=await fetch(b,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!X.ok)throw new Error(`HTTP error! status: ${X.status}`);if(d=await X.blob(),d.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");c=URL.createObjectURL(d)}else if(o.file)d=o.file,c=URL.createObjectURL(o.file);else throw new Error("File object not available for preview");let j=d.type;const h=(o.file_name||o.name||"").split(".").pop().toLowerCase();if((!j||j==="application/octet-stream")&&(["jpg","jpeg","png","gif","bmp","webp"].includes(h)?j="image/"+h:h==="pdf"?j="application/pdf":["txt","csv","json","md","log"].includes(h)&&(j="text/plain")),Y(c),I(""),W(""),j.startsWith("image/"))E("image");else if(j==="application/pdf")E("pdf");else if(j.startsWith("text/")||["txt","csv","json","md","log"].includes(h)){const b=await d.text();I(b),E("text")}else E("unsupported");R(!0)}catch(d){console.error("Error viewing file:",d),W(d.message),E("error"),R(!0)}};return r.jsxs(f,{sx:{mt:3},children:[k&&r.jsx(_e,{severity:"error",sx:{mb:2},onClose:()=>L(""),children:k}),r.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Attachments"}),p?r.jsx(te,{size:24}):r.jsxs(ne,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2,scrollbarWidth:"none",msOverflowStyle:"none","&::-webkit-scrollbar":{display:"none"}},children:[U.length===0&&r.jsx(m,{variant:"body2",color:"text.secondary",children:"No attachments yet."}),U.map(o=>{const d=o.file_name||o.name||"Unknown File";return r.jsxs(oe.Fragment,{children:[r.jsxs(se,{secondaryAction:!S&&r.jsx(ee,{title:"Delete file",arrow:!0,children:r.jsx(ie,{edge:"end",onClick:()=>he(o.id),color:"error",size:"small",sx:{"&:hover":{backgroundColor:"error.light",color:"error.contrastText"}},children:r.jsx(le,{fontSize:"small"})})}),children:[r.jsx(Ae,{children:r.jsx(Le,{})}),r.jsx(ae,{primary:r.jsx(ee,{title:"Click to download or view file",arrow:!0,children:r.jsx(m,{component:"span",sx:{cursor:"pointer",color:"primary.main",textDecoration:"underline","&:hover":{textDecoration:"none"}},onClick:()=>we(o),children:d})}),secondary:r.jsxs(m,{variant:"caption",color:"text.disabled",children:[xe(o)," ‚Ä¢ ",ce(o.file_size||o.size||0)]})})]}),r.jsx(de,{variant:"inset",component:"li"})]},o.id)})]}),!S&&r.jsxs(v,{variant:"outlined",component:"label",startIcon:r.jsx(Te,{}),disabled:C||A,sx:{mt:1},children:[A?"Uploading...":P==="task"?"Upload File (PDF & Images Only)":"Upload File",r.jsx("input",{type:"file",hidden:!0,onChange:pe,accept:P==="task"?".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp,application/pdf,image/*":g.join(","),disabled:C||A})]}),!S&&P==="task"&&r.jsx(f,{sx:{mt:1,fontSize:"0.75rem",color:"text.secondary"},children:"Allowed file types: PDF, JPG, PNG, GIF, WebP, BMP (Max 10MB each)"}),r.jsxs(q,{open:J,onClose:()=>N(!1),children:[r.jsx(V,{children:"Delete this file?"}),r.jsxs(G,{children:[r.jsx(v,{onClick:()=>N(!1),children:"Cancel"}),r.jsx(v,{color:"error",variant:"contained",onClick:fe,children:"Delete"})]})]}),r.jsxs(q,{open:K,onClose:()=>t(!1),children:[r.jsx(V,{children:"Download this file?"}),r.jsxs(G,{children:[r.jsx(v,{onClick:()=>t(!1),children:"Cancel"}),r.jsx(v,{startIcon:r.jsx(Ue,{}),onClick:()=>ye(D),disabled:!D,children:"View"}),r.jsx(v,{variant:"contained",onClick:be,disabled:!D,children:"Download"})]})]}),r.jsxs(q,{open:_,onClose:()=>{R(!1),Y(null),E(null),I(""),W(""),Z(!1)},maxWidth:"md",fullWidth:!0,children:[r.jsx(V,{children:"File Preview"}),r.jsxs(Fe,{sx:{minHeight:400,display:"flex",alignItems:"center",justifyContent:"center"},children:[z==="image"&&M&&r.jsx("img",{src:M,alt:"Preview",style:{maxWidth:"100%",maxHeight:500,display:"block",margin:"0 auto"}}),z==="pdf"&&M&&r.jsxs(f,{sx:{width:"100%",height:500,display:"flex",flexDirection:"column"},children:[r.jsxs(f,{sx:{mb:2,display:"flex",gap:1},children:[r.jsx(v,{variant:"outlined",size:"small",onClick:()=>window.open(M,"_blank"),children:"Open in New Tab"}),r.jsx(v,{variant:"outlined",size:"small",onClick:()=>{const o=document.createElement("a");o.href=M,o.download="document.pdf",o.click()},children:"Download"})]}),ue?r.jsx(f,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${T.palette.divider}`,borderRadius:1},children:r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"PDF Preview Unavailable"}),r.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The PDF could not be displayed in the preview. Please use the buttons above to view or download the file."})]})}):r.jsx(f,{sx:{flex:1,border:`1px solid ${T.palette.divider}`,borderRadius:1,overflow:"hidden"},children:r.jsx("iframe",{src:`${M}#toolbar=1&navpanes=1&scrollbar=1`,title:"PDF Preview",width:"100%",height:"100%",style:{border:0},onError:()=>{Z(!0)},onLoad:()=>{Z(!1)}})})]}),z==="text"&&Q&&r.jsx(f,{sx:{width:"100%",maxHeight:500,overflow:"auto",bgcolor:"background.default",p:2,borderRadius:2},children:r.jsx("pre",{style:{margin:0,fontFamily:"monospace",fontSize:14},children:Q})}),z==="unsupported"&&r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Preview not available for this file type"}),r.jsx(v,{variant:"contained",onClick:()=>{const o=document.createElement("a");o.href=M,o.download="file",o.click()},children:"Download File"})]}),z==="error"&&r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsxs(m,{color:"error",gutterBottom:!0,children:["Error loading file: ",me]}),r.jsx(v,{variant:"outlined",onClick:()=>window.open(M,"_blank"),children:"Try Opening in New Tab"})]})]}),r.jsx(G,{children:r.jsx(v,{onClick:()=>{R(!1),Y(null),E(null),I(""),W("")},children:"Close"})})]})]})};export{Ke as C,Ye as F,Ee as a,Je as b,Ge as c,Re as d,Oe as e,Pe as f,Be as g,qe as h,Ve as i,Ie as j,$e as k,Me as l,Ne as m,ze as n,We as p,He as v};
