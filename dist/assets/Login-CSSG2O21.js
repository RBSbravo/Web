import{u as he,r as s,j as e,B as v,ba as ge,S as fe,am as be,F as P,G as je,H as se,b as z,av as m,aA as i,bb as B,I as M,b8 as O,ar as N,b9 as _,bc as we,a6 as f,al as $,ae as G,z as I,Z as H,a7 as u,ap as re,aw as ye,ax as ve,ay as Pe,m as Se,e as Ce,v as Ie,w as ke,x as Le,y as Ae}from"./mui-DmyK1VYO.js";import{u as Fe,L as De,m as Ee,l as k}from"./index-Bicryl7V.js";import{P as Re}from"./PasswordStrengthIndicator-CcrqGHKl.js";import{u as We}from"./router-ViNET1Ki.js";import"./vendor-Ckhrjn13.js";const Oe=()=>{const ae=We(),a=he(),{login:oe,user:L}=Fe(),[p,U]=s.useState(0),[A,ne]=s.useState(!1),[S,b]=s.useState(""),[x,F]=s.useState(!1),[j,V]=s.useState(!1),[w,ie]=s.useState({email:"",password:""}),[h,Y]=s.useState(!1),[D,c]=s.useState(""),[l,Z]=s.useState(!1),[d,E]=s.useState(!1),[R,le]=s.useState([]),[o,J]=s.useState({firstname:"",lastname:"",email:"",password:"",confirmPassword:"",departmentId:"",role:"department_head"}),[de,W]=s.useState(!1),[T,ce]=s.useState(""),[C,K]=s.useState(!1),[Q,q]=s.useState(""),[X,ee]=s.useState("");s.useEffect(()=>{L&&L.isAuthenticated&&localStorage.removeItem("loginTab")},[L]),s.useEffect(()=>{const t=setTimeout(()=>F(!1),800);return()=>clearTimeout(t)},[]),s.useEffect(()=>{p===1&&R.length===0&&(async()=>{try{const r=await k.getDepartments();le(r.data)}catch{}})()},[p,R.length]);const te=t=>{const{name:r,value:n}=t.target;ie(y=>({...y,[r]:n})),S&&b("")},me=async t=>{if(t.preventDefault(),!w.email||!w.password){b("Please fill in all fields");return}F(!0),b(""),V(!1);try{const r=await k.login(w),{data:n}=r;if(n&&n.token){V(!0);const y={user:n.user,token:n.token};oe(y),setTimeout(()=>{ae("/app/dashboard")},1e3)}else throw new Error("Invalid response from server")}catch(r){console.error("Login error:",r);const n=r.response?.data?.error||r.response?.data?.message||"Login failed. Please try again.";b(n),F(!1)}},g=t=>{const{name:r,value:n}=t.target;J(y=>({...y,[r]:n})),D&&c("")},ue=()=>!o.firstname||!o.lastname||!o.email||!o.password||!o.confirmPassword||!o.departmentId?(c("Please fill in all fields"),!1):o.password!==o.confirmPassword?(c("Passwords do not match"),!1):o.password.length<8?(c("Password must be at least 8 characters long"),!1):!0,pe=async t=>{if(t.preventDefault(),!!ue()){Z(!0),c(""),E(!1);try{const r={...o};delete r.confirmPassword,(await k.register(r)).data&&(E(!0),J({firstname:"",lastname:"",email:"",password:"",confirmPassword:"",departmentId:"",role:"department_head"}),setTimeout(()=>{U(0),E(!1),c("")},2e3))}catch(r){const n=r.response?.data?.message||"Registration failed. Please try again.";c(n)}finally{Z(!1)}}},xe=(t,r)=>{U(r),b(""),c("")};return x&&!S?e.jsx(De,{overlay:!0,message:"Loading login..."}):e.jsxs(v,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",background:a.palette.mode==="dark"?a.palette.background.default:`linear-gradient(to right bottom, ${a.palette.primary.light}, ${a.palette.primary.main})`,py:8,position:"relative",overflow:"hidden"},children:[e.jsx(ge,{component:"main",maxWidth:"sm",children:e.jsx(fe,{direction:"up",in:!0,timeout:800,children:e.jsxs(be,{elevation:a.palette.mode==="dark"?2:8,sx:{p:{xs:3,sm:6},display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:a.palette.mode==="dark"?a.palette.background.paper:a.palette.common.white,borderRadius:3,position:"relative",backdropFilter:"blur(10px)",border:`1px solid ${a.palette.mode==="dark"?"rgba(255,255,255,0.1)":"rgba(255,255,255,0.2)"}`,boxShadow:a.palette.mode==="dark"?"0 8px 32px rgba(0,0,0,0.3)":"0 8px 32px rgba(0,0,0,0.1)"},children:[e.jsx(P,{in:!0,timeout:1200,children:e.jsx(v,{sx:{width:80,height:80,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",mb:2,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:e.jsx(v,{component:"img",src:Ee,alt:"Mito Logo",sx:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"}})})}),e.jsxs(je,{value:p,onChange:xe,sx:{mb:3},centered:!0,children:[e.jsx(se,{label:"Sign In"}),e.jsx(se,{label:"Sign Up"})]}),p===0&&e.jsxs(v,{sx:{textAlign:"center",mb:2},children:[e.jsx(z,{variant:"h4",color:"primary",sx:{fontWeight:"bold",fontSize:24,mt:.75},children:"Welcome Back"}),e.jsx(z,{variant:"body1",color:"text.secondary",sx:{fontSize:14,mt:.25},children:"Sign in to continue"})]}),p===0&&e.jsxs("form",{onSubmit:me,style:{width:"100%"},children:[e.jsx(m,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:w.email,onChange:te,disabled:x||j,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(B,{color:"action"})})}}),e.jsx(m,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:A?"text":"password",id:"password",autoComplete:"current-password",value:w.password,onChange:te,disabled:x||j,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(_,{color:"action"})}),endAdornment:e.jsx(i,{position:"end",children:e.jsx(M,{"aria-label":"toggle password visibility",onClick:()=>ne(!A),edge:"end",disabled:x||j,children:A?e.jsx(O,{}):e.jsx(N,{})})})}}),e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mt:1,mb:2},children:e.jsx(we,{component:"button",type:"button",variant:"body2",underline:"hover",onClick:t=>{t.preventDefault(),t.stopPropagation(),W(!0)},sx:{border:"none",background:"none",cursor:"pointer",color:a.palette.primary.main,"&:hover":{color:a.palette.primary.dark}},children:"Forgot password?"})}),S&&e.jsx(P,{in:!0,children:e.jsx(f,{severity:"error",sx:{width:"100%",mb:2},icon:e.jsx($,{}),children:S})}),j&&e.jsx(P,{in:!0,children:e.jsx(f,{severity:"success",sx:{width:"100%",mb:2},icon:e.jsx(G,{}),children:"Login successful! Redirecting..."})}),e.jsx(I,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.2},disabled:x||j,children:x?e.jsx(H,{size:24,color:"inherit"}):"Sign In"})]}),p===1&&e.jsxs("form",{onSubmit:pe,style:{width:"100%"},children:[e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(m,{required:!0,fullWidth:!0,id:"firstname",label:"First Name",name:"firstname",autoComplete:"given-name",value:o.firstname,onChange:g,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(re,{color:"action"})})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(m,{required:!0,fullWidth:!0,id:"lastname",label:"Last Name",name:"lastname",autoComplete:"family-name",value:o.lastname,onChange:g,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(re,{color:"action"})})}})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(m,{required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",value:o.email,onChange:g,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(B,{color:"action"})})}})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(ye,{fullWidth:!0,required:!0,children:[e.jsx(ve,{id:"department-label",children:"Department"}),e.jsx(Pe,{labelId:"department-label",id:"departmentId",name:"departmentId",value:o.departmentId,label:"Department",onChange:g,disabled:l||d,startAdornment:e.jsx(i,{position:"start",children:e.jsx(Ce,{color:"action"})}),children:R.map(t=>e.jsx(Se,{value:t.id,children:t.name},t.id))})]})}),e.jsxs(u,{item:!0,xs:12,sm:6,children:[e.jsx(m,{required:!0,fullWidth:!0,name:"password",label:"Password",type:h?"text":"password",id:"register-password",autoComplete:"new-password",value:o.password,onChange:g,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(_,{color:"action"})}),endAdornment:e.jsx(i,{position:"end",children:e.jsx(M,{"aria-label":"toggle password visibility",onClick:()=>Y(!h),edge:"end",disabled:l||d,children:h?e.jsx(O,{}):e.jsx(N,{})})})}}),e.jsx(Re,{password:o.password})]}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(m,{required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:h?"text":"password",id:"register-confirm-password",autoComplete:"new-password",value:o.confirmPassword,onChange:g,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(_,{color:"action"})}),endAdornment:e.jsx(i,{position:"end",children:e.jsx(M,{"aria-label":"toggle password visibility",onClick:()=>Y(!h),edge:"end",disabled:l||d,children:h?e.jsx(O,{}):e.jsx(N,{})})})}})})]}),D&&e.jsx(P,{in:!0,children:e.jsx(f,{severity:"error",sx:{width:"100%",mt:2},icon:e.jsx($,{}),children:D})}),d&&e.jsx(P,{in:!0,children:e.jsx(f,{severity:"success",sx:{width:"100%",mt:2},icon:e.jsx(G,{}),children:"Registration successful! You will be redirected to login in a few seconds..."})}),e.jsx(I,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.2},disabled:l||d,children:l?e.jsx(H,{size:24,color:"inherit"}):"Register"})]})]})})}),e.jsxs(Ie,{open:de,onClose:()=>W(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:a.palette.mode==="dark"?"0 8px 32px rgba(0,0,0,0.3)":"0 8px 32px rgba(0,0,0,0.1)"}},children:[e.jsx(ke,{sx:{pb:1,fontWeight:600,color:a.palette.text.primary},children:"Forgot Password"}),e.jsxs(Le,{sx:{pt:2},children:[e.jsx(z,{variant:"body2",sx:{mb:3,color:a.palette.text.secondary},children:"Enter your email address and we'll send you a link to reset your password."}),e.jsx(m,{label:"Email Address",type:"email",fullWidth:!0,margin:"normal",value:T,onChange:t=>ce(t.target.value),disabled:C,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(B,{color:"action"})})}}),Q&&e.jsx(f,{severity:"error",sx:{mt:2},icon:e.jsx($,{}),children:Q}),X&&e.jsx(f,{severity:"success",sx:{mt:2},icon:e.jsx(G,{}),children:X})]}),e.jsxs(Ae,{sx:{px:3,pb:3},children:[e.jsx(I,{onClick:()=>W(!1),disabled:C,sx:{color:a.palette.text.secondary,"&:hover":{color:a.palette.text.primary}},children:"Cancel"}),e.jsx(I,{onClick:async()=>{if(q(""),ee(""),!T){q("Please enter your email address.");return}K(!0);try{await k.forgotPassword({email:T}),ee("If an account with that email exists, a reset link has been sent.")}catch(t){q(t.response?.data?.error||"Failed to send reset email.")}finally{K(!1)}},variant:"contained",color:"primary",disabled:C,size:"small",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,minWidth:"120px",height:"36px"},children:C?e.jsx(H,{size:20,color:"inherit"}):"Send Reset Link"})]})]})]})};export{Oe as default};
