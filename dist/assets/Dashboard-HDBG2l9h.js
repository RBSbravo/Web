import{u as G,r as m,j as e,a6 as q,b as r,B as t,a7 as i,a8 as d,a9 as x,k as h,s as T,n as I,aa as A,V as j,q as S,d as g,Y as f,I as V,ab as _,ac as J,ad as K,a2 as R,ae as P,af as W,ag as z,ah as Q,ai as y,aj as X,W as L,ak as Z,al as ee}from"./mui-DmyK1VYO.js";import{u as se,a as re,L as te}from"./index-DFirrH-V.js";import{P as ae}from"./PageHeader-DsP3YEjW.js";import"./vendor-Ckhrjn13.js";import"./router-ViNET1Ki.js";const de=()=>{const{user:p}=se(),u=G(),[M,k]=m.useState(!0),[v,w]=m.useState(null),[o,E]=m.useState(null),[b,$]=m.useState(!1),C=m.useCallback(async()=>{k(!0),w(null);try{const s=await re.getDashboardStats();E(s.data)}catch{w("Failed to load dashboard data")}finally{k(!1)}},[]);if(m.useEffect(()=>{C()},[C]),M)return e.jsx(te,{overlay:!0,message:"Loading dashboard..."});if(v)return e.jsx(q,{severity:"error",sx:{mb:3},children:v});if(!o)return e.jsx(r,{variant:"h6",color:"error",children:"Failed to load dashboard data"});const D=[{key:"totalTickets",label:"Total Tickets"},{key:"openTickets",label:"Open Tickets"},{key:"closedTickets",label:"Closed Tickets"},{key:"overdueTickets",label:"Overdue Tickets"},{key:"totalTasks",label:"Total Tasks"},{key:"completedTasks",label:"Completed Tasks"},{key:"overdueTasks",label:"Overdue Tasks"},{key:"activeUsers",label:"Active Users"}],O={totalTickets:{icon:e.jsx(j,{}),color:"primary.main",bg:"primary.light"},openTickets:{icon:e.jsx(L,{}),color:"error.main",bg:"error.light"},closedTickets:{icon:e.jsx(P,{}),color:"success.main",bg:"success.light"},overdueTickets:{icon:e.jsx(ee,{}),color:"warning.main",bg:"warning.light"},totalTasks:{icon:e.jsx(f,{}),color:"secondary.main",bg:"secondary.light"},completedTasks:{icon:e.jsx(Z,{}),color:"success.main",bg:"success.light"},overdueTasks:{icon:e.jsx(L,{}),color:"warning.main",bg:"warning.light"},activeUsers:{icon:e.jsx(R,{}),color:"info.main",bg:"info.light"},departments:{icon:e.jsx(X,{}),color:"primary.dark",bg:"primary.light"}},H=s=>s>=90?5:s>=80?4:s>=70?3:s>=60?2:1,U=s=>s>=90?"success":s>=80?"info":s>=70?"warning":"error",F=()=>{$(!b)};return e.jsxs(t,{sx:{flexGrow:1,pt:{xs:7,sm:3,md:4},px:{xs:1,sm:2,md:3},pb:{xs:8,sm:12,md:16},display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"background.default"},children:[e.jsx(ae,{title:`Welcome back, ${p?.firstname||p?.name||"User"}!`,subtitle:p?.role==="department_head"?`Here's what's happening in your ${p?.department||"department"} today.`:p?.role==="admin"?"Here's your organization-wide overview and team performance.":"Here's your current tasks and tickets overview.",emoji:"ðŸ‘‹",color:"primary"}),e.jsx(i,{container:!0,spacing:4,sx:{mb:{xs:3,sm:4,md:5}},children:D.map(s=>{const a=O[s.key]||{};return e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{sx:{height:"100%",borderRadius:4,p:0,bgcolor:"background.paper",boxShadow:"0 6px 20px rgba(0,0,0,0.08)",border:"1px solid",borderColor:"divider",transition:"transform 0.2s ease, box-shadow 0.2s ease","&:hover":{transform:"translateY(-6px)",boxShadow:"0 14px 30px rgba(0,0,0,0.12)"}},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2.5,p:{xs:2,sm:2.5}},children:[e.jsx(h,{sx:{width:54,height:54,mr:2,bgcolor:a.bg,color:a.color,boxShadow:"inset 0 0 0 2px rgba(255,255,255,0.8), 0 4px 10px rgba(0,0,0,0.08)"},children:a.icon}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{fontWeight:700,mb:.5,letterSpacing:.3,textTransform:"uppercase"},children:s.label}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,fontSize:{xs:"2rem",sm:"2.2rem"},color:"text.primary",lineHeight:1},children:o[s.key]})]})]})})},s.key)})}),(o.recentTickets||o.recentTasks)&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2,mt:2},children:[e.jsx(t,{sx:{width:6,height:32,bgcolor:"primary.main",borderRadius:2,mr:1}}),e.jsx(r,{variant:"h5",sx:{fontWeight:700,letterSpacing:.5},children:"Recent Activity"})]}),e.jsxs(i,{container:!0,spacing:3,sx:{mb:4},children:[o.recentTickets&&e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(d,{sx:{borderRadius:4,height:"100%",bgcolor:"background.paper",border:"1px solid",borderColor:"divider",boxShadow:"0 6px 20px rgba(0,0,0,0.06)"},children:e.jsxs(x,{sx:{p:{xs:2,sm:2.5}},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:700,mb:2,letterSpacing:.5,color:"primary.main"},children:"Recent Tickets"}),o.recentTickets.length>0?e.jsx(T,{dense:!0,children:o.recentTickets.map(s=>e.jsxs(I,{alignItems:"flex-start",sx:{mb:1,borderRadius:2,bgcolor:"background.paper",boxShadow:1},children:[e.jsx(A,{children:e.jsx(h,{sx:{bgcolor:"primary.main"},children:e.jsx(j,{})})}),e.jsx(S,{primary:e.jsx(t,{sx:{fontWeight:600},children:s.title}),secondary:e.jsx(r,{variant:"body2",color:"text.secondary",component:"div",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(g,{label:s.status,size:"small",color:s.status==="open"||s.status==="pending"?"error":s.status==="closed"||s.status==="completed"||s.status==="resolved"?"success":"warning"}),e.jsx(g,{label:s.priority,size:"small",color:s.priority==="high"?"error":s.priority==="medium"?"warning":"success"})]})})})]},s.id))}):e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary",py:2},children:[e.jsx(j,{color:"disabled"}),e.jsx(r,{variant:"body2",children:"No recent tickets."})]})]})})}),o.recentTasks&&e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(d,{sx:{borderRadius:3,boxShadow:2,height:"100%"},children:e.jsxs(x,{children:[e.jsx(r,{variant:"h6",sx:{fontWeight:700,mb:2,letterSpacing:.5,color:"secondary.main"},children:"Recent Tasks"}),o.recentTasks.length>0?e.jsx(T,{dense:!0,children:o.recentTasks.map(s=>e.jsxs(I,{alignItems:"flex-start",sx:{mb:1,borderRadius:2,bgcolor:"background.paper",boxShadow:1},children:[e.jsx(A,{children:e.jsx(h,{sx:{bgcolor:"secondary.main"},children:e.jsx(f,{})})}),e.jsx(S,{primary:e.jsx(t,{sx:{fontWeight:600},children:s.title}),secondary:e.jsx(r,{variant:"body2",color:"text.secondary",component:"div",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(g,{label:s.status,size:"small",color:s.status==="completed"?"success":s.status==="pending"?"warning":"info"}),e.jsx(g,{label:s.priority,size:"small",color:s.priority==="high"?"error":s.priority==="medium"?"warning":"success"})]})})})]},s.id))}):e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary",py:2},children:[e.jsx(f,{color:"disabled"}),e.jsx(r,{variant:"body2",children:"No recent tasks."})]})]})})})]})]}),o.teamPerformance&&o.teamPerformance.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,mt:4,p:2,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:1},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",flex:1},children:[e.jsx(t,{sx:{width:4,height:24,bgcolor:"primary.main",borderRadius:2,mr:2}}),e.jsx(r,{variant:"h5",sx:{fontWeight:700,letterSpacing:.5},children:p?.role==="admin"?"Organization Performance":"Team Performance"})]}),b&&e.jsxs(t,{sx:{display:"flex",gap:1,flexWrap:"wrap",mr:2},children:[e.jsx(g,{label:`${o.teamPerformance.length} Members`,size:"small",color:"primary",variant:"outlined",sx:{fontSize:"0.75rem",height:24}}),e.jsx(g,{label:`${o.teamPerformance.reduce((s,a)=>s+a.tasksCompleted+a.ticketsClosed,0)} Completed`,size:"small",color:"success",variant:"outlined",sx:{fontSize:"0.75rem",height:24}}),e.jsx(g,{label:`${Math.round(o.teamPerformance.reduce((s,a)=>{const l=a.tasksAssigned+a.ticketsAssigned,n=a.tasksCompleted+a.ticketsClosed;return s+(l>0?n/l*100:0)},0)/o.teamPerformance.length)}% Avg Efficiency`,size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.75rem",height:24}})]}),e.jsx(V,{onClick:F,sx:{color:"primary.main","&:hover":{backgroundColor:"primary.light",color:"primary.dark"}},children:b?e.jsx(_,{}):e.jsx(J,{})})]}),e.jsxs(K,{in:!b,children:[e.jsxs(i,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(x,{sx:{textAlign:"center",p:3},children:[e.jsx(h,{sx:{bgcolor:"primary.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(R,{})}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,color:"primary.main",mb:1},children:o.teamPerformance.length}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Active Members"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(x,{sx:{textAlign:"center",p:3},children:[e.jsx(h,{sx:{bgcolor:"success.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(P,{})}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,color:"success.main",mb:1},children:o.teamPerformance.reduce((s,a)=>s+a.tasksCompleted+a.ticketsClosed,0)}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Completed Items"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(x,{sx:{textAlign:"center",p:3},children:[e.jsx(h,{sx:{bgcolor:"info.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(W,{})}),e.jsxs(r,{variant:"h4",sx:{fontWeight:800,color:"info.main",mb:1},children:[Math.round(o.teamPerformance.reduce((s,a)=>{const l=a.tasksAssigned+a.ticketsAssigned,n=a.tasksCompleted+a.ticketsClosed;return s+(l>0?n/l*100:0)},0)/o.teamPerformance.length),"%"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Avg Efficiency"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(x,{sx:{textAlign:"center",p:3},children:[e.jsx(h,{sx:{bgcolor:"warning.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(z,{})}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,color:"warning.main",mb:1},children:o.teamPerformance.filter(s=>{const a=s.tasksAssigned+s.ticketsAssigned,l=s.tasksCompleted+s.ticketsClosed;return(a>0?Math.round(l/a*100):0)>=90}).length}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Top Performers"})]})})})]}),e.jsx(i,{container:!0,spacing:3,children:o.teamPerformance.map(s=>{const a=s.tasksAssigned+s.ticketsAssigned,l=s.tasksCompleted+s.ticketsClosed,n=a>0?Math.round(l/a*100):0,c=U(n),N=s.tasksAssigned>0?Math.round(s.tasksCompleted/s.tasksAssigned*100):0,B=s.ticketsAssigned>0?Math.round(s.ticketsClosed/s.ticketsAssigned*100):0;return e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(d,{sx:{borderRadius:3,boxShadow:2,transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:4},position:"relative",height:"100%",bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[e.jsx(t,{sx:{position:"absolute",top:16,right:16,zIndex:1},children:e.jsx(g,{label:`${n}%`,size:"small",color:c,icon:n>=90?e.jsx(z,{}):e.jsx(W,{}),sx:{fontWeight:700,fontSize:"0.75rem",height:28}})}),e.jsxs(x,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(h,{sx:{bgcolor:`${c}.main`,width:48,height:48,fontSize:"1.1rem",fontWeight:700,mr:2},children:s.name.split(" ").map(Y=>Y[0]).join("")}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:700,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),e.jsxs(r,{variant:"body2",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[s.role?s.role.charAt(0).toUpperCase()+s.role.slice(1):"",s.departmentName?` â€¢ ${s.departmentName}`:""]})]})]}),e.jsxs(t,{sx:{mb:3,textAlign:"center"},children:[e.jsx(Q,{value:H(n),readOnly:!0,size:"small",sx:{mb:1}}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"Performance Rating"})]}),e.jsxs(t,{sx:{mb:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"subtitle2",sx:{fontWeight:600,color:"text.primary"},children:"Tasks"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[s.tasksCompleted,"/",s.tasksAssigned]})]}),e.jsx(y,{variant:"determinate",value:N,sx:{height:8,borderRadius:4,bgcolor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:4}},color:"secondary"}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Assigned: ",s.tasksAssigned]}),e.jsxs(r,{variant:"caption",color:"success.main",sx:{fontWeight:600},children:["Completed: ",s.tasksCompleted]})]})]}),e.jsxs(t,{sx:{mb:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"subtitle2",sx:{fontWeight:600,color:"text.primary"},children:"Tickets"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[s.ticketsClosed,"/",s.ticketsAssigned]})]}),e.jsx(y,{variant:"determinate",value:B,sx:{height:8,borderRadius:4,bgcolor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:4}},color:"primary"}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Assigned: ",s.ticketsAssigned]}),e.jsxs(r,{variant:"caption",color:"success.main",sx:{fontWeight:600},children:["Closed: ",s.ticketsClosed]})]})]}),e.jsxs(t,{sx:{p:2,bgcolor:`${c}.50`,borderRadius:2,border:`1px solid ${c==="success"?u.palette.success.main:c==="warning"?u.palette.warning.main:c==="error"?u.palette.error.main:u.palette.info.main}20`},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"subtitle2",sx:{fontWeight:600,color:"text.primary"},children:"Overall Efficiency"}),e.jsxs(r,{variant:"h6",sx:{fontWeight:800,color:`${c}.main`},children:[n,"%"]})]}),e.jsx(y,{variant:"determinate",value:n,sx:{height:10,borderRadius:5,bgcolor:"rgba(255,255,255,0.3)","& .MuiLinearProgress-bar":{borderRadius:5}},color:c})]})]})]})},s.userId)})})]})]})]})};export{de as default};
