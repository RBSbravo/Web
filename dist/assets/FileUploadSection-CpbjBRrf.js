import{u as le,j as r,B as f,b as m,V as de,r as ce,n as me,a7 as Te,k as Fe,am as ke,q as ue,I as pe,J as he,H as fe,as as De,y as C,t as K,v as Y,x as X,a3 as Ue,p as Pe,aN as Re,h as ie,aw as Ne,ao as ze,w as Me}from"./mui-DaYlJXyD.js";import{r as u,b as xe}from"./vendor-Cr2nE3UY.js";const Oe=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(n){return console.error("Error formatting date:",n),"N/A"}},Ie=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(n){return console.error("Error formatting date time:",n),"N/A"}},We=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"warning";case"in_progress":case"in progress":return"primary";case"completed":case"resolved":return"success";case"declined":case"cancelled":return"error";default:return"default"}},He=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"Schedule";case"in_progress":case"in progress":return"Schedule";case"completed":case"resolved":return"CheckCircle";case"declined":case"cancelled":return"Error";default:return"ConfirmationNumber"}},qe=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"error";case"medium":case"normal":return"warning";case"low":return"success";default:return"default"}},Ve=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"PriorityHigh";case"medium":case"normal":return"Remove";case"low":return"LowPriority";default:return"Remove"}},Ge=e=>{const n=new Date,i=new Date(e.created_at||e.createdAt),l=e.due_date?new Date(e.due_date):null,a=(e.status||"").toLowerCase();if(a==="completed"||a==="resolved"||a==="declined"||a==="cancelled")return null;if(l&&l<n)return"error";if(a==="in_progress"||a==="in progress"){const s=(n-i)/36e5;return s<=72?"success":s<=72+3*24?"warning":"error"}if((a==="pending"||a==="open")&&l){const s=(l-n)/36e5;if(s<0)return"error";if(s<=24)return"error";if(s<=72)return"warning"}return null},Je=e=>{const n=new Date,i=new Date(e.created_at||e.createdAt),l=e.due_date?new Date(e.due_date):null,a=(e.status||"").toLowerCase();if(a==="completed"||a==="resolved"||a==="declined"||a==="cancelled")return null;if(l&&l<n){const s=Math.floor((n-l)/864e5);return`Overdue by ${s} day${s!==1?"s":""}`}if(a==="in_progress"||a==="in progress"){const s=(n-i)/36e5;return s<=72?"Fresh":s<=72+3*24?"Aging":"Stale"}if((a==="pending"||a==="open")&&l){const s=(l-n)/36e5;if(s<0){const p=Math.floor(Math.abs(s)/24);return`Overdue by ${p} day${p!==1?"s":""}`}else{if(s<=24)return"Due Soon";if(s<=72)return"Due in 3 days"}}return null},Ke=(e,n,i,l,a,s,p,S)=>{const L=Array.isArray(e)?e:[],$=Array.isArray(n)?n:[],P=Array.isArray(i)?i:[],R=L.filter(h=>{var _;return((_=h.ticketCreator)==null?void 0:_.id)===S||h.created_by===S||h.createdBy===S||h.original_creator_id===S});let w;switch(p){case 0:w=R;break;case 1:w=$;break;case 2:{const h=L.filter(x=>{var z;const A=x.forwarded_from_id||x.forwardedFromId||((z=x.forwardedFrom)==null?void 0:z.id),b=x.is_forwarded===!0||x.isForwarded===!0||typeof x.forward_chain_id<"u"||typeof x.forwardChainId<"u",N=A&&S&&String(A)===String(S);return b&&N}),_=[...P,...h],D=new Set;w=_.filter(x=>!x||!x.id||D.has(x.id)?!1:(D.add(x.id),!0));break}default:w=R}return w.filter(h=>{var A,b,N;const _=!l||((A=h.title)==null?void 0:A.toLowerCase().includes(l.toLowerCase()))||((b=h.description)==null?void 0:b.toLowerCase().includes(l.toLowerCase()))||((N=h.id)==null?void 0:N.toString().includes(l))||(h.ticketCreator?`${h.ticketCreator.firstname} ${h.ticketCreator.lastname}`:"").toLowerCase().includes(l.toLowerCase())||(h.ticketAssignee?`${h.ticketAssignee.firstname} ${h.ticketAssignee.lastname}`:"").toLowerCase().includes(l.toLowerCase()),D=a==="all"||(h.status||"").toLowerCase()===a.toLowerCase(),x=s==="all"||(h.priority||"").toLowerCase()===s.toLowerCase();return _&&D&&x})},Ye=e=>{let n="";if(e.due_date)try{const i=new Date(e.due_date);isNaN(i.getTime())||(n=i.toISOString().split("T")[0])}catch(i){console.error("Error formatting date:",i)}return{id:e.id,title:e.title||"",description:e.description||"",priority:e.priority?e.priority.charAt(0).toUpperCase()+e.priority.slice(1):"Medium",status:e.status||"pending",due_date:n,departmentId:e.departmentId||e.department_id||"",sendTo:e.assignedTo||e.assigned_to||"",createdBy:e.createdBy||e.created_by||"",desired_action:e.desired_action||"",remarks:e.remarks||""}},Xe=(e,n,i)=>{var a,s,p;const l={title:(a=e.title)==null?void 0:a.trim(),description:(s=e.description)==null?void 0:s.trim(),priority:(e.priority||"Medium").toLowerCase(),status:e.status||"pending",desired_action:(p=e.desired_action)==null?void 0:p.trim()};return e.id&&(l.id=e.id),e.due_date&&(l.due_date=e.due_date),e.remarks&&(l.remarks=e.remarks),e.departmentId?l.department_id=e.departmentId:i!=null&&i.departmentId&&(l.department_id=i.departmentId),e.sendTo&&(l.assigned_to=e.sendTo),l},Ze=(e,n=!1)=>{var l,a,s,p;const i=[];return(l=e.title)!=null&&l.trim()||i.push("Ticket title is required."),(a=e.description)!=null&&a.trim()||i.push("Ticket description is required."),e.priority||i.push("Please select a priority level."),(s=e.desired_action)!=null&&s.trim()||i.push("Desired action is required."),e.sendTo||i.push("Please select who to send the ticket to."),n&&!e.id&&i.push("Ticket ID is required for updates."),n&&!((p=e.remarks)!=null&&p.trim())&&i.push("Remarks are required when updating a ticket. Please provide remarks explaining the changes made."),i},Qe=(e,n)=>({id:`temp-${Date.now()}-${Math.random()}`,name:e.name,size:e.size,type:e.type,file:e,uploadedAt:new Date().toISOString(),uploadedBy:n.firstname+" "+n.lastname}),er=e=>{if(e&&e.file){const n=URL.createObjectURL(e.file),i=document.createElement("a");i.href=n,i.download=e.name,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}},rr=e=>{if(e===0)return"0 Bytes";const n=1024,i=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,l)).toFixed(2))+" "+i[l]},tr=e=>e?typeof e=="string"?e:`${e.firstname||e.firstName||""} ${e.lastname||e.lastName||""}`.trim()||e.email||e.username||"Unknown User":"Unknown User",nr=({entityId:e,fetchComments:n,addComment:i,deleteComment:l,user:a})=>{const s=le(),[p,S]=u.useState([]),[L,$]=u.useState(!0),[P,R]=u.useState(""),[w,h]=u.useState(!1),[_,D]=u.useState(null),[x,A]=u.useState(!1),[b,N]=u.useState(""),z=t=>a?t.author_id===a.id||t.authorId===a.id||t.userId===a.id||t.author&&t.author.id===a.id||t.commentUser&&t.commentUser.id===a.id:!1,Z=t=>!a||t.comment_type==="update"||t.content&&t.content.startsWith("ðŸ“ **Task Updated**")?!1:t.author_id===a.id||t.authorId===a.id||t.userId===a.id||t.author&&t.author.id===a.id||t.commentUser&&t.commentUser.id===a.id,B=async()=>{$(!0);try{const t=await n(e),g=t.data||t||[];S(g)}catch(t){console.error("Error loading comments:",t),S([])}finally{$(!1)}};u.useEffect(()=>{e&&B()},[e]);const M=async t=>{if(t.preventDefault(),!!P.trim()){h(!0),N("");try{console.log("Submitting comment:",{entityId:e,content:P}),await i(e,{content:P}),R(""),B()}catch(g){let T="Failed to add comment.";g.response&&g.response.data&&(g.response.data.error?T=g.response.data.error:g.response.data.errors&&Array.isArray(g.response.data.errors)?T=g.response.data.errors.map(F=>F.msg||F.error||JSON.stringify(F)).join(`
`):T=JSON.stringify(g.response.data)),N(T)}finally{h(!1)}}},q=t=>{D(t),A(!0)},Q=async()=>{if(_)try{await l(_),A(!1),D(null),B()}catch{}};return r.jsxs(f,{sx:{mt:3},children:[r.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Comments"}),L?r.jsx(de,{size:24}):r.jsxs(ce,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2},children:[p.length===0&&r.jsx(m,{variant:"body2",color:"text.secondary",children:"No comments yet."}),p.map(t=>{var g,T,F;return r.jsxs(xe.Fragment,{children:[r.jsxs(me,{alignItems:"flex-start",sx:{px:2,py:1.5,bgcolor:z(t)?"primary.light10":"transparent",border:z(t)?`1px solid ${s.palette.primary.light}`:"none",borderRadius:z(t)?1:0,"&:hover":{bgcolor:z(t)?"primary.light15":"action.hover"}},secondaryAction:Z(t)&&r.jsx(pe,{edge:"end","aria-label":"delete comment",onClick:()=>q(t.id),size:"small",sx:{color:s.palette.error.main,"&:hover":{backgroundColor:s.palette.error.light+"20",color:s.palette.error.dark},transition:"all 0.2s ease-in-out"},children:r.jsx(he,{fontSize:"small"})}),children:[r.jsx(Te,{children:r.jsx(Fe,{children:r.jsx(ke,{})})}),r.jsx(ue,{primary:r.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[r.jsx(m,{sx:{fontWeight:500},component:"span",children:typeof t.commentUser=="object"?t.commentUser.firstname&&t.commentUser.lastname?`${t.commentUser.firstname} ${t.commentUser.lastname}`:t.commentUser.firstName&&t.commentUser.lastName?`${t.commentUser.firstName} ${t.commentUser.lastName}`:t.commentUser.username||t.commentUser.email||t.commentUser.id:t.commentUser}),r.jsx(m,{variant:"caption",color:"text.disabled",component:"span",children:new Date(t.createdAt).toLocaleString()})]}),secondary:r.jsx(m,{variant:"body2",color:"text.secondary",component:"span",sx:{lineHeight:1.5,fontSize:"0.875rem"},children:t.content&&t.content.startsWith("ðŸ“ **Task Updated**")?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Task Updated"}),r.jsxs(f,{sx:{color:s.palette.text.primary,backgroundColor:"#f5f5f5",padding:"8px 12px",borderRadius:"6px",borderLeft:"3px solid #e0e0e0",display:"inline-block",width:"100%"},children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"normal",mb:.5,color:s.palette.text.secondary},children:"Remarks:"}),r.jsx(m,{variant:"body2",sx:{fontWeight:"normal"},children:t.content.replace("ðŸ“ **Task Updated**","").replace(/^\n+/,"").replace(/^Remarks:\n?/,"")})]})]}):t.comment_type==="update"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Updated"}),r.jsxs(f,{sx:{color:s.palette.text.primary,backgroundColor:"#f5f5f5",padding:"8px 12px",borderRadius:"6px",borderLeft:"3px solid #e0e0e0",display:"inline-block",width:"100%"},children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"normal",mb:.5,color:s.palette.text.secondary},children:"Remarks:"}),r.jsx(m,{variant:"body2",sx:{fontWeight:"normal"},children:t.content.split(`
`).slice(2).join(`
`).replace(`Remarks:
`,"")})]})]}):t.comment_type==="forward"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Forwarded"}),r.jsxs(f,{sx:{color:s.palette.info.main,backgroundColor:s.palette.info.light,padding:"4px 8px",borderRadius:"4px",borderLeft:`4px solid ${s.palette.info.main}`,display:"inline-block",mb:1},children:[r.jsxs(m,{variant:"body2",sx:{mb:.5},children:[r.jsx("strong",{children:"To:"})," ",(g=t.content.split(`
`)[2])==null?void 0:g.replace("To: ","")]}),r.jsxs(m,{variant:"body2",children:[r.jsx("strong",{children:"Reason:"})," ",(T=t.content.split(`
`)[3])==null?void 0:T.replace("Reason: ","")]})]})]}):t.comment_type==="response"?r.jsxs(f,{children:[r.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Forward Response"}),r.jsxs(m,{variant:"body2",sx:{mb:.5},children:["Action: ",(F=t.content.split(`
`)[2])==null?void 0:F.replace("Action: ","")]}),t.content.split(`
`)[3]&&r.jsx(m,{variant:"body2",sx:{mb:1},children:t.content.split(`
`)[3]})]}):t.content})})]}),r.jsx(fe,{variant:"inset",component:"li"})]},t.id)})]}),r.jsxs(f,{component:"form",onSubmit:M,sx:{display:"flex",gap:1,mt:1},children:[r.jsx(De,{size:"small",fullWidth:!0,placeholder:"Add a comment...",value:P,onChange:t=>R(t.target.value),disabled:w}),r.jsx(C,{type:"submit",variant:"contained",disabled:w||!P.trim(),children:"Post"})]}),b&&r.jsx(m,{color:"error",variant:"body2",sx:{mb:1},children:b}),r.jsxs(K,{open:x,onClose:()=>A(!1),children:[r.jsx(Y,{sx:{pb:1},children:"Delete this comment?"}),r.jsxs(X,{sx:{px:3,pb:2},children:[r.jsx(C,{onClick:()=>A(!1),variant:"outlined",sx:{borderColor:s.palette.divider,color:"text.secondary","&:hover":{borderColor:s.palette.action.hover,backgroundColor:s.palette.action.hover}},children:"Cancel"}),r.jsx(C,{color:"error",variant:"contained",onClick:Q,sx:{backgroundColor:"error.main","&:hover":{backgroundColor:"error.dark"},boxShadow:"0 2px 4px rgba(244, 67, 54, 0.3)","&:active":{boxShadow:"0 1px 2px rgba(244, 67, 54, 0.3)"}},children:"Delete"})]})]})]})},ge=e=>{if(e===0)return"0 Bytes";const n=1024,i=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,l)).toFixed(2))+" "+i[l]},$e=(e,n={})=>{const{maxFileSize:i=10*1024*1024,acceptedTypes:l=["*/*"],maxFiles:a=5,currentFileCount:s=0}=n,p=[];return s>=a&&p.push(`Maximum ${a} files allowed`),e.size>i&&p.push(`File size must be less than ${ge(i)}`),l.length>0&&l[0]!=="*/*"&&(l.some(L=>L.endsWith("/*")?e.type.startsWith(L.replace("/*","")):e.type===L)||p.push(`File type not supported. Allowed: ${l.join(", ")}`)),{isValid:p.length===0,errors:p}},or=({entityId:e,fetchFiles:n,uploadFile:i,deleteFile:l,maxFiles:a=5,maxFileSize:s=10*1024*1024,acceptedTypes:p=["*/*"],disabled:S=!1,readOnly:L=!1,entityType:$="general"})=>{const P=le(),[R,w]=u.useState([]),[h,_]=u.useState(!0),[D,x]=u.useState(!1),[A,b]=u.useState(""),[N,z]=u.useState(null),[Z,B]=u.useState(!1),[M,q]=u.useState(null),[Q,t]=u.useState(!1),[g,T]=u.useState(!1),[F,O]=u.useState("image"),[E,ee]=u.useState(""),[te,V]=u.useState(""),[we,G]=u.useState(""),[be,re]=u.useState(!1),J=u.useCallback(async()=>{_(!0);try{const o=await n(e),d=o.data||o||[];if(!Array.isArray(d)){console.warn("Files data is not an array:",d),w([]);return}w(d.map(c=>({...c,name:c.name||c.file_name,file_name:c.file_name||c.name,file_size:c.file_size||c.size,url:c.url||`/api/files/${c.id}/download`,uploadedAt:c.uploadedAt||c.createdAt||c.created_at})))}catch(o){console.error("Error loading files:",o),w([])}finally{_(!1)}},[n,e]);u.useEffect(()=>{e?J():(_(!1),w([]))},[e]);const ye=u.useCallback(async o=>{var I,j,W,H,ne,oe,se,ae;b("");const d=o.target.files[0];if(!d)return;let c=p;$==="task"&&p[0]==="*/*"&&(c=["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp"]);const y=$e(d,{maxFileSize:s,acceptedTypes:c,maxFiles:a,currentFileCount:R.length});if(!y.isValid){b(y.errors.join(", "));return}x(!0);try{await i(e,d),e?await J():setTimeout(()=>{n&&n(e).then(v=>{const U=v.data||v||[];Array.isArray(U)&&w(U.map(k=>({...k,name:k.name||k.file_name,file_name:k.file_name||k.name,file_size:k.file_size||k.size,url:k.url||`/api/files/${k.id}/download`,uploadedAt:k.uploadedAt||k.createdAt||k.created_at})))}).catch(()=>{})},100)}catch(v){let U="Failed to upload file";v.message.includes("Network Error")||v.message.includes("Cannot connect")?U="Cannot connect to server. Please check if the backend is running.":((I=v.response)==null?void 0:I.status)===413?U="File is too large. Maximum size is 10MB.":((j=v.response)==null?void 0:j.status)===400?U=((H=(W=v.response)==null?void 0:W.data)==null?void 0:H.error)||"Invalid file or request.":((ne=v.response)==null?void 0:ne.status)===401?U="Authentication required. Please log in again.":((oe=v.response)==null?void 0:oe.status)===404?U="Ticket not found. The ticket may have been deleted.":(ae=(se=v.response)==null?void 0:se.data)!=null&&ae.error?U=v.response.data.error:v.message&&(U=v.message),b(U)}finally{x(!1)}},[R.length,a,s,p,i,e,J,n]),je=o=>{z(o),B(!0)},ve=async()=>{if(N)try{await l(e,N),B(!1),z(null),e&&await J()}catch(o){console.error("Error deleting file:",o),b("Failed to delete file")}},Ce=o=>{const d=o.uploadedAt||o.createdAt||o.created_at;if(!d)return"â€”";const c=new Date(d);return isNaN(c.getTime())?"â€”":c.toLocaleString()},Se=async o=>{const d=localStorage.getItem("token");try{const c=await fetch(o.url,{headers:{Authorization:`Bearer ${d}`}});if(!c.ok){alert("Failed to download file");return}const y=await c.blob();if(y.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");const I=window.URL.createObjectURL(y),j=document.createElement("a");j.href=I,j.download=o.name,document.body.appendChild(j),j.click(),j.remove(),window.URL.revokeObjectURL(I)}catch{alert("Failed to download file")}},_e=o=>{q(o),t(!0)},Ae=async()=>{if(M)try{if(e)await Se(M);else if(M.file){const o=URL.createObjectURL(M.file),d=document.createElement("a");d.href=o,d.download=M.name,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(o)}}catch(o){console.error("Error downloading file:",o),b("Failed to download file")}t(!1),q(null)},Le=async o=>{try{let d,c;if(e){const W=`https://backend-ticketing-system.up.railway.app/api/files/${o.id}/download`,H=await fetch(W,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!H.ok)throw new Error(`HTTP error! status: ${H.status}`);if(d=await H.blob(),d.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");c=URL.createObjectURL(d)}else if(o.file)d=o.file,c=URL.createObjectURL(o.file);else throw new Error("File object not available for preview");let y=d.type;const j=(o.file_name||o.name||"").split(".").pop().toLowerCase();if((!y||y==="application/octet-stream")&&(["jpg","jpeg","png","gif","bmp","webp"].includes(j)?y="image/"+j:j==="pdf"?y="application/pdf":["txt","csv","json","md","log"].includes(j)&&(y="text/plain")),ee(c),V(""),G(""),y.startsWith("image/"))O("image");else if(y==="application/pdf")O("pdf");else if(y.startsWith("text/")||["txt","csv","json","md","log"].includes(j)){const W=await d.text();V(W),O("text")}else O("unsupported");T(!0)}catch(d){console.error("Error viewing file:",d),G(d.message),O("error"),T(!0)}};return r.jsxs(f,{sx:{mt:3},children:[A&&r.jsx(Ue,{severity:"error",sx:{mb:2},onClose:()=>b(""),children:A}),r.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Attachments"}),h?r.jsx(de,{size:24}):r.jsxs(ce,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2,scrollbarWidth:"none",msOverflowStyle:"none","&::-webkit-scrollbar":{display:"none"}},children:[R.length===0&&r.jsx(m,{variant:"body2",color:"text.secondary",children:"No attachments yet."}),R.map(o=>{const d=o.file_name||o.name||"Unknown File";return r.jsxs(xe.Fragment,{children:[r.jsxs(me,{secondaryAction:!L&&r.jsx(ie,{title:"Delete file",arrow:!0,children:r.jsx(pe,{edge:"end",onClick:()=>je(o.id),color:"error",size:"small",sx:{"&:hover":{backgroundColor:"error.light",color:"error.contrastText"}},children:r.jsx(he,{fontSize:"small"})})}),children:[r.jsx(Pe,{children:r.jsx(Re,{})}),r.jsx(ue,{primary:r.jsx(ie,{title:"Click to download or view file",arrow:!0,children:r.jsx(m,{component:"span",sx:{cursor:"pointer",color:"primary.main",textDecoration:"underline","&:hover":{textDecoration:"none"}},onClick:()=>_e(o),children:d})}),secondary:r.jsxs(m,{variant:"caption",color:"text.disabled",children:[Ce(o)," â€¢ ",ge(o.file_size||o.size||0)]})})]}),r.jsx(fe,{variant:"inset",component:"li"})]},o.id)})]}),!L&&r.jsxs(C,{variant:"outlined",component:"label",startIcon:r.jsx(Ne,{}),disabled:S||D,sx:{mt:1},children:[D?"Uploading...":$==="task"?"Upload File (PDF & Images Only)":"Upload File",r.jsx("input",{type:"file",hidden:!0,onChange:ye,accept:$==="task"?".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp,application/pdf,image/*":p.join(","),disabled:S||D})]}),!L&&$==="task"&&r.jsx(f,{sx:{mt:1,fontSize:"0.75rem",color:"text.secondary"},children:"Allowed file types: PDF, JPG, PNG, GIF, WebP, BMP (Max 10MB each)"}),r.jsxs(K,{open:Z,onClose:()=>B(!1),children:[r.jsx(Y,{children:"Delete this file?"}),r.jsxs(X,{children:[r.jsx(C,{onClick:()=>B(!1),children:"Cancel"}),r.jsx(C,{color:"error",variant:"contained",onClick:ve,children:"Delete"})]})]}),r.jsxs(K,{open:Q,onClose:()=>t(!1),children:[r.jsx(Y,{children:"Download this file?"}),r.jsxs(X,{children:[r.jsx(C,{onClick:()=>t(!1),children:"Cancel"}),r.jsx(C,{startIcon:r.jsx(ze,{}),onClick:()=>Le(M),disabled:!M,children:"View"}),r.jsx(C,{variant:"contained",onClick:Ae,disabled:!M,children:"Download"})]})]}),r.jsxs(K,{open:g,onClose:()=>{T(!1),ee(null),O(null),V(""),G(""),re(!1)},maxWidth:"md",fullWidth:!0,children:[r.jsx(Y,{children:"File Preview"}),r.jsxs(Me,{sx:{minHeight:400,display:"flex",alignItems:"center",justifyContent:"center"},children:[F==="image"&&E&&r.jsx("img",{src:E,alt:"Preview",style:{maxWidth:"100%",maxHeight:500,display:"block",margin:"0 auto"}}),F==="pdf"&&E&&r.jsxs(f,{sx:{width:"100%",height:500,display:"flex",flexDirection:"column"},children:[r.jsxs(f,{sx:{mb:2,display:"flex",gap:1},children:[r.jsx(C,{variant:"outlined",size:"small",onClick:()=>window.open(E,"_blank"),children:"Open in New Tab"}),r.jsx(C,{variant:"outlined",size:"small",onClick:()=>{const o=document.createElement("a");o.href=E,o.download="document.pdf",o.click()},children:"Download"})]}),be?r.jsx(f,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${P.palette.divider}`,borderRadius:1},children:r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"PDF Preview Unavailable"}),r.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The PDF could not be displayed in the preview. Please use the buttons above to view or download the file."})]})}):r.jsx(f,{sx:{flex:1,border:`1px solid ${P.palette.divider}`,borderRadius:1,overflow:"hidden"},children:r.jsx("iframe",{src:`${E}#toolbar=1&navpanes=1&scrollbar=1`,title:"PDF Preview",width:"100%",height:"100%",style:{border:0},onError:()=>{re(!0)},onLoad:()=>{re(!1)}})})]}),F==="text"&&te&&r.jsx(f,{sx:{width:"100%",maxHeight:500,overflow:"auto",bgcolor:"background.default",p:2,borderRadius:2},children:r.jsx("pre",{style:{margin:0,fontFamily:"monospace",fontSize:14},children:te})}),F==="unsupported"&&r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Preview not available for this file type"}),r.jsx(C,{variant:"contained",onClick:()=>{const o=document.createElement("a");o.href=E,o.download="file",o.click()},children:"Download File"})]}),F==="error"&&r.jsxs(f,{sx:{textAlign:"center"},children:[r.jsxs(m,{color:"error",gutterBottom:!0,children:["Error loading file: ",we]}),r.jsx(C,{variant:"outlined",onClick:()=>window.open(E,"_blank"),children:"Try Opening in New Tab"})]})]}),r.jsx(X,{children:r.jsx(C,{onClick:()=>{T(!1),ee(null),O(null),V(""),G("")},children:"Close"})})]})]})};export{nr as C,or as F,Je as a,tr as b,rr as c,Ie as d,Ke as e,Oe as f,Ge as g,Qe as h,er as i,Ye as j,Ve as k,qe as l,He as m,We as n,Xe as p,Ze as v};
