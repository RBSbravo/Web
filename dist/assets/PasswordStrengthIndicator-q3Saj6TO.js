import{u as M,j as r,aa as A,a3 as $,bc as W,b as d,B as g,bd as E,af as L,y as _,be as U,I as C,z as V,W as F,b1 as Z,d as B,a9 as N,a8 as G,r as R,ab as T,bf as b,n as q,p as w,q as I}from"./mui-DaYlJXyD.js";import{r as k}from"./vendor-Cr2nE3UY.js";class H{constructor(){this.rateLimitInfo=null,this.retryTimers=new Map}handleRateLimitError(e){var s,i,o,a,u,f,l,x,y,c,m,h,j,P;if(((s=e.response)==null?void 0:s.status)===429||((i=e.message)==null?void 0:i.includes("429"))||((o=e.message)==null?void 0:o.includes("Too many requests"))||((a=e.message)==null?void 0:a.includes("rate limit"))){const p={error:((f=(u=e.response)==null?void 0:u.data)==null?void 0:f.error)||e.message||"Too many requests",retryAfter:((x=(l=e.response)==null?void 0:l.data)==null?void 0:x.retryAfter)||"15 minutes",limit:((c=(y=e.response)==null?void 0:y.headers)==null?void 0:c["ratelimit-limit"])||null,remaining:((h=(m=e.response)==null?void 0:m.headers)==null?void 0:h["ratelimit-remaining"])||null,reset:((P=(j=e.response)==null?void 0:j.headers)==null?void 0:P["ratelimit-reset"])||null};this.rateLimitInfo=p;const z=this.calculateRetryTime(p);return{isRateLimited:!0,message:p.error,retryAfter:p.retryAfter,retryTime:z,limit:p.limit,remaining:p.remaining,reset:p.reset,rateLimitData:p}}return{isRateLimited:!1}}calculateRetryTime(e){var t,s;if(!e)return 15*60*1e3;if(e.reset){const i=parseInt(e.reset)*1e3,o=Date.now();return Math.max(0,i-o)}if(e.retryAfter){const i=e.retryAfter.toLowerCase();if(i.includes("minute"))return parseInt(((t=i.match(/\d+/))==null?void 0:t[0])||"15")*60*1e3;if(i.includes("hour"))return parseInt(((s=i.match(/\d+/))==null?void 0:s[0])||"1")*60*60*1e3}return 15*60*1e3}formatRetryTime(e){const t=Math.ceil(e/6e4),s=Math.floor(t/60),i=t%60;return s>0?`${s}h ${i}m`:`${t}m`}getUserFriendlyMessage(e){if(!e||!e.error)return"Too many requests. Please try again later.";const t=this.calculateRetryTime(e),s=this.formatRetryTime(t),i=e.error.toLowerCase();return i.includes("authentication")||i.includes("login")?`Too many login attempts. Please try again in ${s}.`:i.includes("registration")||i.includes("register")?`Too many registration attempts. Please try again in ${s}.`:i.includes("password reset")?`Too many password reset attempts. Please try again in ${s}.`:`Too many requests. Please try again in ${s}.`}canRetry(e){const t=this.retryTimers.get(e);return t?Date.now()>=t:!0}setRetryTimer(e,t){this.retryTimers.set(e,Date.now()+t)}clearRetryTimer(e){this.retryTimers.delete(e)}getRemainingRetryTime(e){const t=this.retryTimers.get(e);return t?Math.max(0,t-Date.now()):0}reset(){this.rateLimitInfo=null,this.retryTimers.clear()}}const v=new H,Q=n=>{var t,s,i,o,a,u,f,l,x;console.log("handleApiError called with:",n);const e=v.handleRateLimitError(n);return e.isRateLimited?{type:"rate_limit",message:v.getUserFriendlyMessage(e),retryAfter:e.retryAfter,retryTime:e.retryTime,limit:e.limit,remaining:e.remaining,rateLimitData:e.rateLimitData}:((t=n.response)==null?void 0:t.status)===401?{type:"unauthorized",message:"Invalid credentials. Please check your email and password."}:((s=n.response)==null?void 0:s.status)===400?{type:"validation",message:((i=n.response.data)==null?void 0:i.error)||((o=n.response.data)==null?void 0:o.message)||"Invalid input. Please check your data."}:((a=n.response)==null?void 0:a.status)>=500?{type:"server_error",message:"Server error. Please try again later."}:n.response?(f=(u=n.response)==null?void 0:u.data)!=null&&f.error?{type:"api_error",message:n.response.data.error}:(x=(l=n.response)==null?void 0:l.data)!=null&&x.message?{type:"api_error",message:n.response.data.message}:{type:"unknown",message:n.message||"An unexpected error occurred."}:{type:"network_error",message:"Network error. Please check your connection and try again."}},X=({isOpen:n,onClose:e,rateLimitData:t,endpoint:s,onRetry:i})=>{const o=M(),[a,u]=k.useState(0),[f,l]=k.useState(100);k.useEffect(()=>{if(!n||!t){u(0),l(100);return}const c=v.calculateRetryTime(t),m=Math.max(c,1e3);let h=c;u(h),l(h/m*100);const j=setInterval(()=>{h-=1e3,u(Math.max(0,h));const P=Math.max(0,h/m*100);l(P),h<=0&&(clearInterval(j),u(0),l(0))},1e3);return()=>clearInterval(j)},[n,t]);const x=c=>{const m=Math.floor(c/6e4),h=Math.floor(c%6e4/1e3);return m>0?`${m}m ${h}s`:`${h}s`},y=()=>{a<=0&&(v.clearRetryTimer(s),i==null||i(),e==null||e())};return!n||!t?null:r.jsx(A,{in:n,children:r.jsxs($,{severity:"warning",icon:r.jsx(F,{}),sx:{mb:2,borderRadius:2,border:`1px solid ${o.palette.warning.main}`,backgroundColor:o.palette.mode==="dark"?"rgba(255, 152, 0, 0.1)":"rgba(255, 152, 0, 0.05)"},action:r.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[a<=0&&r.jsx(_,{size:"small",variant:"outlined",startIcon:r.jsx(U,{}),onClick:y,sx:{minWidth:"auto",textTransform:"none",fontSize:"0.75rem"},children:"Retry"}),r.jsx(C,{size:"small",onClick:e,sx:{color:o.palette.warning.main,"&:hover":{backgroundColor:"rgba(255, 152, 0, 0.1)"}},children:r.jsx(V,{fontSize:"small"})})]}),children:[r.jsx(W,{sx:{fontWeight:600},children:"Rate Limit Exceeded"}),r.jsx(d,{variant:"body2",sx:{mb:1},children:v.getUserFriendlyMessage(t)}),a>0&&r.jsxs(g,{sx:{mt:1},children:[r.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[r.jsx(E,{fontSize:"small",color:"warning"}),r.jsxs(d,{variant:"caption",color:"text.secondary",children:["Retry available in: ",x(a)]})]}),r.jsx(L,{variant:"determinate",value:f,sx:{height:4,borderRadius:2,backgroundColor:o.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:o.palette.warning.main}}})]}),a<=0&&r.jsx(g,{sx:{mt:1},children:r.jsx(d,{variant:"caption",color:"success.main",children:"âœ“ You can now retry your request"})}),t.limit&&r.jsxs(d,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:["Limit: ",t.limit," requests per ",t.retryAfter]})]})})};class Y{constructor(){this.minLength=8,this.maxLength=128,this.requireUppercase=!0,this.requireLowercase=!0,this.requireNumbers=!0,this.requireSpecialChars=!0,this.forbiddenPatterns=[/(.)\1{2,}/,/123|234|345|456|567|678|789|890/,/abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz/i,/qwerty|asdfgh|zxcvbn/i],this.commonPasswords=["password","123456","123456789","qwerty","abc123","password123","admin","letmein","welcome","monkey","1234567890","password1","qwerty123","dragon","master","hello","freedom","whatever","qazwsx","trustno1","jordan23","harley","ranger","hunter","buster","soccer","hockey","killer","george","sexy","andrew","charlie","superman","asshole","fuckyou","dallas","jessica","panties","pepper","1234","6969","killer","trust","jordan","jennifer","zxcvbn","asdf","dead","pass","fuck","6969","mustang","letmein","amanda","access","yankees","987654321","dallas","austin","thunder","taylor","matrix","mobilemail","mom","monitor","monitoring","montana","moon","moscow"]}validate(e){const t=[];if(!e)return t.push("Password is required"),{isValid:!1,errors:t};e.length<this.minLength&&t.push(`Password must be at least ${this.minLength} characters long`),e.length>this.maxLength&&t.push(`Password must be no more than ${this.maxLength} characters long`),this.requireUppercase&&!/[A-Z]/.test(e)&&t.push("Password must contain at least one uppercase letter"),this.requireLowercase&&!/[a-z]/.test(e)&&t.push("Password must contain at least one lowercase letter"),this.requireNumbers&&!/\d/.test(e)&&t.push("Password must contain at least one number"),this.requireSpecialChars&&!/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(e)&&t.push("Password must contain at least one special character (!@#$%^&*()_+-=[]{}|;:,.<>?)");for(const s of this.forbiddenPatterns)if(s.test(e)){s.source.includes("\\1")?t.push("Password cannot contain 3 or more consecutive identical characters"):s.source.includes("123|234")?t.push("Password cannot contain sequential numbers (123, 234, etc.)"):s.source.includes("abc|bcd")?t.push("Password cannot contain sequential letters (abc, bcd, etc.)"):s.source.includes("qwerty")&&t.push("Password cannot contain common keyboard patterns");break}return this.commonPasswords.includes(e.toLowerCase())&&t.push("Password is too common. Please choose a more unique password"),this.hasRepeatedSequence(e)&&t.push("Password contains repeated character sequences"),{isValid:t.length===0,errors:t,strength:this.calculateStrength(e)}}hasRepeatedSequence(e){for(let t=0;t<e.length-2;t++){const s=e.substring(t,t+3);if(e.substring(t+3).includes(s))return!0}return!1}calculateStrength(e){let t=0;e.length>=8&&(t+=10),e.length>=12&&(t+=10),e.length>=16&&(t+=5),/[a-z]/.test(e)&&(t+=10),/[A-Z]/.test(e)&&(t+=10),/\d/.test(e)&&(t+=10),/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(e)&&(t+=10);const s=new Set(e).size;return t+=Math.min(s*2,20),e.length>=8&&s>=6&&(t+=15),Math.min(t,100)}getStrengthDescription(e){return e<30?"Very Weak":e<50?"Weak":e<70?"Fair":e<90?"Good":"Strong"}getStrengthColor(e){return e<30?"error":e<50?"warning":e<70?"info":e<90?"primary":"success"}getSuggestions(e){const t=[];return e.some(s=>s.includes("at least"))&&t.push("Use a longer password with at least 8 characters"),e.some(s=>s.includes("uppercase"))&&t.push("Add uppercase letters (A-Z)"),e.some(s=>s.includes("lowercase"))&&t.push("Add lowercase letters (a-z)"),e.some(s=>s.includes("number"))&&t.push("Add numbers (0-9)"),e.some(s=>s.includes("special character"))&&t.push("Add special characters (!@#$%^&*()_+-=[]{}|;:,.<>?)"),e.some(s=>s.includes("consecutive"))&&t.push("Avoid repeating characters (aaa, 111, etc.)"),e.some(s=>s.includes("sequential"))&&t.push("Avoid sequential patterns (123, abc, etc.)"),e.some(s=>s.includes("common"))&&t.push("Choose a more unique password"),t}}const S=new Y,O=({password:n,showSuggestions:e=!0,defaultExpanded:t=!1})=>{const[s,i]=k.useState(t),o=S.validate(n||""),a=o.strength,u=o.errors,f=S.getSuggestions(u),l=()=>a<30?"error":a<50?"warning":a<70?"info":a<90?"primary":"success",x=()=>a<30?"Very Weak":a<50?"Weak":a<70?"Fair":a<90?"Good":"Strong",y=()=>[{label:"At least 8 characters",met:n&&n.length>=8,icon:n&&n.length>=8?T:b},{label:"Contains uppercase letter",met:n&&/[A-Z]/.test(n),icon:n&&/[A-Z]/.test(n)?T:b},{label:"Contains lowercase letter",met:n&&/[a-z]/.test(n),icon:n&&/[a-z]/.test(n)?T:b},{label:"Contains number",met:n&&/\d/.test(n),icon:n&&/\d/.test(n)?T:b},{label:"Contains special character",met:n&&/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(n),icon:n&&/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(n)?T:b}];return n?r.jsxs(g,{sx:{mt:2},children:[r.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[r.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(Z,{sx:{fontSize:16}}),r.jsx(d,{variant:"caption",color:"text.secondary",children:"Password Strength:"}),r.jsx(B,{label:x(),color:l(),size:"small",sx:{fontWeight:500}})]}),r.jsx(C,{size:"small",onClick:()=>i(!s),sx:{p:.5},children:s?r.jsx(N,{}):r.jsx(G,{})})]}),r.jsx(L,{variant:"determinate",value:a,color:l(),sx:{height:6,borderRadius:3,backgroundColor:"rgba(0,0,0,0.1)",mb:1,"& .MuiLinearProgress-bar":{borderRadius:3}}}),r.jsxs(d,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"right"},children:[a,"% strength"]}),r.jsx(A,{in:s,children:r.jsxs(g,{sx:{mt:2},children:[r.jsxs(g,{sx:{mb:2},children:[r.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:"Requirements:"}),r.jsx(R,{dense:!0,sx:{py:0},children:y().map((c,m)=>r.jsxs(q,{sx:{py:.25,px:0},children:[r.jsx(w,{sx:{minWidth:24},children:r.jsx(c.icon,{sx:{fontSize:16,color:c.met?"success.main":"error.main"}})}),r.jsx(I,{primary:r.jsx(d,{variant:"caption",sx:{color:c.met?"success.main":"error.main",fontWeight:c.met?500:400},children:c.label})})]},m))})]}),e&&f.length>0&&r.jsxs(g,{children:[r.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:"Suggestions:"}),r.jsx(R,{dense:!0,sx:{py:0},children:f.map((c,m)=>r.jsxs(q,{sx:{py:.25,px:0},children:[r.jsx(w,{sx:{minWidth:24},children:r.jsx(b,{sx:{fontSize:16,color:"warning.main"}})}),r.jsx(I,{primary:r.jsx(d,{variant:"caption",color:"warning.main",children:c})})]},m))})]})]})})]}):r.jsx(g,{sx:{mt:1},children:r.jsx(d,{variant:"caption",color:"text.secondary",children:"Enter a password to see strength indicator"})})};export{O as P,X as R,Q as h,S as p,v as r};
