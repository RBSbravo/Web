import{r as u,u as Ce,j as e,am as H,B as c,aX as ut,b as a,I as J,aY as gt,ac as jt,ab as rt,ad as ft,a7 as b,aw as Ue,ax as Me,ay as He,m as P,av as ne,v as _e,w as Ve,a1 as he,x as Ge,a6 as Je,Y as Ye,V as Xe,ap as Qe,e as Ze,aZ as et,k as De,J as yt,a_ as bt,a$ as St,b0 as wt,z as Z,b1 as kt,b2 as Dt,an as Ct,b3 as vt,b4 as Rt,y as qe,a8 as L,a9 as N,d as T,aC as K,aD as Y,aE as X,aF as $,aG as i,aH as Q,K as It,a4 as At,Z as Le,aI as Wt,G as Tt,H as zt,h as M,ar as tt,b5 as Ne,P as st,E as Ft,W as $t,a5 as Bt}from"./mui-DmyK1VYO.js";import{h as Ot,g as Lt,r as xe,U as Nt}from"./index--146V-zv.js";import{P as Et}from"./PageHeader-DsP3YEjW.js";import"./vendor-Ckhrjn13.js";import"./router-ViNET1Ki.js";const Pt=(l,g)=>!g||g.role==="admin"?l:g.role==="department_head"?l.filter(x=>x.parameters?.departmentId===g.departmentId||x.createdBy===g.id):l.filter(x=>x.createdBy===g.id),Ut=(l,g,x)=>{const f=Pt(l,x);switch(g){case 0:return f;case 1:{const k=new Date;return k.setDate(k.getDate()-7),f.filter(R=>new Date(R.createdAt)>=k)}case 2:return f.filter(k=>k.type==="department");default:return f}},Ee=(l=[])=>({title:"",description:"",type:"task",parameters:{startDate:"",endDate:"",departmentId:l[0]?.id||"",userId:"",selectedFields:[]}}),Pe={taskMetrics:[{key:"totalTasks",label:"Total Tasks"},{key:"pendingTasks",label:"Pending Tasks"},{key:"inProgressTasks",label:"In Progress Tasks"},{key:"completedTasks",label:"Completed Tasks"},{key:"overdueTasks",label:"Overdue Tasks"},{key:"taskCompletionRate",label:"Task Completion Rate"},{key:"averageTaskCompletionTime",label:"Average Task Completion Time"}],ticketMetrics:[{key:"totalTickets",label:"Total Tickets"},{key:"pendingTickets",label:"Pending Tickets"},{key:"inProgressTickets",label:"In Progress Tickets"},{key:"completedTickets",label:"Completed Tickets"},{key:"declinedTickets",label:"Declined Tickets"},{key:"ticketResolutionRate",label:"Ticket Resolution Rate"},{key:"averageTicketResolutionTime",label:"Average Ticket Resolution Time"},{key:"priorityDistribution",label:"Priority Distribution"}]},Mt=l=>{const g=[];return l.title?.trim()||g.push("Report title is required"),l.type||g.push("Report type is required"),l.type==="custom"&&(!l.parameters?.selectedFields||l.parameters.selectedFields.length===0)&&g.push("At least one field must be selected for custom reports"),g},Ht=(l=null)=>{const[g,x]=u.useState([]),[f,k]=u.useState(!0),[R,S]=u.useState(null),[r,w]=u.useState(null),[t,s]=u.useState("success"),[d,m]=u.useState(!1),[_,U]=u.useState(!1),[j,B]=u.useState(Ee()),[z,O]=u.useState(0),[o,I]=u.useState("all"),[C,V]=u.useState("all"),[ie,ve]=u.useState(""),[ae,Re]=u.useState(""),[Ie,Ae]=u.useState(!1),[me,pe]=u.useState(!1),[le,q]=u.useState(null),[We,ue]=u.useState(null),[Te,ge]=u.useState(!1),[ze,je]=u.useState(!1),[fe,ee]=u.useState(null),[te,ye]=u.useState(!1),[Fe,be]=u.useState(""),[Se,$e]=u.useState(""),[oe,we]=u.useState([]),[n,W]=u.useState([]),[F,G]=u.useState(""),[se,Be]=u.useState(""),[E,Ke]=u.useState(l),Oe=E?.role==="admin"||E?.role==="department_head";u.useEffect(()=>{l&&Ke(l)},[l]),u.useEffect(()=>{ke(),Oe&&nt()},[Oe]);const nt=async()=>{try{const[h,p]=await Promise.all([Ot.getAll(),Lt.getAll()]),v=E?.departmentId||E?.department_id||E?.department?.id,D=(h.data||[]).filter(y=>(y.departmentId||y.department_id||y.department?.id)===v);!D.find(y=>y.id===E?.id)&&E?.id&&D.unshift(E),we(D),W(p.data||[])}catch(h){console.error("Error loading admin data:",h)}},ke=u.useCallback(async()=>{if(!d){m(!0),k(!0);try{const h=await xe.listReports(),p=Array.isArray(h.data)?h.data:[],v=new Map;p.forEach(y=>v.set(y.id,y));const D=new Map;p.forEach(y=>{const re=JSON.stringify(y.parameters||{}),ce=`${y.title||y.name||""}::${y.type||""}::${y.createdBy||""}::${re}`,A=D.get(ce);(!A||new Date(y.createdAt)>new Date(A.createdAt))&&D.set(ce,y)});const de=Array.from(D.values());x(y=>{const re=new Set(y.map(A=>`${A.title||A.name||""}::${A.type||""}::${A.createdBy||""}::${JSON.stringify(A.parameters||{})}`)),ce=new Set(de.map(A=>`${A.title||A.name||""}::${A.type||""}::${A.createdBy||""}::${JSON.stringify(A.parameters||{})}`));return re.size===ce.size&&[...re].every(A=>ce.has(A))?y:de}),S(null)}catch(h){console.error("Error fetching reports:",h),S("Failed to load reports.")}finally{k(!1),m(!1)}}},[d]),it=h=>{const{name:p,value:v}=h.target;B(D=>({...D,[p]:v}))},at=async()=>{je(!0),S(null);try{if(!j.title?.trim()){S("Report name is required."),k(!1);return}const h=E?.departmentId||E?.department_id||E?.department?.id;if(!h){S("User information not available. Please refresh the page."),k(!1);return}const p={name:j.title.trim(),description:j.description||"",type:j.type,parameters:{...j.parameters,departmentId:h,...j.type==="user"&&F&&{userId:F},...j.type!=="department"&&j.type!=="ticket"&&se&&{selectedDepartmentId:se}}};console.log("newReport.parameters:",j.parameters),console.log("selectedDepartmentId:",se),console.log("Sending report data:",p),await xe.createReport(p),await ke(),w("Report generated successfully"),s("success"),B(Ee()),U(!1),G(""),Be("")}catch(h){console.error("Error creating report:",h),console.error("Error response:",h.response?.data),console.error("Error status:",h.response?.status);let p="Failed to create report.";if(h.response?.data?.errors){const v=h.response.data.errors.map(D=>D.msg).join(", ");p=`Validation errors: ${v}`,console.error("Validation errors:",v)}else h.response?.data?.error&&(p=h.response.data.error,console.error("Backend error:",h.response.data.error));S(p),w(p),s("error")}finally{je(!1)}},lt=async h=>{ee(h),S(null);try{await xe.deleteReport(h),await ke(),w("Report deleted successfully"),s("success")}catch(p){console.error("Error deleting report:",p),S("Failed to delete report."),w("Failed to delete report."),s("error")}finally{ee(null)}},ot=async h=>{ge(!0),q(h),pe(!0);try{const p=await xe.getReport(h.id);let v=p.data;p.data&&p.data.report&&p.data.data?v={...p.data.report,metrics:p.data.data,filtersApplied:p.data.data.filtersApplied||p.data.report.filtersApplied}:p.data&&p.data.report&&(v=p.data.report),ue(v)}catch(p){console.error("Error loading report details:",p),S("Failed to load report details.")}finally{ge(!1)}},dt=async h=>{console.log("Edit report:",h)},ct=()=>{U(!1),B(Ee()),G(""),Be("")},xt=()=>{pe(!1),q(null),ue(null)},ht=async(h,p=null,v="pdf")=>{try{const D=await xe.exportReport(h.id,v),de=window.URL.createObjectURL(new Blob([D.data])),y=document.createElement("a");if(y.href=de,p)y.setAttribute("download",p);else{const re=v==="excel"?"xlsx":v==="pdf"?"pdf":"csv";y.setAttribute("download",`report-${h.id}.${re}`)}document.body.appendChild(y),y.click(),y.parentNode.removeChild(y)}catch(D){console.error("Error downloading report:",D),S("Failed to download report.")}},mt=g.filter(h=>{const p=o==="all"||h.type?.toLowerCase()===o,v=C==="all"||h.status===C;let D=!0;return ie&&(D=D&&new Date(h.createdAt)>=new Date(ie)),ae&&(D=D&&new Date(h.createdAt)<=new Date(ae)),p&&v&&D}),pt=Ut(g,z,E);return{reports:mt,tabReports:pt,loading:f,error:R,isNewReportDialogOpen:_,newReport:j,activeTab:z,viewDialogOpen:me,selectedReport:le,reportData:We,reportLoading:Te,isCreatingReport:ze,deletingReportId:fe,message:r,messageSeverity:t,isAdmin:Oe,users:oe,departments:n,selectedUserId:F,selectedDepartmentId:se,showFilters:Ie,filterType:o,filterStatus:C,filterStartDate:ie,filterEndDate:ae,showDeptSummaryFilters:te,deptSummaryStartDate:Fe,deptSummaryEndDate:Se,setActiveTab:O,setIsNewReportDialogOpen:U,handleNewReportChange:it,handleAddReport:at,handleDeleteReport:lt,handleViewReport:ot,handleEditReport:dt,handleCloseNewReportDialog:ct,handleCloseViewDialog:xt,handleDownloadReport:ht,setSelectedUserId:G,setSelectedDepartmentId:Be,setShowFilters:Ae,setFilterType:I,setFilterStatus:V,setFilterStartDate:ve,setFilterEndDate:Re,setShowDeptSummaryFilters:ye,setDeptSummaryStartDate:be,setDeptSummaryEndDate:$e,loadReports:ke,setUser:Ke,setMessage:w}},_t=({showFilters:l,setShowFilters:g,filterType:x,setFilterType:f,filterStartDate:k,setFilterStartDate:R,filterEndDate:S,setFilterEndDate:r})=>{const w=Ce(),t=()=>{f("all"),R(""),r("")},s=x!=="all"||k||S;return e.jsxs(H,{sx:{mb:3,borderRadius:2,overflow:"hidden"},children:[e.jsxs(c,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:l?`1px solid ${w.palette.divider}`:"none"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ut,{sx:{color:w.palette.primary.main}}),e.jsxs(a,{sx:{fontWeight:600,color:w.palette.text.primary},children:["Filters",s&&e.jsx(c,{component:"span",sx:{ml:1,px:1,py:.25,bgcolor:w.palette.primary.main,color:"white",borderRadius:1,fontSize:"0.75rem",fontWeight:600},children:"Active"})]})]}),e.jsxs(c,{sx:{display:"flex",gap:1},children:[s&&e.jsx(J,{size:"small",onClick:t,sx:{color:w.palette.error.main,"&:hover":{bgcolor:w.palette.error.light}},children:e.jsx(gt,{fontSize:"small"})}),e.jsx(J,{size:"small",onClick:()=>g(!l),sx:{color:w.palette.primary.main,"&:hover":{bgcolor:w.palette.primary.light}},children:l?e.jsx(jt,{}):e.jsx(rt,{})})]})]}),e.jsx(ft,{in:l,children:e.jsx(c,{sx:{p:2,bgcolor:w.palette.background.paper},children:e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Ue,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Report Type"}),e.jsxs(He,{value:x,label:"Report Type",onChange:d=>f(d.target.value),children:[e.jsx(P,{value:"all",children:"All Types"}),e.jsx(P,{value:"ticket",children:"Ticket Reports"}),e.jsx(P,{value:"task",children:"Task Reports"}),e.jsx(P,{value:"user",children:"User Reports"}),e.jsx(P,{value:"department",children:"Department Reports"}),e.jsx(P,{value:"custom",children:"Custom Reports"})]})]})}),e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{fullWidth:!0,size:"small",label:"Start Date",type:"date",value:k,onChange:d=>R(d.target.value),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:1}}})}),e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ne,{fullWidth:!0,size:"small",label:"End Date",type:"date",value:S,onChange:d=>r(d.target.value),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:1}}})})]})})})]})},Vt=({open:l,onClose:g,newReport:x,onNewReportChange:f,onAddReport:k,loading:R,users:S,selectedUserId:r,onSelectedUserIdChange:w})=>{const t=Ce(),[s,d]=u.useState([]),[m,_]=u.useState([]);u.useEffect(()=>{x.type==="custom"?d(x.parameters?.selectedFields||[]):d([])},[x.type,x.parameters?.selectedFields]);const U=o=>{const I=s.includes(o)?s.filter(C=>C!==o):[...s,o];d(I),f({target:{name:"parameters",value:{...x.parameters,selectedFields:I}}})},j=o=>{const I=Pe[o].map(V=>V.key),C=[...new Set([...s,...I])];d(C),f({target:{name:"parameters",value:{...x.parameters,selectedFields:C}}})},B=o=>{const I=Pe[o].map(V=>V.key),C=s.filter(V=>!I.includes(V));d(C),f({target:{name:"parameters",value:{...x.parameters,selectedFields:C}}})},z=()=>{const o=Mt(x);if(x.type==="user"&&!r&&o.push("User selection is required for user reports"),o.length>0){_(o);return}_([]),k()},O=o=>{switch(o){case"ticket":return e.jsx(Xe,{color:"error"});case"task":return e.jsx(Ye,{color:"primary"});case"user":return e.jsx(Qe,{color:"secondary"});case"department":return e.jsx(Ze,{color:"info"});case"custom":return e.jsx(et,{color:"default"});default:return e.jsx(he,{})}};return e.jsxs(_e,{open:l,onClose:g,maxWidth:"md",fullWidth:!0,children:[e.jsxs(Ve,{sx:{borderBottom:`1px solid ${t.palette.divider}`,pb:3,pt:3,px:4,display:"flex",alignItems:"center",gap:2},children:[e.jsx(he,{sx:{color:t.palette.primary.main,fontSize:28}}),e.jsx(c,{sx:{fontWeight:600,fontSize:"1.25rem"},children:"Generate New Report"})]}),e.jsxs(Ge,{sx:{pt:4,pb:3,px:4},children:[m.length>0&&e.jsx(Je,{severity:"error",sx:{mb:3},children:e.jsx(a,{variant:"body2",children:m.join(", ")})}),e.jsxs(b,{container:!0,spacing:3,children:[e.jsx(b,{item:!0,xs:12,sx:{mt:2},children:e.jsxs(Ue,{fullWidth:!0,children:[e.jsx(Me,{sx:{fontSize:"0.875rem",fontWeight:500},children:"Report Type"}),e.jsxs(He,{label:"Report Type",name:"type",value:x.type,onChange:f,sx:{borderRadius:2},children:[e.jsx(P,{value:"task",children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ye,{color:"primary"}),"Task Reports"]})}),e.jsx(P,{value:"ticket",children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xe,{color:"error"}),"Ticket Reports"]})}),e.jsx(P,{value:"user",children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qe,{color:"secondary"}),"User Reports"]})}),e.jsx(P,{value:"department",children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{color:"info"}),"Department Reports"]})}),e.jsx(P,{value:"custom",children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(et,{color:"default"}),"Custom Reports"]})})]})]})}),x.type==="user"&&e.jsx(b,{item:!0,xs:12,md:6,children:e.jsxs(Ue,{fullWidth:!0,children:[e.jsx(Me,{sx:{fontSize:"0.875rem",fontWeight:500},children:"Select User"}),e.jsx(He,{label:"Select User",value:r,onChange:o=>w(o.target.value),sx:{borderRadius:2},children:S.map(o=>e.jsx(P,{value:o.id,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(De,{sx:{width:24,height:24,fontSize:"0.75rem"},children:[o.firstname?.[0],o.lastname?.[0]]}),o.firstname," ",o.lastname]})},o.id))})]})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(ne,{fullWidth:!0,label:"Report Title",name:"title",value:x.title,onChange:f,required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(ne,{fullWidth:!0,label:"Description",name:"description",value:x.description,onChange:f,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(ne,{fullWidth:!0,label:"Start Date",type:"date",name:"startDate",value:x.parameters?.startDate||"",onChange:o=>f({target:{name:"parameters",value:{...x.parameters,startDate:o.target.value}}}),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(ne,{fullWidth:!0,label:"End Date",type:"date",name:"endDate",value:x.parameters?.endDate||"",onChange:o=>f({target:{name:"parameters",value:{...x.parameters,endDate:o.target.value}}}),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),x.type==="custom"&&e.jsxs(b,{item:!0,xs:12,children:[e.jsx(yt,{sx:{my:2}}),e.jsx(a,{variant:"h6",sx:{mb:2},children:"Select Fields to Include"}),Object.entries(Pe).map(([o,I])=>e.jsxs(bt,{defaultExpanded:!0,children:[e.jsx(St,{expandIcon:e.jsx(rt,{}),children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[O(o.replace("Metrics","")),e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600},children:o.replace("Metrics"," Metrics")})]})}),e.jsxs(wt,{children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(Z,{size:"small",onClick:()=>j(o),children:"Select All"}),e.jsx(Z,{size:"small",onClick:()=>B(o),children:"Deselect All"})]}),e.jsx(kt,{children:I.map(C=>e.jsx(Dt,{control:e.jsx(Ct,{checked:s.includes(C.key),onChange:()=>U(C.key),icon:e.jsx(Rt,{}),checkedIcon:e.jsx(vt,{})}),label:C.label},C.key))})]})]},o))]})]})]}),e.jsxs(qe,{sx:{p:3,pt:2,borderTop:`1px solid ${t.palette.divider}`,gap:2,justifyContent:"flex-end"},children:[e.jsx(Z,{onClick:g,disabled:R,variant:"outlined",sx:{borderRadius:2,px:3,py:1},children:"Cancel"}),e.jsx(Z,{onClick:z,variant:"contained",disabled:R,startIcon:e.jsx(he,{}),sx:{borderRadius:2,px:3,py:1,fontWeight:600},children:R?"Generating...":"Generate Report"})]})]})},Gt=({report:l})=>{const g=Ce(),x=t=>{switch(t?.toLowerCase()){case"completed":case"resolved":return"success";case"pending":return"warning";case"in_progress":case"in progress":return"info";case"declined":case"overdue":return"error";default:return"default"}},f=t=>{switch(t?.toLowerCase()){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"success";default:return"default"}},k=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}},R=t=>typeof t=="number"?t.toLocaleString():typeof t=="object"&&t!==null?Array.isArray(t)?t.length.toString():Object.keys(t).length.toString():typeof t=="string"?t:String(t||"N/A"),S=t=>t.replace(/([A-Z])/g," $1").trim().replace(/^./,s=>s.toUpperCase()),r=l?.data||l?.metrics||{},w=l?.report||l;return console.log("Report structure:",l),console.log("ReportInfo:",w),console.log("FiltersApplied:",w?.filtersApplied),e.jsx(c,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs(c,{sx:{flex:1,overflow:"auto",p:3},children:[(w?.filtersApplied||l?.filtersApplied)&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Filters Applied"}),e.jsx(b,{container:!0,spacing:2,children:Object.entries(w.filtersApplied||l.filtersApplied).map(([t,s])=>{let d="";return typeof s=="string"?d=s:typeof s=="number"?d=s.toString():typeof s=="object"&&s!==null?Array.isArray(s)?d=s.join(", "):d=JSON.stringify(s):d=String(s||"N/A"),e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:S(t)}),e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:d})]})},t)})})]})}),r?.summary&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Summary"}),e.jsx(b,{container:!0,spacing:2,children:Object.entries(r.summary).map(([t,s])=>e.jsx(b,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(c,{sx:{textAlign:"center"},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,color:g.palette.primary.main},children:R(s)}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:S(t)})]})},t))})]})}),(r?.statusBreakdown||r?.priorityBreakdown)&&e.jsxs(b,{container:!0,spacing:3,sx:{mb:3},children:[r.statusBreakdown&&e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(L,{children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Status Breakdown"}),r.statusBreakdown.map((t,s)=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(T,{label:t.status,color:x(t.status),size:"small",variant:"outlined"}),e.jsxs(a,{variant:"body2",children:[t.count," (",t.percentage,"%)"]})]},s))]})})}),r.priorityBreakdown&&e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(L,{children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Priority Breakdown"}),r.priorityBreakdown.map((t,s)=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(T,{label:t.priority,color:f(t.priority),size:"small",variant:"outlined"}),e.jsx(a,{variant:"body2",children:t.count})]},s))]})})})]}),(r?.userProfile||r?.departmentProfile)&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:r.userProfile?"User Profile":"Department Profile"}),e.jsx(b,{container:!0,spacing:2,children:Object.entries(r.userProfile||r.departmentProfile).map(([t,s])=>{let d="";return typeof s=="string"?d=s:typeof s=="number"?d=s.toString():typeof s=="object"&&s!==null?Array.isArray(s)?d=s.join(", "):d=JSON.stringify(s):d=String(s||"N/A"),e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:S(t)}),e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:d})]})},t)})})]})}),l?.type==="custom"&&r?.customMetrics&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Custom Metrics"}),e.jsx(b,{container:!0,spacing:2,children:Object.entries(r.customMetrics).map(([t,s])=>e.jsx(b,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(c,{sx:{textAlign:"center"},children:[e.jsx(a,{variant:"h5",sx:{fontWeight:700,color:g.palette.primary.main},children:R(s)}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:S(t)})]})},t))})]})}),r?.details&&r.details.length>0&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Details"}),e.jsx(K,{component:H,sx:{maxHeight:400},children:e.jsxs(Y,{stickyHeader:!0,children:[e.jsx(X,{children:e.jsx($,{children:Object.keys(r.details[0]).map(t=>e.jsx(i,{sx:{fontWeight:600,textTransform:"capitalize"},children:S(t)},t))})}),e.jsx(Q,{children:r.details.map((t,s)=>e.jsx($,{children:Object.entries(t).map(([d,m])=>e.jsx(i,{children:d.toLowerCase().includes("status")?e.jsx(T,{label:m,color:x(m),size:"small",variant:"outlined"}):d.toLowerCase().includes("priority")?e.jsx(T,{label:m,color:f(m),size:"small",variant:"outlined"}):d.toLowerCase().includes("date")?k(m):m||"N/A"},d))},s))})]})})]})}),r?.activity&&r.activity.length>0&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Activity"}),e.jsx(K,{component:H,sx:{maxHeight:400},children:e.jsxs(Y,{stickyHeader:!0,children:[e.jsx(X,{children:e.jsx($,{children:Object.keys(r.activity[0]).map(t=>e.jsx(i,{sx:{fontWeight:600,textTransform:"capitalize"},children:S(t)},t))})}),e.jsx(Q,{children:r.activity.map((t,s)=>e.jsx($,{children:Object.entries(t).map(([d,m])=>e.jsx(i,{children:d.toLowerCase().includes("status")?e.jsx(T,{label:m,color:x(m),size:"small",variant:"outlined"}):d.toLowerCase().includes("priority")?e.jsx(T,{label:m,color:f(m),size:"small",variant:"outlined"}):d.toLowerCase().includes("date")?k(m):m||"N/A"},d))},s))})]})})]})}),l?.type==="custom"&&e.jsxs(e.Fragment,{children:[r?.tasks&&r.tasks.length>0&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Tasks (",r.tasks.length,")"]}),e.jsx(K,{component:H,sx:{maxHeight:400},children:e.jsxs(Y,{stickyHeader:!0,children:[e.jsx(X,{children:e.jsxs($,{children:[e.jsx(i,{sx:{fontWeight:600},children:"Title"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Priority"}),e.jsx(i,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(i,{sx:{fontWeight:600},children:"Created"})]})}),e.jsx(Q,{children:r.tasks.slice(0,10).map((t,s)=>e.jsxs($,{children:[e.jsx(i,{children:t.title}),e.jsx(i,{children:e.jsx(T,{label:t.status,color:x(t.status),size:"small"})}),e.jsx(i,{children:e.jsx(T,{label:t.priority||"Medium",color:f(t.priority),size:"small"})}),e.jsx(i,{children:t.taskAssignee?`${t.taskAssignee.firstname} ${t.taskAssignee.lastname}`:"Unassigned"}),e.jsx(i,{children:k(t.createdAt)})]},s))})]})}),r.tasks.length>10&&e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.tasks.length," tasks"]})]})}),r?.tickets&&r.tickets.length>0&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Tickets (",r.tickets.length,")"]}),e.jsx(K,{component:H,sx:{maxHeight:400},children:e.jsxs(Y,{stickyHeader:!0,children:[e.jsx(X,{children:e.jsxs($,{children:[e.jsx(i,{sx:{fontWeight:600},children:"Title"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Priority"}),e.jsx(i,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(i,{sx:{fontWeight:600},children:"Created"})]})}),e.jsx(Q,{children:r.tickets.slice(0,10).map((t,s)=>e.jsxs($,{children:[e.jsx(i,{children:t.title}),e.jsx(i,{children:e.jsx(T,{label:t.status,color:x(t.status),size:"small"})}),e.jsx(i,{children:e.jsx(T,{label:t.priority||"Medium",color:f(t.priority),size:"small"})}),e.jsx(i,{children:t.ticketAssignee?`${t.ticketAssignee.firstname} ${t.ticketAssignee.lastname}`:"Unassigned"}),e.jsx(i,{children:k(t.createdAt)})]},s))})]})}),r.tickets.length>10&&e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.tickets.length," tickets"]})]})}),r?.users&&r.users.length>0&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Users (",r.users.length,")"]}),e.jsx(K,{component:H,sx:{maxHeight:400},children:e.jsxs(Y,{stickyHeader:!0,children:[e.jsx(X,{children:e.jsxs($,{children:[e.jsx(i,{sx:{fontWeight:600},children:"Name"}),e.jsx(i,{sx:{fontWeight:600},children:"Email"}),e.jsx(i,{sx:{fontWeight:600},children:"Role"}),e.jsx(i,{sx:{fontWeight:600},children:"Department"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"})]})}),e.jsx(Q,{children:r.users.slice(0,10).map((t,s)=>e.jsxs($,{children:[e.jsx(i,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(De,{sx:{width:24,height:24,fontSize:"0.75rem"},children:[t.firstname?.[0],t.lastname?.[0]]}),t.firstname," ",t.lastname]})}),e.jsx(i,{children:t.email}),e.jsx(i,{children:e.jsx(T,{label:t.role,color:t.role==="admin"?"error":t.role==="department_head"?"warning":"default",size:"small"})}),e.jsx(i,{children:t.department?.name||"N/A"}),e.jsx(i,{children:e.jsx(T,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"default",size:"small"})})]},s))})]})}),r.users.length>10&&e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.users.length," users"]})]})}),r?.departments&&r.departments.length>0&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Departments (",r.departments.length,")"]}),e.jsx(K,{component:H,sx:{maxHeight:400},children:e.jsxs(Y,{stickyHeader:!0,children:[e.jsx(X,{children:e.jsxs($,{children:[e.jsx(i,{sx:{fontWeight:600},children:"Name"}),e.jsx(i,{sx:{fontWeight:600},children:"Description"}),e.jsx(i,{sx:{fontWeight:600},children:"Employees"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"})]})}),e.jsx(Q,{children:r.departments.slice(0,10).map((t,s)=>e.jsxs($,{children:[e.jsx(i,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{color:"info"}),t.name]})}),e.jsx(i,{children:t.description||"N/A"}),e.jsx(i,{children:t.users?.length||0}),e.jsx(i,{children:e.jsx(T,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"default",size:"small"})})]},s))})]})}),r.departments.length>10&&e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.departments.length," departments"]})]})})]}),r?.insights&&Object.keys(r.insights).length>0&&e.jsx(L,{sx:{mb:3},children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Insights"}),e.jsx(b,{container:!0,spacing:3,children:Object.entries(r.insights).map(([t,s])=>{const d=t.replace(/([A-Z])/g," $1").trim().replace(/^./,j=>j.toUpperCase());let m="",_=!1,U=!1;if((t.toLowerCase().includes("rate")||t.toLowerCase().includes("percentage")||t.toLowerCase().includes("compliance"))&&(_=!0),(t.toLowerCase().includes("time")||t.toLowerCase().includes("duration"))&&(U=!0),Array.isArray(s))s.length===0?m="No data":s.every(j=>typeof j=="object")?m=s.map(j=>{if(typeof j=="object"&&j!==null){const B=Object.entries(j);if(B.length===2){const[z,O]=B;if(typeof O=="object"&&O!==null){const o=Object.entries(O);if(o.length>0)return`${z}: ${o.map(([I,C])=>`${I}: ${C}`).join(", ")}`}return`${z}: ${O}`}return JSON.stringify(j)}return String(j)}).join("; "):m=s.join(", ");else if(typeof s=="object"&&s!==null){const j=Object.entries(s);j.length===0?m="No data":j.length<=3?m=j.map(([B,z])=>{if(typeof z=="object"&&z!==null){const O=Object.entries(z);if(O.length>0)return`${B}: ${O.map(([o,I])=>`${o}: ${I}`).join(", ")}`}return`${B}: ${z}`}).join("; "):m=`${j.length} items`}else typeof s=="number"?_?m=`${s.toFixed(1)}%`:U?s<1?m=`${(s*24).toFixed(1)} hours`:m=`${s.toFixed(1)} days`:m=s.toLocaleString():typeof s=="string"?m=s:s==null?m="N/A":m=String(s);return e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{sx:{p:2,border:`1px solid ${g.palette.divider}`,borderRadius:2,backgroundColor:g.palette.background.paper,height:"100%"},children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1,fontWeight:500},children:d}),e.jsx(a,{variant:"body1",sx:{fontWeight:600,color:g.palette.primary.main,wordBreak:"break-word",lineHeight:1.4},children:m})]})},t)})})]})})]})})},Xt=()=>{const l=Ce(),{user:g}=It.useContext(Nt),x=At(l.breakpoints.down("md")),{reports:f,loading:k,error:R,isNewReportDialogOpen:S,newReport:r,activeTab:w,viewDialogOpen:t,selectedReport:s,reportData:d,reportLoading:m,isCreatingReport:_,deletingReportId:U,message:j,messageSeverity:B,users:z,selectedUserId:O,showFilters:o,filterType:I,filterStatus:C,filterStartDate:V,filterEndDate:ie,setActiveTab:ve,setIsNewReportDialogOpen:ae,handleNewReportChange:Re,handleAddReport:Ie,handleDeleteReport:Ae,handleViewReport:me,handleCloseNewReportDialog:pe,handleCloseViewDialog:le,handleDownloadReport:q,setSelectedUserId:We,setShowFilters:ue,setFilterType:Te,setFilterStatus:ge,setFilterStartDate:ze,setFilterEndDate:je,setMessage:fe}=Ht(g),[ee,te]=u.useState(null);if(!g)return e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Le,{})});const ye=n=>{te(n)},Fe=async()=>{ee&&(await Ae(ee),te(null))},be=n=>({ticket:"primary",task:"secondary",user:"success",department:"warning",custom:"info"})[n]||"default",Se=n=>({ticket:"ðŸŽ«",task:"ðŸ“‹",user:"ðŸ‘¤",department:"ðŸ¢",custom:"ðŸ“Š"})[n]||"ðŸ“„",$e=n=>({ticket:"Ticket Report",task:"Task Report",user:"User Report",department:"Department Report",custom:"Custom Report"})[n]||"Report",oe=n=>{const{type:W,parameters:F,title:G}=n;switch(W){case"user":return F?.userName||we(G,"User Report -")||"User Report";case"department":return F?.departmentName||we(G,"Department Report -")||"Department Report";case"task":case"ticket":return F?.global?"All Departments":"Filtered";case"custom":return"Custom Scope";default:return"N/A"}},we=(n,W)=>{if(!n||!n.includes(W))return null;const F=n.match(new RegExp(`${W} (.+?) -`));return F?F[1]:null};return k?e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Le,{})}):e.jsxs(c,{sx:{p:{xs:2,md:4},backgroundColor:l.palette.background.default,minHeight:"100vh"},children:[e.jsx(Et,{title:"Reports",subtitle:"Generate and manage comprehensive reports",emoji:"ðŸ“Š",color:"secondary",actionButton:{icon:e.jsx(Wt,{}),text:"Generate Report",onClick:()=>ae(!0),disabled:k}}),R&&e.jsx(Je,{severity:"error",sx:{mb:2},children:R}),e.jsx(H,{sx:{mb:3,borderRadius:2},children:e.jsx(Tt,{value:w,onChange:(n,W)=>ve(W),indicatorColor:"primary",textColor:"primary",variant:"fullWidth",sx:{"& .MuiTab-root":{fontWeight:600,fontSize:{xs:"0.875rem",sm:"1rem"},minHeight:{xs:48,sm:56}}},children:e.jsx(zt,{label:"All Reports"})})}),e.jsx(_t,{showFilters:o,setShowFilters:ue,filterType:I,setFilterType:Te,filterStartDate:V,setFilterStartDate:ze,filterEndDate:ie,setFilterEndDate:je,filterStatus:C,setFilterStatus:ge}),f.length===0?e.jsxs(c,{sx:{p:4,textAlign:"center",color:"text.secondary"},children:[e.jsx(he,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(a,{variant:"h6",sx:{mb:1},children:"No reports found"}),e.jsx(a,{variant:"body2",children:"Generate your first report to get started."})]}):e.jsx(e.Fragment,{children:x?e.jsx(c,{sx:{display:"flex",flexDirection:"column",gap:2},children:f.map(n=>e.jsxs(H,{sx:{p:2,borderRadius:2,boxShadow:1,transition:"all 0.2s","&:hover":{boxShadow:3,transform:"translateY(-2px)"}},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(De,{sx:{bgcolor:"primary.main",width:40,height:40},children:Se(n.type)}),e.jsxs(c,{children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600},children:n.title||n.name||"Untitled Report"}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["ID: ",n.id]})]})]}),e.jsx(T,{label:$e(n.type),size:"small",color:be(n.type),variant:"outlined"})]}),e.jsxs(c,{sx:{mb:2},children:[e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[e.jsx("strong",{children:"Target:"})," ",oe(n)]}),e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[e.jsx("strong",{children:"Generated By:"})," ",n.generatedBy||n.createdBy||"Unknown"]}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Created:"})," ",new Date(n.createdAt).toLocaleString()]})]}),e.jsxs(c,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(M,{title:"View Report",children:e.jsx(J,{size:"small",onClick:()=>me(n),sx:{color:l.palette.primary.main},children:e.jsx(tt,{})})}),e.jsx(M,{title:"Download PDF",children:e.jsx(J,{size:"small",onClick:()=>{const G=`${(n.title||n.name||"report").replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;q(n,G)},sx:{color:l.palette.success.main},children:e.jsx(Ne,{})})}),e.jsx(M,{title:"Delete Report",children:e.jsx(J,{size:"small",onClick:()=>ye(n.id),sx:{color:l.palette.error.main},children:e.jsx(st,{})})})]})]},n.id))}):e.jsx(K,{component:H,sx:{borderRadius:3,boxShadow:3,overflowX:"auto",width:"100%",maxWidth:"100vw",bgcolor:"background.paper"},children:e.jsxs(Y,{size:"medium",sx:{minWidth:{md:0,lg:900},width:"100%",tableLayout:"fixed"},children:[e.jsx(X,{children:e.jsxs($,{sx:{position:"sticky",top:0,zIndex:2,bgcolor:"background.paper",boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},children:[e.jsx(i,{padding:"checkbox",sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},width:{md:36,lg:48}}}),e.jsx(i,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},width:{md:56,lg:80}},children:"Type"}),e.jsx(i,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},maxWidth:{md:120,lg:220},minWidth:80},children:"Report"}),e.jsx(i,{align:"center",sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},width:{md:60,lg:120},maxWidth:{md:80,lg:160}},children:"Target"}),e.jsx(i,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},maxWidth:{md:80,lg:160}},children:"Generated By"}),e.jsx(i,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},maxWidth:{md:80,lg:160}},children:"Created"}),e.jsx(i,{align:"right",sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},minWidth:{md:60,lg:80}},children:"Actions"})]})}),e.jsx(Q,{children:f.map((n,W)=>e.jsxs($,{hover:!0,sx:{bgcolor:W%2===0?"background.default":"background.paper",transition:"background 0.2s","&:hover":{bgcolor:"action.hover"}},children:[e.jsx(i,{padding:"checkbox",sx:{px:{md:.5,lg:2},width:{md:36,lg:48}}}),e.jsx(i,{sx:{px:{md:.5,lg:2},width:{md:56,lg:80}},children:e.jsx(De,{sx:{bgcolor:"primary.main",width:{md:22,lg:32},height:{md:22,lg:32},boxShadow:"0 1px 4px rgba(0,0,0,0.08)"},children:Se(n.type)})}),e.jsxs(i,{sx:{maxWidth:{md:120,lg:220},minWidth:80,px:{md:.5,lg:2}},children:[e.jsx(M,{title:n.title||n.name||"Untitled Report",children:e.jsx(a,{variant:"subtitle1",noWrap:!0,sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},wordBreak:"break-word",maxWidth:{md:110,lg:200},overflow:"hidden",textOverflow:"ellipsis"},children:n.title||n.name||"Untitled Report"})}),e.jsx(M,{title:`ID: ${n.id}`,children:e.jsxs(a,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{fontSize:{md:"0.8rem",lg:"0.92rem"},lineHeight:1.4,wordBreak:"break-word",maxWidth:{md:110,lg:200},overflow:"hidden",textOverflow:"ellipsis"},children:["ID: ",n.id]})})]}),e.jsx(i,{align:"center",sx:{px:{md:.5,lg:2},width:{md:60,lg:120},maxWidth:{md:80,lg:160}},children:e.jsx(M,{title:`Target: ${oe(n)}`,arrow:!0,children:e.jsx("span",{children:e.jsx(T,{label:oe(n),size:"small",color:be(n.type),sx:{fontSize:{md:"0.65rem",lg:"0.78rem"},fontWeight:600,borderRadius:2,px:1,height:{md:16,lg:22},boxShadow:1,minWidth:{lg:70},justifyContent:"center"}})})})}),e.jsx(i,{sx:{maxWidth:{md:80,lg:160},px:{md:.5,lg:2}},children:e.jsx(M,{title:`Generated by: ${n.generatedBy||n.createdBy||"Unknown"}`,arrow:!0,children:e.jsx(a,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:"0.78rem",overflow:"hidden",textOverflow:"ellipsis"},children:n.generatedBy||n.createdBy||"Unknown"})})}),e.jsx(i,{sx:{maxWidth:{md:80,lg:160},px:{md:.5,lg:2}},children:e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(M,{title:new Date(n.createdAt).toLocaleString(),arrow:!0,children:e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:.5},children:e.jsx(a,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:{md:"0.7rem",lg:"0.78rem"},maxWidth:{md:60,lg:70}},children:new Date(n.createdAt).toLocaleDateString()})})}),e.jsx(a,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:{md:"0.6rem",lg:"0.7rem"},maxWidth:{md:60,lg:70}},children:new Date(n.createdAt).toLocaleTimeString()})]})}),e.jsx(i,{align:"right",sx:{minWidth:{md:60,lg:80},px:{md:.5,lg:2}},children:e.jsx(c,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.2,flexWrap:"wrap",justifyContent:"flex-end",bgcolor:"action.selected",borderRadius:2,px:1,py:.5,boxShadow:1},children:[e.jsx(M,{title:"View Report",children:e.jsx("span",{children:e.jsx(J,{color:"primary",size:"small",onClick:()=>me(n),children:e.jsx(tt,{fontSize:"small"})})})}),e.jsx(M,{title:"Download PDF",children:e.jsx("span",{children:e.jsx(J,{color:"success",size:"small",onClick:()=>{const se=`${(n.title||n.name||"report").replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;q(n,se)},children:e.jsx(Ne,{fontSize:"small"})})})}),e.jsx(M,{title:"Delete Report",children:e.jsx("span",{children:e.jsx(J,{color:"error",size:"small",onClick:()=>ye(n.id),children:e.jsx(st,{fontSize:"small"})})})})]})})})]},n.id))})]})})}),e.jsx(Vt,{open:S,onClose:pe,newReport:r,onNewReportChange:Re,onAddReport:Ie,loading:_,users:z,selectedUserId:O,onSelectedUserIdChange:We}),t&&s&&e.jsxs(_e,{open:t,onClose:le,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh"}},children:[e.jsxs(Ve,{sx:{borderBottom:`1px solid ${l.palette.divider}`,pb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(he,{sx:{color:l.palette.primary.main}}),e.jsxs(c,{children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:s.title||s.name||"Report"}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Generated on ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsx(J,{onClick:le,size:"small",children:e.jsx(Ft,{})})]}),e.jsx(Ge,{sx:{p:0},children:m?e.jsx(c,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(Le,{})}):e.jsx(Gt,{report:d||s,onExport:q})}),e.jsxs(qe,{sx:{p:3,borderTop:`1px solid ${l.palette.divider}`},children:[e.jsx(Z,{onClick:le,variant:"outlined",sx:{borderRadius:2,px:3},children:"Close"}),e.jsx(Z,{onClick:()=>{const F=`${(s.title||s.name||"report").replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;q(s,F)},variant:"contained",startIcon:e.jsx(Ne,{}),sx:{borderRadius:2,px:3},children:"Download PDF"})]})]}),e.jsxs(_e,{open:!!ee,onClose:()=>te(null),maxWidth:"xs",fullWidth:!0,children:[e.jsxs(Ve,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($t,{color:"warning",sx:{mr:1}}),"Confirm Delete"]}),e.jsx(Ge,{children:e.jsx(a,{variant:"body1",sx:{mb:2},children:"Are you sure you want to delete this report? This action cannot be undone."})}),e.jsxs(qe,{children:[e.jsx(Z,{onClick:()=>te(null),variant:"outlined",children:"Cancel"}),e.jsx(Z,{onClick:Fe,color:"error",variant:"contained",disabled:!!U,children:U?"Deletingâ€¦":"Delete"})]})]}),e.jsx(Bt,{open:!!j,autoHideDuration:4e3,onClose:()=>fe(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(Je,{onClose:()=>fe(null),severity:B,sx:{width:"100%"},children:j})})]})};export{Xt as default};
