import{u as z,r as b,j as r,ad as q,a6 as L,be as $,b as o,B as c,bf as M,ai as S,z as E,bg as W,I as A,E as _,W as U,b6 as V,d as F,ac as Z,ab as B,s as R,ae as f,bh as d,n as k,p as P,q as w}from"./mui-BvrjgOXm.js";class N{constructor(){this.rateLimitInfo=null,this.retryTimers=new Map}handleRateLimitError(e){if(e.response?.status===429){const t={error:e.response.data?.error||"Too many requests",retryAfter:e.response.data?.retryAfter||"15 minutes",limit:e.response.headers["ratelimit-limit"],remaining:e.response.headers["ratelimit-remaining"],reset:e.response.headers["ratelimit-reset"]};this.rateLimitInfo=t;const s=this.calculateRetryTime(t);return{isRateLimited:!0,message:t.error,retryAfter:t.retryAfter,retryTime:s,limit:t.limit,remaining:t.remaining,reset:t.reset}}return{isRateLimited:!1}}calculateRetryTime(e){if(e.reset){const s=parseInt(e.reset)*1e3,l=Date.now();return Math.max(0,s-l)}const t=e.retryAfter.toLowerCase();return t.includes("minute")?parseInt(t.match(/\d+/)?.[0]||"15")*60*1e3:t.includes("hour")?parseInt(t.match(/\d+/)?.[0]||"1")*60*60*1e3:900*1e3}formatRetryTime(e){const t=Math.ceil(e/6e4),s=Math.floor(t/60),l=t%60;return s>0?`${s}h ${l}m`:`${t}m`}getUserFriendlyMessage(e){const t=this.calculateRetryTime(e),s=this.formatRetryTime(t);return e.error.includes("authentication")?`Too many login attempts. Please try again in ${s}.`:e.error.includes("registration")?`Too many registration attempts. Please try again in ${s}.`:e.error.includes("password reset")?`Too many password reset attempts. Please try again in ${s}.`:`Too many requests. Please try again in ${s}.`}canRetry(e){const t=this.retryTimers.get(e);return t?Date.now()>=t:!0}setRetryTimer(e,t){this.retryTimers.set(e,Date.now()+t)}clearRetryTimer(e){this.retryTimers.delete(e)}getRemainingRetryTime(e){const t=this.retryTimers.get(e);return t?Math.max(0,t-Date.now()):0}reset(){this.rateLimitInfo=null,this.retryTimers.clear()}}const x=new N,Y=n=>{console.log("handleApiError called with:",n);const e=x.handleRateLimitError(n);return e.isRateLimited?{type:"rate_limit",message:x.getUserFriendlyMessage(e),retryAfter:e.retryAfter,retryTime:e.retryTime,limit:e.limit,remaining:e.remaining}:n.response?.status===401?{type:"unauthorized",message:"Invalid credentials. Please check your email and password."}:n.response?.status===400?{type:"validation",message:n.response.data?.error||n.response.data?.message||"Invalid input. Please check your data."}:n.response?.status>=500?{type:"server_error",message:"Server error. Please try again later."}:n.response?n.response?.data?.error?{type:"api_error",message:n.response.data.error}:n.response?.data?.message?{type:"api_error",message:n.response.data.message}:{type:"unknown",message:n.message||"An unexpected error occurred."}:{type:"network_error",message:"Network error. Please check your connection and try again."}},J=({isOpen:n,onClose:e,rateLimitData:t,endpoint:s,onRetry:l})=>{const u=z(),[i,p]=b.useState(0),[y,g]=b.useState(100);b.useEffect(()=>{if(!n||!t)return;const a=x.calculateRetryTime(t),m=a;let h=a;const v=setInterval(()=>{h-=1e3,p(h);const C=Math.max(0,h/m*100);g(C),h<=0&&(clearInterval(v),p(0),g(0))},1e3);return()=>clearInterval(v)},[n,t]);const j=a=>{const m=Math.floor(a/6e4),h=Math.floor(a%6e4/1e3);return m>0?`${m}m ${h}s`:`${h}s`},T=()=>{i<=0&&(x.clearRetryTimer(s),l?.(),e?.())};return!n||!t?null:r.jsx(q,{in:n,children:r.jsxs(L,{severity:"warning",icon:r.jsx(U,{}),sx:{mb:2,borderRadius:2,border:`1px solid ${u.palette.warning.main}`,backgroundColor:u.palette.mode==="dark"?"rgba(255, 152, 0, 0.1)":"rgba(255, 152, 0, 0.05)"},action:r.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[i<=0&&r.jsx(E,{size:"small",variant:"outlined",startIcon:r.jsx(W,{}),onClick:T,sx:{minWidth:"auto",textTransform:"none",fontSize:"0.75rem"},children:"Retry"}),r.jsx(A,{size:"small",onClick:e,sx:{color:u.palette.warning.main,"&:hover":{backgroundColor:"rgba(255, 152, 0, 0.1)"}},children:r.jsx(_,{fontSize:"small"})})]}),children:[r.jsx($,{sx:{fontWeight:600},children:"Rate Limit Exceeded"}),r.jsx(o,{variant:"body2",sx:{mb:1},children:x.getUserFriendlyMessage(t)}),i>0&&r.jsxs(c,{sx:{mt:1},children:[r.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[r.jsx(M,{fontSize:"small",color:"warning"}),r.jsxs(o,{variant:"caption",color:"text.secondary",children:["Retry available in: ",j(i)]})]}),r.jsx(S,{variant:"determinate",value:y,sx:{height:4,borderRadius:2,backgroundColor:u.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:u.palette.warning.main}}})]}),i<=0&&r.jsx(c,{sx:{mt:1},children:r.jsx(o,{variant:"caption",color:"success.main",children:"âœ“ You can now retry your request"})}),t.limit&&r.jsxs(o,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:["Limit: ",t.limit," requests per ",t.retryAfter]})]})})};class G{constructor(){this.minLength=8,this.maxLength=128,this.requireUppercase=!0,this.requireLowercase=!0,this.requireNumbers=!0,this.requireSpecialChars=!0,this.forbiddenPatterns=[/(.)\1{2,}/,/123|234|345|456|567|678|789|890/,/abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz/i,/qwerty|asdfgh|zxcvbn/i],this.commonPasswords=["password","123456","123456789","qwerty","abc123","password123","admin","letmein","welcome","monkey","1234567890","password1","qwerty123","dragon","master","hello","freedom","whatever","qazwsx","trustno1","jordan23","harley","ranger","hunter","buster","soccer","hockey","killer","george","sexy","andrew","charlie","superman","asshole","fuckyou","dallas","jessica","panties","pepper","1234","6969","killer","trust","jordan","jennifer","zxcvbn","asdf","dead","pass","fuck","6969","mustang","letmein","amanda","access","yankees","987654321","dallas","austin","thunder","taylor","matrix","mobilemail","mom","monitor","monitoring","montana","moon","moscow"]}validate(e){const t=[];if(!e)return t.push("Password is required"),{isValid:!1,errors:t};e.length<this.minLength&&t.push(`Password must be at least ${this.minLength} characters long`),e.length>this.maxLength&&t.push(`Password must be no more than ${this.maxLength} characters long`),this.requireUppercase&&!/[A-Z]/.test(e)&&t.push("Password must contain at least one uppercase letter"),this.requireLowercase&&!/[a-z]/.test(e)&&t.push("Password must contain at least one lowercase letter"),this.requireNumbers&&!/\d/.test(e)&&t.push("Password must contain at least one number"),this.requireSpecialChars&&!/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(e)&&t.push("Password must contain at least one special character (!@#$%^&*()_+-=[]{}|;:,.<>?)");for(const s of this.forbiddenPatterns)if(s.test(e)){s.source.includes("\\1")?t.push("Password cannot contain 3 or more consecutive identical characters"):s.source.includes("123|234")?t.push("Password cannot contain sequential numbers (123, 234, etc.)"):s.source.includes("abc|bcd")?t.push("Password cannot contain sequential letters (abc, bcd, etc.)"):s.source.includes("qwerty")&&t.push("Password cannot contain common keyboard patterns");break}return this.commonPasswords.includes(e.toLowerCase())&&t.push("Password is too common. Please choose a more unique password"),this.hasRepeatedSequence(e)&&t.push("Password contains repeated character sequences"),{isValid:t.length===0,errors:t,strength:this.calculateStrength(e)}}hasRepeatedSequence(e){for(let t=0;t<e.length-2;t++){const s=e.substring(t,t+3);if(e.substring(t+3).includes(s))return!0}return!1}calculateStrength(e){let t=0;e.length>=8&&(t+=10),e.length>=12&&(t+=10),e.length>=16&&(t+=5),/[a-z]/.test(e)&&(t+=10),/[A-Z]/.test(e)&&(t+=10),/\d/.test(e)&&(t+=10),/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(e)&&(t+=10);const s=new Set(e).size;return t+=Math.min(s*2,20),e.length>=8&&s>=6&&(t+=15),Math.min(t,100)}getStrengthDescription(e){return e<30?"Very Weak":e<50?"Weak":e<70?"Fair":e<90?"Good":"Strong"}getStrengthColor(e){return e<30?"error":e<50?"warning":e<70?"info":e<90?"primary":"success"}getSuggestions(e){const t=[];return e.some(s=>s.includes("at least"))&&t.push("Use a longer password with at least 8 characters"),e.some(s=>s.includes("uppercase"))&&t.push("Add uppercase letters (A-Z)"),e.some(s=>s.includes("lowercase"))&&t.push("Add lowercase letters (a-z)"),e.some(s=>s.includes("number"))&&t.push("Add numbers (0-9)"),e.some(s=>s.includes("special character"))&&t.push("Add special characters (!@#$%^&*()_+-=[]{}|;:,.<>?)"),e.some(s=>s.includes("consecutive"))&&t.push("Avoid repeating characters (aaa, 111, etc.)"),e.some(s=>s.includes("sequential"))&&t.push("Avoid sequential patterns (123, abc, etc.)"),e.some(s=>s.includes("common"))&&t.push("Choose a more unique password"),t}}const I=new G,K=({password:n,showSuggestions:e=!0,defaultExpanded:t=!1})=>{const[s,l]=b.useState(t),u=I.validate(n||""),i=u.strength,p=u.errors,y=I.getSuggestions(p),g=()=>i<30?"error":i<50?"warning":i<70?"info":i<90?"primary":"success",j=()=>i<30?"Very Weak":i<50?"Weak":i<70?"Fair":i<90?"Good":"Strong",T=()=>[{label:"At least 8 characters",met:n&&n.length>=8,icon:n&&n.length>=8?f:d},{label:"Contains uppercase letter",met:n&&/[A-Z]/.test(n),icon:n&&/[A-Z]/.test(n)?f:d},{label:"Contains lowercase letter",met:n&&/[a-z]/.test(n),icon:n&&/[a-z]/.test(n)?f:d},{label:"Contains number",met:n&&/\d/.test(n),icon:n&&/\d/.test(n)?f:d},{label:"Contains special character",met:n&&/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(n),icon:n&&/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(n)?f:d}];return n?r.jsxs(c,{sx:{mt:2},children:[r.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[r.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(V,{sx:{fontSize:16}}),r.jsx(o,{variant:"caption",color:"text.secondary",children:"Password Strength:"}),r.jsx(F,{label:j(),color:g(),size:"small",sx:{fontWeight:500}})]}),r.jsx(A,{size:"small",onClick:()=>l(!s),sx:{p:.5},children:s?r.jsx(Z,{}):r.jsx(B,{})})]}),r.jsx(S,{variant:"determinate",value:i,color:g(),sx:{height:6,borderRadius:3,backgroundColor:"rgba(0,0,0,0.1)",mb:1,"& .MuiLinearProgress-bar":{borderRadius:3}}}),r.jsxs(o,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"right"},children:[i,"% strength"]}),r.jsx(q,{in:s,children:r.jsxs(c,{sx:{mt:2},children:[r.jsxs(c,{sx:{mb:2},children:[r.jsx(o,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:"Requirements:"}),r.jsx(R,{dense:!0,sx:{py:0},children:T().map((a,m)=>r.jsxs(k,{sx:{py:.25,px:0},children:[r.jsx(P,{sx:{minWidth:24},children:r.jsx(a.icon,{sx:{fontSize:16,color:a.met?"success.main":"error.main"}})}),r.jsx(w,{primary:r.jsx(o,{variant:"caption",sx:{color:a.met?"success.main":"error.main",fontWeight:a.met?500:400},children:a.label})})]},m))})]}),e&&y.length>0&&r.jsxs(c,{children:[r.jsx(o,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:"Suggestions:"}),r.jsx(R,{dense:!0,sx:{py:0},children:y.map((a,m)=>r.jsxs(k,{sx:{py:.25,px:0},children:[r.jsx(P,{sx:{minWidth:24},children:r.jsx(d,{sx:{fontSize:16,color:"warning.main"}})}),r.jsx(w,{primary:r.jsx(o,{variant:"caption",color:"warning.main",children:a})})]},m))})]})]})})]}):r.jsx(c,{sx:{mt:1},children:r.jsx(o,{variant:"caption",color:"text.secondary",children:"Enter a password to see strength indicator"})})};export{K as P,J as R,Y as h,I as p,x as r};
