import{u as Y,j as e,a3 as q,b as r,B as t,a4 as n,a5 as x,a6 as h,k as m,r as T,n as S,a7 as A,O as u,q as I,d as p,Q as f,I as Q,a8 as _,a9 as J,aa as K,$ as R,ab as P,ac as W,ad as z,ae as V,af as y,ag as X,W as L,ah as Z,ai as ee}from"./mui-DaYlJXyD.js";import{r as g}from"./vendor-Cr2nE3UY.js";import{u as se,a as re,L as te}from"./index-xE_H2rg0.js";import{P as ae}from"./PageHeader-DlP9MJR_.js";import"./router-B4FNaIx_.js";const de=()=>{const{user:i}=se(),b=Y(),[M,k]=g.useState(!0),[v,w]=g.useState(null),[o,$]=g.useState(null),[j,E]=g.useState(!1),C=g.useCallback(async()=>{k(!0),w(null);try{const s=await re.getDashboardStats();$(s.data)}catch{w("Failed to load dashboard data")}finally{k(!1)}},[]);if(g.useEffect(()=>{C()},[C]),M)return e.jsx(te,{overlay:!0,message:"Loading dashboard..."});if(v)return e.jsx(q,{severity:"error",sx:{mb:3},children:v});if(!o)return e.jsx(r,{variant:"h6",color:"error",children:"Failed to load dashboard data"});const O=[{key:"totalTickets",label:"Total Tickets"},{key:"openTickets",label:"Open Tickets"},{key:"closedTickets",label:"Closed Tickets"},{key:"overdueTickets",label:"Overdue Tickets"},{key:"totalTasks",label:"Total Tasks"},{key:"completedTasks",label:"Completed Tasks"},{key:"overdueTasks",label:"Overdue Tasks"},{key:"activeUsers",label:"Active Users"}],D={totalTickets:{icon:e.jsx(u,{}),color:"primary.main",bg:"primary.light"},openTickets:{icon:e.jsx(L,{}),color:"error.main",bg:"error.light"},closedTickets:{icon:e.jsx(P,{}),color:"success.main",bg:"success.light"},overdueTickets:{icon:e.jsx(ee,{}),color:"warning.main",bg:"warning.light"},totalTasks:{icon:e.jsx(f,{}),color:"secondary.main",bg:"secondary.light"},completedTasks:{icon:e.jsx(Z,{}),color:"success.main",bg:"success.light"},overdueTasks:{icon:e.jsx(L,{}),color:"warning.main",bg:"warning.light"},activeUsers:{icon:e.jsx(R,{}),color:"info.main",bg:"info.light"},departments:{icon:e.jsx(X,{}),color:"primary.dark",bg:"primary.light"}},H=s=>s>=90?5:s>=80?4:s>=70?3:s>=60?2:1,U=s=>s>=90?"success":s>=80?"info":s>=70?"warning":"error",N=()=>{E(!j)};return e.jsxs(t,{sx:{flexGrow:1,pt:{xs:7,sm:3,md:4},px:{xs:1,sm:2,md:3},pb:{xs:8,sm:12,md:16},display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"background.default"},children:[e.jsx(ae,{title:`Welcome back, ${(i==null?void 0:i.firstname)||(i==null?void 0:i.name)||"User"}!`,subtitle:(i==null?void 0:i.role)==="department_head"?`Here's what's happening in your ${(i==null?void 0:i.department)||"department"} today.`:(i==null?void 0:i.role)==="admin"?"Here's your organization-wide overview and team performance.":"Here's your current tasks and tickets overview.",emoji:"ðŸ‘‹",color:"primary"}),e.jsx(n,{container:!0,spacing:4,sx:{mb:{xs:3,sm:4,md:5}},children:O.map(s=>{const a=D[s.key]||{};return e.jsx(n,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(x,{sx:{height:"100%",borderRadius:4,p:0,bgcolor:"background.paper",boxShadow:"0 6px 20px rgba(0,0,0,0.08)",border:"1px solid",borderColor:"divider",transition:"transform 0.2s ease, box-shadow 0.2s ease","&:hover":{transform:"translateY(-6px)",boxShadow:"0 14px 30px rgba(0,0,0,0.12)"}},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2.5,p:{xs:2,sm:2.5}},children:[e.jsx(m,{sx:{width:54,height:54,mr:2,bgcolor:a.bg,color:a.color,boxShadow:"inset 0 0 0 2px rgba(255,255,255,0.8), 0 4px 10px rgba(0,0,0,0.08)"},children:a.icon}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",sx:{fontWeight:700,mb:.5,letterSpacing:.3,textTransform:"uppercase",fontSize:{xs:"0.75rem",sm:"0.8rem",md:"0.85rem"},lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.label}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,fontSize:{xs:"1.8rem",sm:"2rem",md:"2.2rem"},color:"text.primary",lineHeight:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o[s.key]})]})]})})},s.key)})}),(o.recentTickets||o.recentTasks)&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2,mt:2},children:[e.jsx(t,{sx:{width:6,height:32,bgcolor:"primary.main",borderRadius:2,mr:1}}),e.jsx(r,{variant:"h5",sx:{fontWeight:700,letterSpacing:.5},children:"Recent Activity"})]}),e.jsxs(n,{container:!0,spacing:3,sx:{mb:4},children:[o.recentTickets&&e.jsx(n,{item:!0,xs:12,sm:12,md:6,children:e.jsx(x,{sx:{borderRadius:4,height:"100%",bgcolor:"background.paper",border:"1px solid",borderColor:"divider",boxShadow:"0 6px 20px rgba(0,0,0,0.06)"},children:e.jsxs(h,{sx:{p:{xs:2,sm:2.5}},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:700,mb:2,letterSpacing:.5,color:"primary.main"},children:"Recent Tickets"}),o.recentTickets.length>0?e.jsx(T,{dense:!0,children:o.recentTickets.map(s=>e.jsxs(S,{alignItems:"flex-start",sx:{mb:1,borderRadius:2,bgcolor:"background.paper",boxShadow:1},children:[e.jsx(A,{children:e.jsx(m,{sx:{bgcolor:"primary.main"},children:e.jsx(u,{})})}),e.jsx(I,{primary:e.jsx(t,{sx:{fontWeight:600},children:s.title}),secondary:e.jsx(r,{variant:"body2",color:"text.secondary",component:"div",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(p,{label:s.status,size:"small",color:s.status==="open"||s.status==="pending"?"error":s.status==="closed"||s.status==="completed"||s.status==="resolved"?"success":"warning"}),e.jsx(p,{label:s.priority,size:"small",color:s.priority==="high"?"error":s.priority==="medium"?"warning":"success"})]})})})]},s.id))}):e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary",py:2},children:[e.jsx(u,{color:"disabled"}),e.jsx(r,{variant:"body2",children:"No recent tickets."})]})]})})}),o.recentTasks&&e.jsx(n,{item:!0,xs:12,sm:12,md:6,children:e.jsx(x,{sx:{borderRadius:3,boxShadow:2,height:"100%"},children:e.jsxs(h,{children:[e.jsx(r,{variant:"h6",sx:{fontWeight:700,mb:2,letterSpacing:.5,color:"secondary.main"},children:"Recent Tasks"}),o.recentTasks.length>0?e.jsx(T,{dense:!0,children:o.recentTasks.map(s=>e.jsxs(S,{alignItems:"flex-start",sx:{mb:1,borderRadius:2,bgcolor:"background.paper",boxShadow:1},children:[e.jsx(A,{children:e.jsx(m,{sx:{bgcolor:"secondary.main"},children:e.jsx(f,{})})}),e.jsx(I,{primary:e.jsx(t,{sx:{fontWeight:600},children:s.title}),secondary:e.jsx(r,{variant:"body2",color:"text.secondary",component:"div",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(p,{label:s.status,size:"small",color:s.status==="completed"?"success":s.status==="pending"?"warning":"info"}),e.jsx(p,{label:s.priority,size:"small",color:s.priority==="high"?"error":s.priority==="medium"?"warning":"success"})]})})})]},s.id))}):e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary",py:2},children:[e.jsx(f,{color:"disabled"}),e.jsx(r,{variant:"body2",children:"No recent tasks."})]})]})})})]})]}),o.teamPerformance&&o.teamPerformance.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,mt:4,p:2,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:1},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",flex:1},children:[e.jsx(t,{sx:{width:4,height:24,bgcolor:"primary.main",borderRadius:2,mr:2}}),e.jsx(r,{variant:"h5",sx:{fontWeight:700,letterSpacing:.5},children:(i==null?void 0:i.role)==="admin"?"Organization Performance":"Team Performance"})]}),j&&e.jsxs(t,{sx:{display:"flex",gap:1,flexWrap:"wrap",mr:2},children:[e.jsx(p,{label:`${o.teamPerformance.length} Members`,size:"small",color:"primary",variant:"outlined",sx:{fontSize:"0.75rem",height:24}}),e.jsx(p,{label:`${o.teamPerformance.reduce((s,a)=>s+a.tasksCompleted+a.ticketsClosed,0)} Completed`,size:"small",color:"success",variant:"outlined",sx:{fontSize:"0.75rem",height:24}}),e.jsx(p,{label:`${Math.round(o.teamPerformance.reduce((s,a)=>{const c=a.tasksAssigned+a.ticketsAssigned,l=a.tasksCompleted+a.ticketsClosed;return s+(c>0?l/c*100:0)},0)/o.teamPerformance.length)}% Avg Efficiency`,size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.75rem",height:24}})]}),e.jsx(Q,{onClick:N,sx:{color:"primary.main","&:hover":{backgroundColor:"primary.light",color:"primary.dark"}},children:j?e.jsx(_,{}):e.jsx(J,{})})]}),e.jsxs(K,{in:!j,children:[e.jsxs(n,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(h,{sx:{textAlign:"center",p:3},children:[e.jsx(m,{sx:{bgcolor:"primary.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(R,{})}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,color:"primary.main",mb:1},children:o.teamPerformance.length}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Active Members"})]})})}),e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(h,{sx:{textAlign:"center",p:3},children:[e.jsx(m,{sx:{bgcolor:"success.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(P,{})}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,color:"success.main",mb:1},children:o.teamPerformance.reduce((s,a)=>s+a.tasksCompleted+a.ticketsClosed,0)}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Completed Items"})]})})}),e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(h,{sx:{textAlign:"center",p:3},children:[e.jsx(m,{sx:{bgcolor:"info.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(W,{})}),e.jsxs(r,{variant:"h4",sx:{fontWeight:800,color:"info.main",mb:1},children:[Math.round(o.teamPerformance.reduce((s,a)=>{const c=a.tasksAssigned+a.ticketsAssigned,l=a.tasksCompleted+a.ticketsClosed;return s+(c>0?l/c*100:0)},0)/o.teamPerformance.length),"%"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Avg Efficiency"})]})})}),e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsx(x,{sx:{borderRadius:3,boxShadow:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:e.jsxs(h,{sx:{textAlign:"center",p:3},children:[e.jsx(m,{sx:{bgcolor:"warning.main",mx:"auto",mb:2,width:48,height:48},children:e.jsx(z,{})}),e.jsx(r,{variant:"h4",sx:{fontWeight:800,color:"warning.main",mb:1},children:o.teamPerformance.filter(s=>{const a=s.tasksAssigned+s.ticketsAssigned,c=s.tasksCompleted+s.ticketsClosed;return(a>0?Math.round(c/a*100):0)>=90}).length}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Top Performers"})]})})})]}),e.jsx(n,{container:!0,spacing:3,children:o.teamPerformance.map(s=>{const a=s.tasksAssigned+s.ticketsAssigned,c=s.tasksCompleted+s.ticketsClosed,l=a>0?Math.round(c/a*100):0,d=U(l),F=s.tasksAssigned>0?Math.round(s.tasksCompleted/s.tasksAssigned*100):0,B=s.ticketsAssigned>0?Math.round(s.ticketsClosed/s.ticketsAssigned*100):0;return e.jsx(n,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(x,{sx:{borderRadius:3,boxShadow:2,transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:4},position:"relative",height:"100%",bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[e.jsx(t,{sx:{position:"absolute",top:16,right:16,zIndex:1},children:e.jsx(p,{label:`${l}%`,size:"small",color:d,icon:l>=90?e.jsx(z,{}):e.jsx(W,{}),sx:{fontWeight:700,fontSize:"0.75rem",height:28}})}),e.jsxs(h,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(m,{sx:{bgcolor:`${d}.main`,width:48,height:48,fontSize:"1.1rem",fontWeight:700,mr:2},children:s.name.split(" ").map(G=>G[0]).join("")}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:700,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),e.jsxs(r,{variant:"body2",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[s.role?s.role.charAt(0).toUpperCase()+s.role.slice(1):"",s.departmentName?` â€¢ ${s.departmentName}`:""]})]})]}),e.jsxs(t,{sx:{mb:3,textAlign:"center"},children:[e.jsx(V,{value:H(l),readOnly:!0,size:"small",sx:{mb:1}}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"Performance Rating"})]}),e.jsxs(t,{sx:{mb:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"subtitle2",sx:{fontWeight:600,color:"text.primary"},children:"Tasks"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[s.tasksCompleted,"/",s.tasksAssigned]})]}),e.jsx(y,{variant:"determinate",value:F,sx:{height:8,borderRadius:4,bgcolor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:4}},color:"secondary"}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Assigned: ",s.tasksAssigned]}),e.jsxs(r,{variant:"caption",color:"success.main",sx:{fontWeight:600},children:["Completed: ",s.tasksCompleted]})]})]}),e.jsxs(t,{sx:{mb:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"subtitle2",sx:{fontWeight:600,color:"text.primary"},children:"Tickets"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[s.ticketsClosed,"/",s.ticketsAssigned]})]}),e.jsx(y,{variant:"determinate",value:B,sx:{height:8,borderRadius:4,bgcolor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:4}},color:"primary"}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Assigned: ",s.ticketsAssigned]}),e.jsxs(r,{variant:"caption",color:"success.main",sx:{fontWeight:600},children:["Closed: ",s.ticketsClosed]})]})]}),e.jsxs(t,{sx:{p:2,bgcolor:`${d}.50`,borderRadius:2,border:`1px solid ${d==="success"?b.palette.success.main:d==="warning"?b.palette.warning.main:d==="error"?b.palette.error.main:b.palette.info.main}20`},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"subtitle2",sx:{fontWeight:600,color:"text.primary"},children:"Overall Efficiency"}),e.jsxs(r,{variant:"h6",sx:{fontWeight:800,color:`${d}.main`},children:[l,"%"]})]}),e.jsx(y,{variant:"determinate",value:l,sx:{height:10,borderRadius:5,bgcolor:"rgba(255,255,255,0.3)","& .MuiLinearProgress-bar":{borderRadius:5}},color:d})]})]})]})},s.userId)})})]})]})]})};export{de as default};
