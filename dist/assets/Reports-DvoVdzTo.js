import{u as Ae,j as e,aj as Q,B as d,aS as ft,b as o,I as Y,aT as yt,a9 as bt,a8 as it,aa as St,a4 as k,at as Me,au as He,av as _e,m as _,as as ce,t as Ve,v as Ge,_ as pe,w as Je,a3 as qe,Q as Ye,O as et,am as tt,e as Ze,aU as st,k as Re,H as wt,aV as kt,aW as Ct,aX as vt,y as ee,aY as Rt,aZ as At,ak as It,a_ as Wt,a$ as Dt,x as Ke,a5 as U,a6 as M,d as $,az as re,aA as ne,aB as ie,aC as N,aD as l,aE as le,a1 as Tt,V as Le,aF as zt,E as Ft,G as $t,h as q,ao as rt,b0 as Ee,J as nt,z as Bt,W as Ot,a2 as Nt}from"./mui-DaYlJXyD.js";import{r as m,b as Lt}from"./vendor-Cr2nE3UY.js";import{h as Et,g as Pt,r as me,U as Ut}from"./index-xE_H2rg0.js";import{P as Mt}from"./PageHeader-DlP9MJR_.js";import"./router-B4FNaIx_.js";const Ht=(i,g)=>!g||g.role==="admin"?i:g.role==="department_head"?i.filter(c=>{var p;return((p=c.parameters)==null?void 0:p.departmentId)===g.departmentId||c.createdBy===g.id}):i.filter(c=>c.createdBy===g.id),_t=(i,g,c)=>{const p=Ht(i,c);switch(g){case 0:return p;case 1:{const v=new Date;return v.setDate(v.getDate()-7),p.filter(T=>new Date(T.createdAt)>=v)}case 2:return p.filter(v=>v.type==="department");default:return p}},Pe=(i=[])=>{var g;return{title:"",description:"",type:"task",parameters:{startDate:"",endDate:"",departmentId:((g=i[0])==null?void 0:g.id)||"",userId:"",selectedFields:[]}}},Ue={taskMetrics:[{key:"totalTasks",label:"Total Tasks"},{key:"pendingTasks",label:"Pending Tasks"},{key:"inProgressTasks",label:"In Progress Tasks"},{key:"completedTasks",label:"Completed Tasks"},{key:"overdueTasks",label:"Overdue Tasks"},{key:"taskCompletionRate",label:"Task Completion Rate"},{key:"averageTaskCompletionTime",label:"Average Task Completion Time"}],ticketMetrics:[{key:"totalTickets",label:"Total Tickets"},{key:"pendingTickets",label:"Pending Tickets"},{key:"inProgressTickets",label:"In Progress Tickets"},{key:"completedTickets",label:"Completed Tickets"},{key:"declinedTickets",label:"Declined Tickets"},{key:"ticketResolutionRate",label:"Ticket Resolution Rate"},{key:"averageTicketResolutionTime",label:"Average Ticket Resolution Time"},{key:"priorityDistribution",label:"Priority Distribution"}]},Vt=i=>{var c,p;const g=[];return(c=i.title)!=null&&c.trim()||g.push("Report title is required"),i.type||g.push("Report type is required"),i.type==="custom"&&(!((p=i.parameters)!=null&&p.selectedFields)||i.parameters.selectedFields.length===0)&&g.push("At least one field must be selected for custom reports"),g},Gt=(i=null)=>{const[g,c]=m.useState([]),[p,v]=m.useState(!0),[T,C]=m.useState(null),[r,y]=m.useState(null),[t,s]=m.useState("success"),[a,x]=m.useState(!1),[H,V]=m.useState(!1),[f,L]=m.useState(Pe()),[B,E]=m.useState(0),[P,Z]=m.useState("all"),[K,h]=m.useState("all"),[D,I]=m.useState(""),[G,Ie]=m.useState(""),[We,De]=m.useState(!1),[ge,ue]=m.useState(!1),[xe,te]=m.useState(null),[Te,je]=m.useState(null),[ze,fe]=m.useState(!1),[Fe,ye]=m.useState(!1),[be,ae]=m.useState(null),[oe,Se]=m.useState(!1),[$e,we]=m.useState(""),[ke,Be]=m.useState(""),[he,Ce]=m.useState([]),[n,z]=m.useState([]),[R,X]=m.useState(""),[de,Oe]=m.useState(""),[u,Qe]=m.useState(i),Ne=(u==null?void 0:u.role)==="admin"||(u==null?void 0:u.role)==="department_head";m.useEffect(()=>{i&&Qe(i)},[i]),m.useEffect(()=>{ve(),Ne&&lt()},[Ne]);const lt=async()=>{var b;try{const[j,W]=await Promise.all([Et.getAll(),Pt.getAll()]),A=(u==null?void 0:u.departmentId)||(u==null?void 0:u.department_id)||((b=u==null?void 0:u.department)==null?void 0:b.id),O=(j.data||[]).filter(F=>{var J;return(F.departmentId||F.department_id||((J=F.department)==null?void 0:J.id))===A});!O.find(F=>F.id===(u==null?void 0:u.id))&&(u!=null&&u.id)&&O.unshift(u),Ce(O),z(W.data||[])}catch(j){console.error("Error loading admin data:",j)}},ve=m.useCallback(async()=>{if(!a){x(!0),v(!0);try{const b=await me.listReports(),j=Array.isArray(b.data)?b.data:[],W=new Map;j.forEach(w=>W.set(w.id,w));const A=new Map;j.forEach(w=>{const F=JSON.stringify(w.parameters||{}),J=`${w.title||w.name||""}::${w.type||""}::${w.createdBy||""}::${F}`,S=A.get(J);(!S||new Date(w.createdAt)>new Date(S.createdAt))&&A.set(J,w)});const O=Array.from(A.values());c(w=>{const F=new Set(w.map(S=>`${S.title||S.name||""}::${S.type||""}::${S.createdBy||""}::${JSON.stringify(S.parameters||{})}`)),J=new Set(O.map(S=>`${S.title||S.name||""}::${S.type||""}::${S.createdBy||""}::${JSON.stringify(S.parameters||{})}`));return F.size===J.size&&[...F].every(S=>J.has(S))?w:O}),C(null)}catch(b){console.error("Error fetching reports:",b),C("Failed to load reports.")}finally{v(!1),x(!1)}}},[a]),at=b=>{const{name:j,value:W}=b.target;L(A=>({...A,[j]:W}))},ot=async()=>{var b,j,W,A,O,w,F,J;ye(!0),C(null);try{if(!((b=f.title)!=null&&b.trim())){C("Report name is required."),v(!1);return}const S=(u==null?void 0:u.departmentId)||(u==null?void 0:u.department_id)||((j=u==null?void 0:u.department)==null?void 0:j.id);if(!S){C("User information not available. Please refresh the page."),v(!1);return}const se={name:f.title.trim(),description:f.description||"",type:f.type,parameters:{...f.parameters,departmentId:S,...f.type==="user"&&R&&{userId:R},...f.type!=="department"&&f.type!=="ticket"&&de&&{selectedDepartmentId:de}}};console.log("newReport.parameters:",f.parameters),console.log("selectedDepartmentId:",de),console.log("Sending report data:",se),await me.createReport(se),await ve(),y("Report generated successfully"),s("success"),L(Pe()),V(!1),X(""),Oe("")}catch(S){console.error("Error creating report:",S),console.error("Error response:",(W=S.response)==null?void 0:W.data),console.error("Error status:",(A=S.response)==null?void 0:A.status);let se="Failed to create report.";if((w=(O=S.response)==null?void 0:O.data)!=null&&w.errors){const Xe=S.response.data.errors.map(jt=>jt.msg).join(", ");se=`Validation errors: ${Xe}`,console.error("Validation errors:",Xe)}else(J=(F=S.response)==null?void 0:F.data)!=null&&J.error&&(se=S.response.data.error,console.error("Backend error:",S.response.data.error));C(se),y(se),s("error")}finally{ye(!1)}},dt=async b=>{ae(b),C(null);try{await me.deleteReport(b),await ve(),y("Report deleted successfully"),s("success")}catch(j){console.error("Error deleting report:",j),C("Failed to delete report."),y("Failed to delete report."),s("error")}finally{ae(null)}},ct=async b=>{fe(!0),te(b),ue(!0);try{const j=await me.getReport(b.id);let W=j.data;j.data&&j.data.report&&j.data.data?W={...j.data.report,metrics:j.data.data,filtersApplied:j.data.data.filtersApplied||j.data.report.filtersApplied}:j.data&&j.data.report&&(W=j.data.report),je(W)}catch(j){console.error("Error loading report details:",j),C("Failed to load report details.")}finally{fe(!1)}},xt=async b=>{console.log("Edit report:",b)},ht=()=>{V(!1),L(Pe()),X(""),Oe("")},mt=()=>{ue(!1),te(null),je(null)},pt=async(b,j=null,W="pdf")=>{try{const A=await me.exportReport(b.id,W),O=window.URL.createObjectURL(new Blob([A.data])),w=document.createElement("a");if(w.href=O,j)w.setAttribute("download",j);else{const F=W==="excel"?"xlsx":W==="pdf"?"pdf":"csv";w.setAttribute("download",`report-${b.id}.${F}`)}document.body.appendChild(w),w.click(),w.parentNode.removeChild(w)}catch(A){console.error("Error downloading report:",A),C("Failed to download report.")}},gt=g.filter(b=>{var O;const j=P==="all"||((O=b.type)==null?void 0:O.toLowerCase())===P,W=K==="all"||b.status===K;let A=!0;return D&&(A=A&&new Date(b.createdAt)>=new Date(D)),G&&(A=A&&new Date(b.createdAt)<=new Date(G)),j&&W&&A}),ut=_t(g,B,u);return{reports:gt,tabReports:ut,loading:p,error:T,isNewReportDialogOpen:H,newReport:f,activeTab:B,viewDialogOpen:ge,selectedReport:xe,reportData:Te,reportLoading:ze,isCreatingReport:Fe,deletingReportId:be,message:r,messageSeverity:t,isAdmin:Ne,users:he,departments:n,selectedUserId:R,selectedDepartmentId:de,showFilters:We,filterType:P,filterStatus:K,filterStartDate:D,filterEndDate:G,showDeptSummaryFilters:oe,deptSummaryStartDate:$e,deptSummaryEndDate:ke,setActiveTab:E,setIsNewReportDialogOpen:V,handleNewReportChange:at,handleAddReport:ot,handleDeleteReport:dt,handleViewReport:ct,handleEditReport:xt,handleCloseNewReportDialog:ht,handleCloseViewDialog:mt,handleDownloadReport:pt,setSelectedUserId:X,setSelectedDepartmentId:Oe,setShowFilters:De,setFilterType:Z,setFilterStatus:h,setFilterStartDate:I,setFilterEndDate:Ie,setShowDeptSummaryFilters:Se,setDeptSummaryStartDate:we,setDeptSummaryEndDate:Be,loadReports:ve,setUser:Qe,setMessage:y}},Jt=({showFilters:i,setShowFilters:g,filterType:c,setFilterType:p,filterStartDate:v,setFilterStartDate:T,filterEndDate:C,setFilterEndDate:r})=>{const y=Ae(),t=()=>{p("all"),T(""),r("")},s=c!=="all"||v||C;return e.jsxs(Q,{sx:{mb:3,borderRadius:2,overflow:"hidden"},children:[e.jsxs(d,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:i?`1px solid ${y.palette.divider}`:"none"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ft,{sx:{color:y.palette.primary.main}}),e.jsxs(o,{sx:{fontWeight:600,color:y.palette.text.primary},children:["Filters",s&&e.jsx(d,{component:"span",sx:{ml:1,px:1,py:.25,bgcolor:y.palette.primary.main,color:"white",borderRadius:1,fontSize:"0.75rem",fontWeight:600},children:"Active"})]})]}),e.jsxs(d,{sx:{display:"flex",gap:1},children:[s&&e.jsx(Y,{size:"small",onClick:t,sx:{color:y.palette.error.main,"&:hover":{bgcolor:y.palette.error.light}},children:e.jsx(yt,{fontSize:"small"})}),e.jsx(Y,{size:"small",onClick:()=>g(!i),sx:{color:y.palette.primary.main,"&:hover":{bgcolor:y.palette.primary.light}},children:i?e.jsx(bt,{}):e.jsx(it,{})})]})]}),e.jsx(St,{in:i,children:e.jsx(d,{sx:{p:2,bgcolor:y.palette.background.paper},children:e.jsxs(k,{container:!0,spacing:2,children:[e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Me,{fullWidth:!0,size:"small",children:[e.jsx(He,{children:"Report Type"}),e.jsxs(_e,{value:c,label:"Report Type",onChange:a=>p(a.target.value),children:[e.jsx(_,{value:"all",children:"All Types"}),e.jsx(_,{value:"ticket",children:"Ticket Reports"}),e.jsx(_,{value:"task",children:"Task Reports"}),e.jsx(_,{value:"user",children:"User Reports"}),e.jsx(_,{value:"department",children:"Department Reports"}),e.jsx(_,{value:"custom",children:"Custom Reports"})]})]})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ce,{fullWidth:!0,size:"small",label:"Start Date",type:"date",value:v,onChange:a=>T(a.target.value),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:1}}})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ce,{fullWidth:!0,size:"small",label:"End Date",type:"date",value:C,onChange:a=>r(a.target.value),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:1}}})})]})})})]})},qt=({open:i,onClose:g,newReport:c,onNewReportChange:p,onAddReport:v,loading:T,users:C,selectedUserId:r,onSelectedUserIdChange:y})=>{var P,Z,K;const t=Ae(),[s,a]=m.useState([]),[x,H]=m.useState([]);m.useEffect(()=>{var h;c.type==="custom"?a(((h=c.parameters)==null?void 0:h.selectedFields)||[]):a([])},[c.type,(P=c.parameters)==null?void 0:P.selectedFields]);const V=h=>{const D=s.includes(h)?s.filter(I=>I!==h):[...s,h];a(D),p({target:{name:"parameters",value:{...c.parameters,selectedFields:D}}})},f=h=>{const D=Ue[h].map(G=>G.key),I=[...new Set([...s,...D])];a(I),p({target:{name:"parameters",value:{...c.parameters,selectedFields:I}}})},L=h=>{const D=Ue[h].map(G=>G.key),I=s.filter(G=>!D.includes(G));a(I),p({target:{name:"parameters",value:{...c.parameters,selectedFields:I}}})},B=()=>{const h=Vt(c);if(c.type==="user"&&!r&&h.push("User selection is required for user reports"),h.length>0){H(h);return}H([]),v()},E=h=>{switch(h){case"ticket":return e.jsx(et,{color:"error"});case"task":return e.jsx(Ye,{color:"primary"});case"user":return e.jsx(tt,{color:"secondary"});case"department":return e.jsx(Ze,{color:"info"});case"custom":return e.jsx(st,{color:"default"});default:return e.jsx(pe,{})}};return e.jsxs(Ve,{open:i,onClose:g,maxWidth:"md",fullWidth:!0,children:[e.jsxs(Ge,{sx:{borderBottom:`1px solid ${t.palette.divider}`,pb:3,pt:3,px:4,display:"flex",alignItems:"center",gap:2},children:[e.jsx(pe,{sx:{color:t.palette.primary.main,fontSize:28}}),e.jsx(d,{sx:{fontWeight:600,fontSize:"1.25rem"},children:"Generate New Report"})]}),e.jsxs(Je,{sx:{pt:4,pb:3,px:4},children:[x.length>0&&e.jsx(qe,{severity:"error",sx:{mb:3},children:e.jsx(o,{variant:"body2",children:x.join(", ")})}),e.jsxs(k,{container:!0,spacing:3,children:[e.jsx(k,{item:!0,xs:12,sx:{mt:2},children:e.jsxs(Me,{fullWidth:!0,children:[e.jsx(He,{sx:{fontSize:"0.875rem",fontWeight:500},children:"Report Type"}),e.jsxs(_e,{label:"Report Type",name:"type",value:c.type,onChange:p,sx:{borderRadius:2},children:[e.jsx(_,{value:"task",children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ye,{color:"primary"}),"Task Reports"]})}),e.jsx(_,{value:"ticket",children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(et,{color:"error"}),"Ticket Reports"]})}),e.jsx(_,{value:"user",children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(tt,{color:"secondary"}),"User Reports"]})}),e.jsx(_,{value:"department",children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{color:"info"}),"Department Reports"]})}),e.jsx(_,{value:"custom",children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(st,{color:"default"}),"Custom Reports"]})})]})]})}),c.type==="user"&&e.jsx(k,{item:!0,xs:12,md:6,children:e.jsxs(Me,{fullWidth:!0,children:[e.jsx(He,{sx:{fontSize:"0.875rem",fontWeight:500},children:"Select User"}),e.jsx(_e,{label:"Select User",value:r,onChange:h=>y(h.target.value),sx:{borderRadius:2},children:C.map(h=>{var D,I;return e.jsx(_,{value:h.id,children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(Re,{sx:{width:24,height:24,fontSize:"0.75rem"},children:[(D=h.firstname)==null?void 0:D[0],(I=h.lastname)==null?void 0:I[0]]}),h.firstname," ",h.lastname]})},h.id)})})]})}),e.jsx(k,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Report Title",name:"title",value:c.title,onChange:p,required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(k,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Description",name:"description",value:c.description,onChange:p,multiline:!0,rows:3,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(ce,{fullWidth:!0,label:"Start Date",type:"date",name:"startDate",value:((Z=c.parameters)==null?void 0:Z.startDate)||"",onChange:h=>p({target:{name:"parameters",value:{...c.parameters,startDate:h.target.value}}}),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(ce,{fullWidth:!0,label:"End Date",type:"date",name:"endDate",value:((K=c.parameters)==null?void 0:K.endDate)||"",onChange:h=>p({target:{name:"parameters",value:{...c.parameters,endDate:h.target.value}}}),InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),c.type==="custom"&&e.jsxs(k,{item:!0,xs:12,children:[e.jsx(wt,{sx:{my:2}}),e.jsx(o,{variant:"h6",sx:{mb:2},children:"Select Fields to Include"}),Object.entries(Ue).map(([h,D])=>e.jsxs(kt,{defaultExpanded:!0,children:[e.jsx(Ct,{expandIcon:e.jsx(it,{}),children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[E(h.replace("Metrics","")),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600},children:h.replace("Metrics"," Metrics")})]})}),e.jsxs(vt,{children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(ee,{size:"small",onClick:()=>f(h),children:"Select All"}),e.jsx(ee,{size:"small",onClick:()=>L(h),children:"Deselect All"})]}),e.jsx(Rt,{children:D.map(I=>e.jsx(At,{control:e.jsx(It,{checked:s.includes(I.key),onChange:()=>V(I.key),icon:e.jsx(Dt,{}),checkedIcon:e.jsx(Wt,{})}),label:I.label},I.key))})]})]},h))]})]})]}),e.jsxs(Ke,{sx:{p:3,pt:2,borderTop:`1px solid ${t.palette.divider}`,gap:2,justifyContent:"flex-end"},children:[e.jsx(ee,{onClick:g,disabled:T,variant:"outlined",sx:{borderRadius:2,px:3,py:1},children:"Cancel"}),e.jsx(ee,{onClick:B,variant:"contained",disabled:T,startIcon:e.jsx(pe,{}),sx:{borderRadius:2,px:3,py:1,fontWeight:600},children:T?"Generating...":"Generate Report"})]})]})},Zt=({report:i})=>{const g=Ae(),c=t=>{switch(t==null?void 0:t.toLowerCase()){case"completed":case"resolved":return"success";case"pending":return"warning";case"in_progress":case"in progress":return"info";case"declined":case"overdue":return"error";default:return"default"}},p=t=>{switch(t==null?void 0:t.toLowerCase()){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"success";default:return"default"}},v=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}},T=t=>typeof t=="number"?t.toLocaleString():typeof t=="object"&&t!==null?Array.isArray(t)?t.length.toString():Object.keys(t).length.toString():typeof t=="string"?t:String(t||"N/A"),C=t=>t.replace(/([A-Z])/g," $1").trim().replace(/^./,s=>s.toUpperCase()),r=(i==null?void 0:i.data)||(i==null?void 0:i.metrics)||{},y=(i==null?void 0:i.report)||i;return console.log("Report structure:",i),console.log("ReportInfo:",y),console.log("FiltersApplied:",y==null?void 0:y.filtersApplied),e.jsx(d,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs(d,{sx:{flex:1,overflow:"auto",p:3},children:[((y==null?void 0:y.filtersApplied)||(i==null?void 0:i.filtersApplied))&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Filters Applied"}),e.jsx(k,{container:!0,spacing:2,children:Object.entries(y.filtersApplied||i.filtersApplied).map(([t,s])=>{let a="";return typeof s=="string"?a=s:typeof s=="number"?a=s.toString():typeof s=="object"&&s!==null?Array.isArray(s)?a=s.join(", "):a=JSON.stringify(s):a=String(s||"N/A"),e.jsx(k,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(d,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:C(t)}),e.jsx(o,{variant:"body1",sx:{fontWeight:500},children:a})]})},t)})})]})}),(r==null?void 0:r.summary)&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Summary"}),e.jsx(k,{container:!0,spacing:2,children:Object.entries(r.summary).map(([t,s])=>e.jsx(k,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700,color:g.palette.primary.main},children:T(s)}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:C(t)})]})},t))})]})}),((r==null?void 0:r.statusBreakdown)||(r==null?void 0:r.priorityBreakdown))&&e.jsxs(k,{container:!0,spacing:3,sx:{mb:3},children:[r.statusBreakdown&&e.jsx(k,{item:!0,xs:12,md:6,children:e.jsx(U,{children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Status Breakdown"}),r.statusBreakdown.map((t,s)=>e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx($,{label:t.status,color:c(t.status),size:"small",variant:"outlined"}),e.jsxs(o,{variant:"body2",children:[t.count," (",t.percentage,"%)"]})]},s))]})})}),r.priorityBreakdown&&e.jsx(k,{item:!0,xs:12,md:6,children:e.jsx(U,{children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Priority Breakdown"}),r.priorityBreakdown.map((t,s)=>e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx($,{label:t.priority,color:p(t.priority),size:"small",variant:"outlined"}),e.jsx(o,{variant:"body2",children:t.count})]},s))]})})})]}),((r==null?void 0:r.userProfile)||(r==null?void 0:r.departmentProfile))&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:r.userProfile?"User Profile":"Department Profile"}),e.jsx(k,{container:!0,spacing:2,children:Object.entries(r.userProfile||r.departmentProfile).map(([t,s])=>{let a="";return typeof s=="string"?a=s:typeof s=="number"?a=s.toString():typeof s=="object"&&s!==null?Array.isArray(s)?a=s.join(", "):a=JSON.stringify(s):a=String(s||"N/A"),e.jsx(k,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(d,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:C(t)}),e.jsx(o,{variant:"body1",sx:{fontWeight:500},children:a})]})},t)})})]})}),(i==null?void 0:i.type)==="custom"&&(r==null?void 0:r.customMetrics)&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Custom Metrics"}),e.jsx(k,{container:!0,spacing:2,children:Object.entries(r.customMetrics).map(([t,s])=>e.jsx(k,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h5",sx:{fontWeight:700,color:g.palette.primary.main},children:T(s)}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textTransform:"capitalize"},children:C(t)})]})},t))})]})}),(r==null?void 0:r.details)&&r.details.length>0&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Details"}),e.jsx(re,{component:Q,sx:{maxHeight:400},children:e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsx(N,{children:Object.keys(r.details[0]).map(t=>e.jsx(l,{sx:{fontWeight:600,textTransform:"capitalize"},children:C(t)},t))})}),e.jsx(le,{children:r.details.map((t,s)=>e.jsx(N,{children:Object.entries(t).map(([a,x])=>e.jsx(l,{children:a.toLowerCase().includes("status")?e.jsx($,{label:x,color:c(x),size:"small",variant:"outlined"}):a.toLowerCase().includes("priority")?e.jsx($,{label:x,color:p(x),size:"small",variant:"outlined"}):a.toLowerCase().includes("date")?v(x):x||"N/A"},a))},s))})]})})]})}),(r==null?void 0:r.activity)&&r.activity.length>0&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Activity"}),e.jsx(re,{component:Q,sx:{maxHeight:400},children:e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsx(N,{children:Object.keys(r.activity[0]).map(t=>e.jsx(l,{sx:{fontWeight:600,textTransform:"capitalize"},children:C(t)},t))})}),e.jsx(le,{children:r.activity.map((t,s)=>e.jsx(N,{children:Object.entries(t).map(([a,x])=>e.jsx(l,{children:a.toLowerCase().includes("status")?e.jsx($,{label:x,color:c(x),size:"small",variant:"outlined"}):a.toLowerCase().includes("priority")?e.jsx($,{label:x,color:p(x),size:"small",variant:"outlined"}):a.toLowerCase().includes("date")?v(x):x||"N/A"},a))},s))})]})})]})}),(i==null?void 0:i.type)==="custom"&&e.jsxs(e.Fragment,{children:[(r==null?void 0:r.tasks)&&r.tasks.length>0&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsxs(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Tasks (",r.tasks.length,")"]}),e.jsx(re,{component:Q,sx:{maxHeight:400},children:e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(N,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Title"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Priority"}),e.jsx(l,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(l,{sx:{fontWeight:600},children:"Created"})]})}),e.jsx(le,{children:r.tasks.slice(0,10).map((t,s)=>e.jsxs(N,{children:[e.jsx(l,{children:t.title}),e.jsx(l,{children:e.jsx($,{label:t.status,color:c(t.status),size:"small"})}),e.jsx(l,{children:e.jsx($,{label:t.priority||"Medium",color:p(t.priority),size:"small"})}),e.jsx(l,{children:t.taskAssignee?`${t.taskAssignee.firstname} ${t.taskAssignee.lastname}`:"Unassigned"}),e.jsx(l,{children:v(t.createdAt)})]},s))})]})}),r.tasks.length>10&&e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.tasks.length," tasks"]})]})}),(r==null?void 0:r.tickets)&&r.tickets.length>0&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsxs(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Tickets (",r.tickets.length,")"]}),e.jsx(re,{component:Q,sx:{maxHeight:400},children:e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(N,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Title"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Priority"}),e.jsx(l,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(l,{sx:{fontWeight:600},children:"Created"})]})}),e.jsx(le,{children:r.tickets.slice(0,10).map((t,s)=>e.jsxs(N,{children:[e.jsx(l,{children:t.title}),e.jsx(l,{children:e.jsx($,{label:t.status,color:c(t.status),size:"small"})}),e.jsx(l,{children:e.jsx($,{label:t.priority||"Medium",color:p(t.priority),size:"small"})}),e.jsx(l,{children:t.ticketAssignee?`${t.ticketAssignee.firstname} ${t.ticketAssignee.lastname}`:"Unassigned"}),e.jsx(l,{children:v(t.createdAt)})]},s))})]})}),r.tickets.length>10&&e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.tickets.length," tickets"]})]})}),(r==null?void 0:r.users)&&r.users.length>0&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsxs(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Users (",r.users.length,")"]}),e.jsx(re,{component:Q,sx:{maxHeight:400},children:e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(N,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Name"}),e.jsx(l,{sx:{fontWeight:600},children:"Email"}),e.jsx(l,{sx:{fontWeight:600},children:"Role"}),e.jsx(l,{sx:{fontWeight:600},children:"Department"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"})]})}),e.jsx(le,{children:r.users.slice(0,10).map((t,s)=>{var a,x,H;return e.jsxs(N,{children:[e.jsx(l,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(Re,{sx:{width:24,height:24,fontSize:"0.75rem"},children:[(a=t.firstname)==null?void 0:a[0],(x=t.lastname)==null?void 0:x[0]]}),t.firstname," ",t.lastname]})}),e.jsx(l,{children:t.email}),e.jsx(l,{children:e.jsx($,{label:t.role,color:t.role==="admin"?"error":t.role==="department_head"?"warning":"default",size:"small"})}),e.jsx(l,{children:((H=t.department)==null?void 0:H.name)||"N/A"}),e.jsx(l,{children:e.jsx($,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"default",size:"small"})})]},s)})})]})}),r.users.length>10&&e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.users.length," users"]})]})}),(r==null?void 0:r.departments)&&r.departments.length>0&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsxs(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:["Departments (",r.departments.length,")"]}),e.jsx(re,{component:Q,sx:{maxHeight:400},children:e.jsxs(ne,{stickyHeader:!0,children:[e.jsx(ie,{children:e.jsxs(N,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Name"}),e.jsx(l,{sx:{fontWeight:600},children:"Description"}),e.jsx(l,{sx:{fontWeight:600},children:"Employees"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"})]})}),e.jsx(le,{children:r.departments.slice(0,10).map((t,s)=>{var a;return e.jsxs(N,{children:[e.jsx(l,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{color:"info"}),t.name]})}),e.jsx(l,{children:t.description||"N/A"}),e.jsx(l,{children:((a=t.users)==null?void 0:a.length)||0}),e.jsx(l,{children:e.jsx($,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"default",size:"small"})})]},s)})})]})}),r.departments.length>10&&e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:["Showing first 10 of ",r.departments.length," departments"]})]})})]}),(r==null?void 0:r.insights)&&Object.keys(r.insights).length>0&&e.jsx(U,{sx:{mb:3},children:e.jsxs(M,{children:[e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Insights"}),e.jsx(k,{container:!0,spacing:3,children:Object.entries(r.insights).map(([t,s])=>{const a=t.replace(/([A-Z])/g," $1").trim().replace(/^./,f=>f.toUpperCase());let x="",H=!1,V=!1;if((t.toLowerCase().includes("rate")||t.toLowerCase().includes("percentage")||t.toLowerCase().includes("compliance"))&&(H=!0),(t.toLowerCase().includes("time")||t.toLowerCase().includes("duration"))&&(V=!0),Array.isArray(s))s.length===0?x="No data":s.every(f=>typeof f=="object")?x=s.map(f=>{if(typeof f=="object"&&f!==null){const L=Object.entries(f);if(L.length===2){const[B,E]=L;if(typeof E=="object"&&E!==null){const P=Object.entries(E);if(P.length>0)return`${B}: ${P.map(([Z,K])=>`${Z}: ${K}`).join(", ")}`}return`${B}: ${E}`}return JSON.stringify(f)}return String(f)}).join("; "):x=s.join(", ");else if(typeof s=="object"&&s!==null){const f=Object.entries(s);f.length===0?x="No data":f.length<=3?x=f.map(([L,B])=>{if(typeof B=="object"&&B!==null){const E=Object.entries(B);if(E.length>0)return`${L}: ${E.map(([P,Z])=>`${P}: ${Z}`).join(", ")}`}return`${L}: ${B}`}).join("; "):x=`${f.length} items`}else typeof s=="number"?H?x=`${s.toFixed(1)}%`:V?s<1?x=`${(s*24).toFixed(1)} hours`:x=`${s.toFixed(1)} days`:x=s.toLocaleString():typeof s=="string"?x=s:s==null?x="N/A":x=String(s);return e.jsx(k,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(d,{sx:{p:2,border:`1px solid ${g.palette.divider}`,borderRadius:2,backgroundColor:g.palette.background.paper,height:"100%"},children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:1,fontWeight:500},children:a}),e.jsx(o,{variant:"body1",sx:{fontWeight:600,color:g.palette.primary.main,wordBreak:"break-word",lineHeight:1.4},children:x})]})},t)})})]})})]})})},ts=()=>{const i=Ae(),{user:g}=Lt.useContext(Ut),c=Tt(i.breakpoints.down("md")),{reports:p,loading:v,error:T,isNewReportDialogOpen:C,newReport:r,activeTab:y,viewDialogOpen:t,selectedReport:s,reportData:a,reportLoading:x,isCreatingReport:H,deletingReportId:V,message:f,messageSeverity:L,users:B,selectedUserId:E,showFilters:P,filterType:Z,filterStatus:K,filterStartDate:h,filterEndDate:D,setActiveTab:I,setIsNewReportDialogOpen:G,handleNewReportChange:Ie,handleAddReport:We,handleDeleteReport:De,handleViewReport:ge,handleCloseNewReportDialog:ue,handleCloseViewDialog:xe,handleDownloadReport:te,setSelectedUserId:Te,setShowFilters:je,setFilterType:ze,setFilterStatus:fe,setFilterStartDate:Fe,setFilterEndDate:ye,setMessage:be}=Gt(g),[ae,oe]=m.useState(null);if(!g)return e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Le,{})});const Se=n=>{oe(n)},$e=async()=>{ae&&(await De(ae),oe(null))},we=n=>({ticket:"primary",task:"secondary",user:"success",department:"warning",custom:"info"})[n]||"default",ke=n=>({ticket:"🎫",task:"📋",user:"👤",department:"🏢",custom:"📊"})[n]||"📄",Be=n=>({ticket:"Ticket Report",task:"Task Report",user:"User Report",department:"Department Report",custom:"Custom Report"})[n]||"Report",he=n=>{const{type:z,parameters:R,title:X}=n;switch(z){case"user":return(R==null?void 0:R.userName)||Ce(X,"User Report -")||"User Report";case"department":return(R==null?void 0:R.departmentName)||Ce(X,"Department Report -")||"Department Report";case"task":case"ticket":return R!=null&&R.global?"All Departments":"Filtered";case"custom":return"Custom Scope";default:return"N/A"}},Ce=(n,z)=>{if(!n||!n.includes(z))return null;const R=n.match(new RegExp(`${z} (.+?) -`));return R?R[1]:null};return v?e.jsx(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Le,{})}):e.jsxs(d,{sx:{p:{xs:2,md:4},backgroundColor:i.palette.background.default,minHeight:"100vh"},children:[e.jsx(Mt,{title:"Reports",subtitle:"Generate and manage comprehensive reports",emoji:"📊",color:"secondary",actionButton:{icon:e.jsx(zt,{}),text:"Generate Report",onClick:()=>G(!0),disabled:v}}),T&&e.jsx(qe,{severity:"error",sx:{mb:2},children:T}),e.jsx(Q,{sx:{mb:3,borderRadius:2},children:e.jsx(Ft,{value:y,onChange:(n,z)=>I(z),indicatorColor:"primary",textColor:"primary",variant:"fullWidth",sx:{"& .MuiTab-root":{fontWeight:600,fontSize:{xs:"0.875rem",sm:"1rem"},minHeight:{xs:48,sm:56}}},children:e.jsx($t,{label:"All Reports"})})}),e.jsx(Jt,{showFilters:P,setShowFilters:je,filterType:Z,setFilterType:ze,filterStartDate:h,setFilterStartDate:Fe,filterEndDate:D,setFilterEndDate:ye,filterStatus:K,setFilterStatus:fe}),p.length===0?e.jsxs(d,{sx:{p:4,textAlign:"center",color:"text.secondary"},children:[e.jsx(pe,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(o,{variant:"h6",sx:{mb:1},children:"No reports found"}),e.jsx(o,{variant:"body2",children:"Generate your first report to get started."})]}):e.jsx(e.Fragment,{children:c?e.jsx(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:p.map(n=>e.jsxs(Q,{sx:{p:2,borderRadius:2,boxShadow:1,transition:"all 0.2s","&:hover":{boxShadow:3,transform:"translateY(-2px)"}},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Re,{sx:{bgcolor:"primary.main",width:40,height:40},children:ke(n.type)}),e.jsxs(d,{children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600},children:n.title||n.name||"Untitled Report"}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["ID: ",n.id]})]})]}),e.jsx($,{label:Be(n.type),size:"small",color:we(n.type),variant:"outlined"})]}),e.jsxs(d,{sx:{mb:2},children:[e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[e.jsx("strong",{children:"Target:"})," ",he(n)]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[e.jsx("strong",{children:"Generated By:"})," ",n.generatedBy||n.createdBy||"Unknown"]}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Created:"})," ",new Date(n.createdAt).toLocaleString()]})]}),e.jsxs(d,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(q,{title:"View Report",children:e.jsx(Y,{size:"small",onClick:()=>ge(n),sx:{color:i.palette.primary.main},children:e.jsx(rt,{})})}),e.jsx(q,{title:"Download PDF",children:e.jsx(Y,{size:"small",onClick:()=>{const X=`${(n.title||n.name||"report").replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;te(n,X)},sx:{color:i.palette.success.main},children:e.jsx(Ee,{})})}),e.jsx(q,{title:"Delete Report",children:e.jsx(Y,{size:"small",onClick:()=>Se(n.id),sx:{color:i.palette.error.main},children:e.jsx(nt,{})})})]})]},n.id))}):e.jsx(re,{component:Q,sx:{borderRadius:3,boxShadow:3,overflowX:"auto",width:"100%",maxWidth:"100vw",bgcolor:"background.paper"},children:e.jsxs(ne,{size:"medium",sx:{minWidth:{md:0,lg:900},width:"100%",tableLayout:"fixed"},children:[e.jsx(ie,{children:e.jsxs(N,{sx:{position:"sticky",top:0,zIndex:2,bgcolor:"background.paper",boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},children:[e.jsx(l,{padding:"checkbox",sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},width:{md:36,lg:48}}}),e.jsx(l,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},width:{md:56,lg:80}},children:"Type"}),e.jsx(l,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},maxWidth:{md:120,lg:220},minWidth:80},children:"Report"}),e.jsx(l,{align:"center",sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},width:{md:60,lg:120},maxWidth:{md:80,lg:160}},children:"Target"}),e.jsx(l,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},maxWidth:{md:80,lg:160}},children:"Generated By"}),e.jsx(l,{sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},maxWidth:{md:80,lg:160}},children:"Created"}),e.jsx(l,{align:"right",sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},borderBottom:"2px solid",borderColor:"divider",px:{md:.5,lg:2},minWidth:{md:60,lg:80}},children:"Actions"})]})}),e.jsx(le,{children:p.map((n,z)=>e.jsxs(N,{hover:!0,sx:{bgcolor:z%2===0?"background.default":"background.paper",transition:"background 0.2s","&:hover":{bgcolor:"action.hover"}},children:[e.jsx(l,{padding:"checkbox",sx:{px:{md:.5,lg:2},width:{md:36,lg:48}}}),e.jsx(l,{sx:{px:{md:.5,lg:2},width:{md:56,lg:80}},children:e.jsx(Re,{sx:{bgcolor:"primary.main",width:{md:22,lg:32},height:{md:22,lg:32},boxShadow:"0 1px 4px rgba(0,0,0,0.08)"},children:ke(n.type)})}),e.jsxs(l,{sx:{maxWidth:{md:120,lg:220},minWidth:80,px:{md:.5,lg:2}},children:[e.jsx(q,{title:n.title||n.name||"Untitled Report",children:e.jsx(o,{variant:"subtitle1",noWrap:!0,sx:{fontWeight:700,fontSize:{md:"0.92rem",lg:"1rem"},wordBreak:"break-word",maxWidth:{md:110,lg:200},overflow:"hidden",textOverflow:"ellipsis"},children:n.title||n.name||"Untitled Report"})}),e.jsx(q,{title:`ID: ${n.id}`,children:e.jsxs(o,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{fontSize:{md:"0.8rem",lg:"0.92rem"},lineHeight:1.4,wordBreak:"break-word",maxWidth:{md:110,lg:200},overflow:"hidden",textOverflow:"ellipsis"},children:["ID: ",n.id]})})]}),e.jsx(l,{align:"center",sx:{px:{md:.5,lg:2},width:{md:60,lg:120},maxWidth:{md:80,lg:160}},children:e.jsx(q,{title:`Target: ${he(n)}`,arrow:!0,children:e.jsx("span",{children:e.jsx($,{label:he(n),size:"small",color:we(n.type),sx:{fontSize:{md:"0.65rem",lg:"0.78rem"},fontWeight:600,borderRadius:2,px:1,height:{md:16,lg:22},boxShadow:1,minWidth:{lg:70},justifyContent:"center"}})})})}),e.jsx(l,{sx:{maxWidth:{md:80,lg:160},px:{md:.5,lg:2}},children:e.jsx(q,{title:`Generated by: ${n.generatedBy||n.createdBy||"Unknown"}`,arrow:!0,children:e.jsx(o,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:"0.78rem",overflow:"hidden",textOverflow:"ellipsis"},children:n.generatedBy||n.createdBy||"Unknown"})})}),e.jsx(l,{sx:{maxWidth:{md:80,lg:160},px:{md:.5,lg:2}},children:e.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(q,{title:new Date(n.createdAt).toLocaleString(),arrow:!0,children:e.jsx(d,{sx:{display:"flex",alignItems:"center",gap:.5},children:e.jsx(o,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:{md:"0.7rem",lg:"0.78rem"},maxWidth:{md:60,lg:70}},children:new Date(n.createdAt).toLocaleDateString()})})}),e.jsx(o,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:{md:"0.6rem",lg:"0.7rem"},maxWidth:{md:60,lg:70}},children:new Date(n.createdAt).toLocaleTimeString()})]})}),e.jsx(l,{align:"right",sx:{minWidth:{md:60,lg:80},px:{md:.5,lg:2}},children:e.jsx(d,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:.2,flexWrap:"wrap",justifyContent:"flex-end",bgcolor:"action.selected",borderRadius:2,px:1,py:.5,boxShadow:1},children:[e.jsx(q,{title:"View Report",children:e.jsx("span",{children:e.jsx(Y,{color:"primary",size:"small",onClick:()=>ge(n),children:e.jsx(rt,{fontSize:"small"})})})}),e.jsx(q,{title:"Download PDF",children:e.jsx("span",{children:e.jsx(Y,{color:"success",size:"small",onClick:()=>{const de=`${(n.title||n.name||"report").replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;te(n,de)},children:e.jsx(Ee,{fontSize:"small"})})})}),e.jsx(q,{title:"Delete Report",children:e.jsx("span",{children:e.jsx(Y,{color:"error",size:"small",onClick:()=>Se(n.id),children:e.jsx(nt,{fontSize:"small"})})})})]})})})]},n.id))})]})})}),e.jsx(qt,{open:C,onClose:ue,newReport:r,onNewReportChange:Ie,onAddReport:We,loading:H,users:B,selectedUserId:E,onSelectedUserIdChange:Te}),t&&s&&e.jsxs(Ve,{open:t,onClose:xe,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh"}},children:[e.jsxs(Ge,{sx:{borderBottom:`1px solid ${i.palette.divider}`,pb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(pe,{sx:{color:i.palette.primary.main}}),e.jsxs(d,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:s.title||s.name||"Report"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Generated on ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsx(Y,{onClick:xe,size:"small",children:e.jsx(Bt,{})})]}),e.jsx(Je,{sx:{p:0},children:x?e.jsx(d,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(Le,{})}):e.jsx(Zt,{report:a||s,onExport:te})}),e.jsxs(Ke,{sx:{p:3,borderTop:`1px solid ${i.palette.divider}`},children:[e.jsx(ee,{onClick:xe,variant:"outlined",sx:{borderRadius:2,px:3},children:"Close"}),e.jsx(ee,{onClick:()=>{const R=`${(s.title||s.name||"report").replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;te(s,R)},variant:"contained",startIcon:e.jsx(Ee,{}),sx:{borderRadius:2,px:3},children:"Download PDF"})]})]}),e.jsxs(Ve,{open:!!ae,onClose:()=>oe(null),maxWidth:"xs",fullWidth:!0,children:[e.jsxs(Ge,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ot,{color:"warning",sx:{mr:1}}),"Confirm Delete"]}),e.jsx(Je,{children:e.jsx(o,{variant:"body1",sx:{mb:2},children:"Are you sure you want to delete this report? This action cannot be undone."})}),e.jsxs(Ke,{children:[e.jsx(ee,{onClick:()=>oe(null),variant:"outlined",children:"Cancel"}),e.jsx(ee,{onClick:$e,color:"error",variant:"contained",disabled:!!V,children:V?"Deleting…":"Delete"})]})]}),e.jsx(Nt,{open:!!f,autoHideDuration:4e3,onClose:()=>be(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(qe,{onClose:()=>be(null),severity:L,sx:{width:"100%"},children:f})})]})};export{ts as default};
