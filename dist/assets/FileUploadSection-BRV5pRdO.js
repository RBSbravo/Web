import{u as le,j as t,B as f,b as m,V as de,r as ce,n as me,a7 as Te,k as _e,am as De,q as pe,I as ue,J as he,H as fe,as as Ue,y as j,t as K,v as Y,x as X,a3 as Fe,p as Pe,aN as Re,h as ie,aw as Ne,ao as ze,w as $e}from"./mui-DaYlJXyD.js";import{r as p,b as xe}from"./vendor-Cr2nE3UY.js";const Be=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(n){return console.error("Error formatting date:",n),"N/A"}},Ie=e=>{if(!e)return"N/A";try{const n=new Date(e);return isNaN(n.getTime())?"N/A":n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(n){return console.error("Error formatting date time:",n),"N/A"}},We=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"warning";case"in_progress":case"in progress":return"primary";case"completed":case"resolved":return"success";case"declined":case"cancelled":return"error";default:return"default"}},He=e=>{switch((e||"").toLowerCase()){case"pending":case"open":return"Schedule";case"in_progress":case"in progress":return"Schedule";case"completed":case"resolved":return"CheckCircle";case"declined":case"cancelled":return"Error";default:return"ConfirmationNumber"}},qe=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"error";case"medium":case"normal":return"warning";case"low":return"success";default:return"default"}},Ve=e=>{switch((e||"").toLowerCase()){case"high":case"urgent":return"PriorityHigh";case"medium":case"normal":return"Remove";case"low":return"LowPriority";default:return"Remove"}},Ge=e=>{const n=new Date,i=new Date(e.created_at||e.createdAt),l=e.due_date?new Date(e.due_date):null,a=(e.status||"").toLowerCase();if(a==="completed"||a==="resolved"||a==="declined"||a==="cancelled")return null;if(l&&l<n)return"error";if(a==="in_progress"||a==="in progress"){const o=(n-i)/36e5;return o<=72?"success":o<=72+3*24?"warning":"error"}if((a==="pending"||a==="open")&&l){const o=(l-n)/36e5;if(o<0)return"error";if(o<=24)return"error";if(o<=72)return"warning"}return null},Je=e=>{const n=new Date,i=new Date(e.created_at||e.createdAt),l=e.due_date?new Date(e.due_date):null,a=(e.status||"").toLowerCase();if(a==="completed"||a==="resolved"||a==="declined"||a==="cancelled")return null;if(l&&l<n){const o=Math.floor((n-l)/864e5);return`Overdue by ${o} day${o!==1?"s":""}`}if(a==="in_progress"||a==="in progress"){const o=(n-i)/36e5;return o<=72?"Fresh":o<=72+3*24?"Aging":"Stale"}if((a==="pending"||a==="open")&&l){const o=(l-n)/36e5;if(o<0){const u=Math.floor(Math.abs(o)/24);return`Overdue by ${u} day${u!==1?"s":""}`}else{if(o<=24)return"Due Soon";if(o<=72)return"Due in 3 days"}}return null},Ke=(e,n,i,l,a,o,u,v)=>{const T=Array.isArray(e)?e:[],R=Array.isArray(n)?n:[],C=Array.isArray(i)?i:[],U=T.filter(h=>{var _;return((_=h.ticketCreator)==null?void 0:_.id)===v||h.created_by===v||h.createdBy===v||h.original_creator_id===v});let g;switch(u){case 0:g=U;break;case 1:g=R;break;case 2:console.log("Filtering forwarded tickets:",{forwardedTicketsArray:C,length:C.length,userId:v}),g=C;break;default:g=U}return g.filter(h=>{var F,k,z;const _=!l||((F=h.title)==null?void 0:F.toLowerCase().includes(l.toLowerCase()))||((k=h.description)==null?void 0:k.toLowerCase().includes(l.toLowerCase()))||((z=h.id)==null?void 0:z.toString().includes(l))||(h.ticketCreator?`${h.ticketCreator.firstname} ${h.ticketCreator.lastname}`:"").toLowerCase().includes(l.toLowerCase())||(h.ticketAssignee?`${h.ticketAssignee.firstname} ${h.ticketAssignee.lastname}`:"").toLowerCase().includes(l.toLowerCase()),N=a==="all"||(h.status||"").toLowerCase()===a.toLowerCase(),B=o==="all"||(h.priority||"").toLowerCase()===o.toLowerCase();return _&&N&&B})},Ye=e=>{let n="";if(e.due_date)try{const i=new Date(e.due_date);isNaN(i.getTime())||(n=i.toISOString().split("T")[0])}catch(i){console.error("Error formatting date:",i)}return{id:e.id,title:e.title||"",description:e.description||"",priority:e.priority?e.priority.charAt(0).toUpperCase()+e.priority.slice(1):"Medium",status:e.status||"pending",due_date:n,departmentId:e.departmentId||e.department_id||"",sendTo:e.assignedTo||e.assigned_to||"",createdBy:e.createdBy||e.created_by||"",desired_action:e.desired_action||"",remarks:e.remarks||""}},Xe=(e,n,i)=>{var a,o,u;const l={title:(a=e.title)==null?void 0:a.trim(),description:(o=e.description)==null?void 0:o.trim(),priority:(e.priority||"Medium").toLowerCase(),status:e.status||"pending",desired_action:(u=e.desired_action)==null?void 0:u.trim()};return e.id&&(l.id=e.id),e.due_date&&(l.due_date=e.due_date),e.remarks&&(l.remarks=e.remarks),e.departmentId?l.department_id=e.departmentId:i!=null&&i.departmentId&&(l.department_id=i.departmentId),e.sendTo&&(l.assigned_to=e.sendTo),l},Ze=(e,n=!1)=>{var l,a,o,u;const i=[];return(l=e.title)!=null&&l.trim()||i.push("Ticket title is required."),(a=e.description)!=null&&a.trim()||i.push("Ticket description is required."),e.priority||i.push("Please select a priority level."),(o=e.desired_action)!=null&&o.trim()||i.push("Desired action is required."),e.sendTo||i.push("Please select who to send the ticket to."),n&&!e.id&&i.push("Ticket ID is required for updates."),n&&!((u=e.remarks)!=null&&u.trim())&&i.push("Remarks are required when updating a ticket. Please provide remarks explaining the changes made."),i},Qe=(e,n)=>({id:`temp-${Date.now()}-${Math.random()}`,name:e.name,size:e.size,type:e.type,file:e,uploadedAt:new Date().toISOString(),uploadedBy:n.firstname+" "+n.lastname}),et=e=>{if(e&&e.file){const n=URL.createObjectURL(e.file),i=document.createElement("a");i.href=n,i.download=e.name,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}},tt=e=>{if(e===0)return"0 Bytes";const n=1024,i=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,l)).toFixed(2))+" "+i[l]},rt=e=>e?typeof e=="string"?e:`${e.firstname||e.firstName||""} ${e.lastname||e.lastName||""}`.trim()||e.email||e.username||"Unknown User":"Unknown User",nt=({entityId:e,fetchComments:n,addComment:i,deleteComment:l,user:a})=>{const o=le(),[u,v]=p.useState([]),[T,R]=p.useState(!0),[C,U]=p.useState(""),[g,h]=p.useState(!1),[_,N]=p.useState(null),[B,F]=p.useState(!1),[k,z]=p.useState(""),M=r=>a?r.author_id===a.id||r.authorId===a.id||r.userId===a.id||r.author&&r.author.id===a.id||r.commentUser&&r.commentUser.id===a.id:!1,Z=r=>!a||r.comment_type==="update"||r.content&&r.content.startsWith("üìù **Task Updated**")?!1:r.author_id===a.id||r.authorId===a.id||r.userId===a.id||r.author&&r.author.id===a.id||r.commentUser&&r.commentUser.id===a.id,$=async()=>{R(!0);try{const r=await n(e),x=r.data||r||[];v(x)}catch(r){console.error("Error loading comments:",r),v([])}finally{R(!1)}};p.useEffect(()=>{e&&$()},[e]);const P=async r=>{if(r.preventDefault(),!!C.trim()){h(!0),z("");try{console.log("Submitting comment:",{entityId:e,content:C}),await i(e,{content:C}),U(""),$()}catch(x){let A="Failed to add comment.";x.response&&x.response.data&&(x.response.data.error?A=x.response.data.error:x.response.data.errors&&Array.isArray(x.response.data.errors)?A=x.response.data.errors.map(S=>S.msg||S.error||JSON.stringify(S)).join(`
`):A=JSON.stringify(x.response.data)),z(A)}finally{h(!1)}}},q=r=>{N(r),F(!0)},Q=async()=>{if(_)try{await l(_),F(!1),N(null),$()}catch{}};return t.jsxs(f,{sx:{mt:3},children:[t.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Comments"}),T?t.jsx(de,{size:24}):t.jsxs(ce,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2},children:[u.length===0&&t.jsx(m,{variant:"body2",color:"text.secondary",children:"No comments yet."}),u.map(r=>{var x,A,S;return t.jsxs(xe.Fragment,{children:[t.jsxs(me,{alignItems:"flex-start",sx:{px:2,py:1.5,bgcolor:M(r)?"primary.light10":"transparent",border:M(r)?`1px solid ${o.palette.primary.light}`:"none",borderRadius:M(r)?1:0,"&:hover":{bgcolor:M(r)?"primary.light15":"action.hover"}},secondaryAction:Z(r)&&t.jsx(ue,{edge:"end","aria-label":"delete comment",onClick:()=>q(r.id),size:"small",sx:{color:o.palette.error.main,"&:hover":{backgroundColor:o.palette.error.light+"20",color:o.palette.error.dark},transition:"all 0.2s ease-in-out"},children:t.jsx(he,{fontSize:"small"})}),children:[t.jsx(Te,{children:t.jsx(_e,{children:t.jsx(De,{})})}),t.jsx(pe,{primary:t.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[t.jsx(m,{sx:{fontWeight:500},component:"span",children:typeof r.commentUser=="object"?r.commentUser.firstname&&r.commentUser.lastname?`${r.commentUser.firstname} ${r.commentUser.lastname}`:r.commentUser.firstName&&r.commentUser.lastName?`${r.commentUser.firstName} ${r.commentUser.lastName}`:r.commentUser.username||r.commentUser.email||r.commentUser.id:r.commentUser}),t.jsx(m,{variant:"caption",color:"text.disabled",component:"span",children:new Date(r.createdAt).toLocaleString()})]}),secondary:t.jsx(m,{variant:"body2",color:"text.secondary",component:"span",sx:{lineHeight:1.5,fontSize:"0.875rem"},children:r.content&&r.content.startsWith("üìù **Task Updated**")?t.jsxs(f,{children:[t.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Task Updated"}),t.jsxs(f,{sx:{color:o.palette.text.primary,backgroundColor:"#f5f5f5",padding:"8px 12px",borderRadius:"6px",borderLeft:"3px solid #e0e0e0",display:"inline-block",width:"100%"},children:[t.jsx(m,{variant:"body2",sx:{fontWeight:"normal",mb:.5,color:o.palette.text.secondary},children:"Remarks:"}),t.jsx(m,{variant:"body2",sx:{fontWeight:"normal"},children:r.content.replace("üìù **Task Updated**","").replace(/^\n+/,"").replace(/^Remarks:\n?/,"")})]})]}):r.comment_type==="update"?t.jsxs(f,{children:[t.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Updated"}),t.jsxs(f,{sx:{color:o.palette.text.primary,backgroundColor:"#f5f5f5",padding:"8px 12px",borderRadius:"6px",borderLeft:"3px solid #e0e0e0",display:"inline-block",width:"100%"},children:[t.jsx(m,{variant:"body2",sx:{fontWeight:"normal",mb:.5,color:o.palette.text.secondary},children:"Remarks:"}),t.jsx(m,{variant:"body2",sx:{fontWeight:"normal"},children:r.content.split(`
`).slice(2).join(`
`).replace(`Remarks:
`,"")})]})]}):r.comment_type==="forward"?t.jsxs(f,{children:[t.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Ticket Forwarded"}),t.jsxs(f,{sx:{color:o.palette.info.main,backgroundColor:o.palette.info.light,padding:"4px 8px",borderRadius:"4px",borderLeft:`4px solid ${o.palette.info.main}`,display:"inline-block",mb:1},children:[t.jsxs(m,{variant:"body2",sx:{mb:.5},children:[t.jsx("strong",{children:"To:"})," ",(x=r.content.split(`
`)[2])==null?void 0:x.replace("To: ","")]}),t.jsxs(m,{variant:"body2",children:[t.jsx("strong",{children:"Reason:"})," ",(A=r.content.split(`
`)[3])==null?void 0:A.replace("Reason: ","")]})]})]}):r.comment_type==="response"?t.jsxs(f,{children:[t.jsx(m,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Forward Response"}),t.jsxs(m,{variant:"body2",sx:{mb:.5},children:["Action: ",(S=r.content.split(`
`)[2])==null?void 0:S.replace("Action: ","")]}),r.content.split(`
`)[3]&&t.jsx(m,{variant:"body2",sx:{mb:1},children:r.content.split(`
`)[3]})]}):r.content})})]}),t.jsx(fe,{variant:"inset",component:"li"})]},r.id)})]}),t.jsxs(f,{component:"form",onSubmit:P,sx:{display:"flex",gap:1,mt:1},children:[t.jsx(Ue,{size:"small",fullWidth:!0,placeholder:"Add a comment...",value:C,onChange:r=>U(r.target.value),disabled:g}),t.jsx(j,{type:"submit",variant:"contained",disabled:g||!C.trim(),children:"Post"})]}),k&&t.jsx(m,{color:"error",variant:"body2",sx:{mb:1},children:k}),t.jsxs(K,{open:B,onClose:()=>F(!1),children:[t.jsx(Y,{sx:{pb:1},children:"Delete this comment?"}),t.jsxs(X,{sx:{px:3,pb:2},children:[t.jsx(j,{onClick:()=>F(!1),variant:"outlined",sx:{borderColor:o.palette.divider,color:"text.secondary","&:hover":{borderColor:o.palette.action.hover,backgroundColor:o.palette.action.hover}},children:"Cancel"}),t.jsx(j,{color:"error",variant:"contained",onClick:Q,sx:{backgroundColor:"error.main","&:hover":{backgroundColor:"error.dark"},boxShadow:"0 2px 4px rgba(244, 67, 54, 0.3)","&:active":{boxShadow:"0 1px 2px rgba(244, 67, 54, 0.3)"}},children:"Delete"})]})]})]})},ge=e=>{if(e===0)return"0 Bytes";const n=1024,i=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,l)).toFixed(2))+" "+i[l]},Ee=(e,n={})=>{const{maxFileSize:i=10*1024*1024,acceptedTypes:l=["*/*"],maxFiles:a=5,currentFileCount:o=0}=n,u=[];return o>=a&&u.push(`Maximum ${a} files allowed`),e.size>i&&u.push(`File size must be less than ${ge(i)}`),l.length>0&&l[0]!=="*/*"&&(l.some(T=>T.endsWith("/*")?e.type.startsWith(T.replace("/*","")):e.type===T)||u.push(`File type not supported. Allowed: ${l.join(", ")}`)),{isValid:u.length===0,errors:u}},st=({entityId:e,fetchFiles:n,uploadFile:i,deleteFile:l,maxFiles:a=5,maxFileSize:o=10*1024*1024,acceptedTypes:u=["*/*"],disabled:v=!1,readOnly:T=!1,entityType:R="general"})=>{const C=le(),[U,g]=p.useState([]),[h,_]=p.useState(!0),[N,B]=p.useState(!1),[F,k]=p.useState(""),[z,M]=p.useState(null),[Z,$]=p.useState(!1),[P,q]=p.useState(null),[Q,r]=p.useState(!1),[x,A]=p.useState(!1),[S,O]=p.useState("image"),[E,ee]=p.useState(""),[re,V]=p.useState(""),[we,G]=p.useState(""),[be,te]=p.useState(!1),J=p.useCallback(async()=>{_(!0);try{const s=await n(e),d=s.data||s||[];if(!Array.isArray(d)){console.warn("Files data is not an array:",d),g([]);return}g(d.map(c=>({...c,name:c.name||c.file_name,file_name:c.file_name||c.name,file_size:c.file_size||c.size,url:c.url||`/api/files/${c.id}/download`,uploadedAt:c.uploadedAt||c.createdAt||c.created_at})))}catch(s){console.error("Error loading files:",s),g([])}finally{_(!1)}},[n,e]);p.useEffect(()=>{e?J():(_(!1),g([]))},[e]);const ye=p.useCallback(async s=>{var I,b,W,H,ne,se,oe,ae;k("");const d=s.target.files[0];if(!d)return;let c=u;R==="task"&&u[0]==="*/*"&&(c=["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp"]);const w=Ee(d,{maxFileSize:o,acceptedTypes:c,maxFiles:a,currentFileCount:U.length});if(!w.isValid){k(w.errors.join(", "));return}B(!0);try{await i(e,d),e?await J():setTimeout(()=>{n&&n(e).then(y=>{const D=y.data||y||[];Array.isArray(D)&&g(D.map(L=>({...L,name:L.name||L.file_name,file_name:L.file_name||L.name,file_size:L.file_size||L.size,url:L.url||`/api/files/${L.id}/download`,uploadedAt:L.uploadedAt||L.createdAt||L.created_at})))}).catch(()=>{})},100)}catch(y){let D="Failed to upload file";y.message.includes("Network Error")||y.message.includes("Cannot connect")?D="Cannot connect to server. Please check if the backend is running.":((I=y.response)==null?void 0:I.status)===413?D="File is too large. Maximum size is 10MB.":((b=y.response)==null?void 0:b.status)===400?D=((H=(W=y.response)==null?void 0:W.data)==null?void 0:H.error)||"Invalid file or request.":((ne=y.response)==null?void 0:ne.status)===401?D="Authentication required. Please log in again.":((se=y.response)==null?void 0:se.status)===404?D="Ticket not found. The ticket may have been deleted.":(ae=(oe=y.response)==null?void 0:oe.data)!=null&&ae.error?D=y.response.data.error:y.message&&(D=y.message),k(D)}finally{B(!1)}},[U.length,a,o,u,i,e,J,n]),je=s=>{M(s),$(!0)},ve=async()=>{if(z)try{await l(e,z),$(!1),M(null),e&&await J()}catch(s){console.error("Error deleting file:",s),k("Failed to delete file")}},Ce=s=>{const d=s.uploadedAt||s.createdAt||s.created_at;if(!d)return"‚Äî";const c=new Date(d);return isNaN(c.getTime())?"‚Äî":c.toLocaleString()},ke=async s=>{const d=localStorage.getItem("token");try{const c=await fetch(s.url,{headers:{Authorization:`Bearer ${d}`}});if(!c.ok){alert("Failed to download file");return}const w=await c.blob();if(w.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");const I=window.URL.createObjectURL(w),b=document.createElement("a");b.href=I,b.download=s.name,document.body.appendChild(b),b.click(),b.remove(),window.URL.revokeObjectURL(I)}catch{alert("Failed to download file")}},Ae=s=>{q(s),r(!0)},Se=async()=>{if(P)try{if(e)await ke(P);else if(P.file){const s=URL.createObjectURL(P.file),d=document.createElement("a");d.href=s,d.download=P.name,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(s)}}catch(s){console.error("Error downloading file:",s),k("Failed to download file")}r(!1),q(null)},Le=async s=>{try{let d,c;if(e){const W=`https://backend-ticketing-system.up.railway.app/api/files/${s.id}/download`,H=await fetch(W,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!H.ok)throw new Error(`HTTP error! status: ${H.status}`);if(d=await H.blob(),d.type==="text/html")throw new Error("Backend returned HTML instead of file. Check server logs.");c=URL.createObjectURL(d)}else if(s.file)d=s.file,c=URL.createObjectURL(s.file);else throw new Error("File object not available for preview");let w=d.type;const b=(s.file_name||s.name||"").split(".").pop().toLowerCase();if((!w||w==="application/octet-stream")&&(["jpg","jpeg","png","gif","bmp","webp"].includes(b)?w="image/"+b:b==="pdf"?w="application/pdf":["txt","csv","json","md","log"].includes(b)&&(w="text/plain")),ee(c),V(""),G(""),w.startsWith("image/"))O("image");else if(w==="application/pdf")O("pdf");else if(w.startsWith("text/")||["txt","csv","json","md","log"].includes(b)){const W=await d.text();V(W),O("text")}else O("unsupported");A(!0)}catch(d){console.error("Error viewing file:",d),G(d.message),O("error"),A(!0)}};return t.jsxs(f,{sx:{mt:3},children:[F&&t.jsx(Fe,{severity:"error",sx:{mb:2},onClose:()=>k(""),children:F}),t.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Attachments"}),h?t.jsx(de,{size:24}):t.jsxs(ce,{dense:!0,sx:{maxHeight:200,overflowY:"auto",mb:2,scrollbarWidth:"none",msOverflowStyle:"none","&::-webkit-scrollbar":{display:"none"}},children:[U.length===0&&t.jsx(m,{variant:"body2",color:"text.secondary",children:"No attachments yet."}),U.map(s=>{const d=s.file_name||s.name||"Unknown File";return t.jsxs(xe.Fragment,{children:[t.jsxs(me,{secondaryAction:!T&&t.jsx(ie,{title:"Delete file",arrow:!0,children:t.jsx(ue,{edge:"end",onClick:()=>je(s.id),color:"error",size:"small",sx:{"&:hover":{backgroundColor:"error.light",color:"error.contrastText"}},children:t.jsx(he,{fontSize:"small"})})}),children:[t.jsx(Pe,{children:t.jsx(Re,{})}),t.jsx(pe,{primary:t.jsx(ie,{title:"Click to download or view file",arrow:!0,children:t.jsx(m,{component:"span",sx:{cursor:"pointer",color:"primary.main",textDecoration:"underline","&:hover":{textDecoration:"none"}},onClick:()=>Ae(s),children:d})}),secondary:t.jsxs(m,{variant:"caption",color:"text.disabled",children:[Ce(s)," ‚Ä¢ ",ge(s.file_size||s.size||0)]})})]}),t.jsx(fe,{variant:"inset",component:"li"})]},s.id)})]}),!T&&t.jsxs(j,{variant:"outlined",component:"label",startIcon:t.jsx(Ne,{}),disabled:v||N,sx:{mt:1},children:[N?"Uploading...":R==="task"?"Upload File (PDF & Images Only)":"Upload File",t.jsx("input",{type:"file",hidden:!0,onChange:ye,accept:R==="task"?".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp,application/pdf,image/*":u.join(","),disabled:v||N})]}),!T&&R==="task"&&t.jsx(f,{sx:{mt:1,fontSize:"0.75rem",color:"text.secondary"},children:"Allowed file types: PDF, JPG, PNG, GIF, WebP, BMP (Max 10MB each)"}),t.jsxs(K,{open:Z,onClose:()=>$(!1),children:[t.jsx(Y,{children:"Delete this file?"}),t.jsxs(X,{children:[t.jsx(j,{onClick:()=>$(!1),children:"Cancel"}),t.jsx(j,{color:"error",variant:"contained",onClick:ve,children:"Delete"})]})]}),t.jsxs(K,{open:Q,onClose:()=>r(!1),children:[t.jsx(Y,{children:"Download this file?"}),t.jsxs(X,{children:[t.jsx(j,{onClick:()=>r(!1),children:"Cancel"}),t.jsx(j,{startIcon:t.jsx(ze,{}),onClick:()=>Le(P),disabled:!P,children:"View"}),t.jsx(j,{variant:"contained",onClick:Se,disabled:!P,children:"Download"})]})]}),t.jsxs(K,{open:x,onClose:()=>{A(!1),ee(null),O(null),V(""),G(""),te(!1)},maxWidth:"md",fullWidth:!0,children:[t.jsx(Y,{children:"File Preview"}),t.jsxs($e,{sx:{minHeight:400,display:"flex",alignItems:"center",justifyContent:"center"},children:[S==="image"&&E&&t.jsx("img",{src:E,alt:"Preview",style:{maxWidth:"100%",maxHeight:500,display:"block",margin:"0 auto"}}),S==="pdf"&&E&&t.jsxs(f,{sx:{width:"100%",height:500,display:"flex",flexDirection:"column"},children:[t.jsxs(f,{sx:{mb:2,display:"flex",gap:1},children:[t.jsx(j,{variant:"outlined",size:"small",onClick:()=>window.open(E,"_blank"),children:"Open in New Tab"}),t.jsx(j,{variant:"outlined",size:"small",onClick:()=>{const s=document.createElement("a");s.href=E,s.download="document.pdf",s.click()},children:"Download"})]}),be?t.jsx(f,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${C.palette.divider}`,borderRadius:1},children:t.jsxs(f,{sx:{textAlign:"center"},children:[t.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"PDF Preview Unavailable"}),t.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The PDF could not be displayed in the preview. Please use the buttons above to view or download the file."})]})}):t.jsx(f,{sx:{flex:1,border:`1px solid ${C.palette.divider}`,borderRadius:1,overflow:"hidden"},children:t.jsx("iframe",{src:`${E}#toolbar=1&navpanes=1&scrollbar=1`,title:"PDF Preview",width:"100%",height:"100%",style:{border:0},onError:()=>{te(!0)},onLoad:()=>{te(!1)}})})]}),S==="text"&&re&&t.jsx(f,{sx:{width:"100%",maxHeight:500,overflow:"auto",bgcolor:"background.default",p:2,borderRadius:2},children:t.jsx("pre",{style:{margin:0,fontFamily:"monospace",fontSize:14},children:re})}),S==="unsupported"&&t.jsxs(f,{sx:{textAlign:"center"},children:[t.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Preview not available for this file type"}),t.jsx(j,{variant:"contained",onClick:()=>{const s=document.createElement("a");s.href=E,s.download="file",s.click()},children:"Download File"})]}),S==="error"&&t.jsxs(f,{sx:{textAlign:"center"},children:[t.jsxs(m,{color:"error",gutterBottom:!0,children:["Error loading file: ",we]}),t.jsx(j,{variant:"outlined",onClick:()=>window.open(E,"_blank"),children:"Try Opening in New Tab"})]})]}),t.jsx(X,{children:t.jsx(j,{onClick:()=>{A(!1),ee(null),O(null),V(""),G("")},children:"Close"})})]})]})};export{nt as C,st as F,Je as a,rt as b,tt as c,Ie as d,Ke as e,Be as f,Ge as g,Qe as h,et as i,Ye as j,Ve as k,qe as l,He as m,We as n,Xe as p,Ze as v};
