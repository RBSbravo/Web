import{j as e,am as oe,b as x,B as c,u as ge,r as s,ba as fe,S as be,F as S,G as je,H as ae,av as u,aA as i,bb as O,I as U,b8 as N,ar as _,b9 as $,bc as we,a6 as j,al as G,ae as H,z as k,Z as V,a7 as p,ap as ne,aw as ye,ax as ve,ay as Pe,m as Se,e as Ce,v as Ie,w as ke,x as Le,y as Ae}from"./mui-DmyK1VYO.js";import{u as De,L as Fe,m as Re,l as L}from"./index-DFirrH-V.js";import{P as Ee}from"./PasswordStrengthIndicator-CcrqGHKl.js";import{u as We}from"./router-ViNET1Ki.js";import"./vendor-Ckhrjn13.js";const Te=()=>{const A=window.location.href,r=window.location.pathname,D=navigator.userAgent;return e.jsxs(oe,{sx:{p:2,m:2,backgroundColor:"#f5f5f5"},children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"Debug Information"}),e.jsx(c,{sx:{mb:1},children:e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"Current URL:"})," ",A]})}),e.jsx(c,{sx:{mb:1},children:e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"Current Path:"})," ",r]})}),e.jsx(c,{sx:{mb:1},children:e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"User Agent:"})," ",D]})}),e.jsx(c,{sx:{mb:1},children:e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"Timestamp:"})," ",new Date().toISOString()]})})]})},Ue=()=>{const A=We(),r=ge(),{login:D,user:F}=De(),[h,Y]=s.useState(0),[R,ie]=s.useState(!1),[C,w]=s.useState(""),[g,E]=s.useState(!1),[y,Z]=s.useState(!1),[v,le]=s.useState({email:"",password:""}),[f,J]=s.useState(!1),[W,m]=s.useState(""),[l,K]=s.useState(!1),[d,T]=s.useState(!1),[q,de]=s.useState([]),[n,Q]=s.useState({firstname:"",lastname:"",email:"",password:"",confirmPassword:"",departmentId:"",role:"department_head"}),[ce,z]=s.useState(!1),[B,me]=s.useState(""),[I,X]=s.useState(!1),[ee,M]=s.useState(""),[te,se]=s.useState("");s.useEffect(()=>{F&&F.isAuthenticated&&localStorage.removeItem("loginTab")},[F]),s.useEffect(()=>{const t=setTimeout(()=>E(!1),800);return()=>clearTimeout(t)},[]),s.useEffect(()=>{h===1&&q.length===0&&(async()=>{try{const a=await L.getDepartments();de(a.data)}catch{}})()},[h,q.length]);const re=t=>{const{name:a,value:o}=t.target;le(P=>({...P,[a]:o})),C&&w("")},ue=async t=>{if(t.preventDefault(),!v.email||!v.password){w("Please fill in all fields");return}E(!0),w(""),Z(!1);try{const a=await L.login(v),{data:o}=a;if(o&&o.token){Z(!0);const P={user:o.user,token:o.token};D(P),setTimeout(()=>{A("/app/dashboard")},1e3)}else throw new Error("Invalid response from server")}catch(a){console.error("Login error:",a);const o=a.response?.data?.error||a.response?.data?.message||"Login failed. Please try again.";w(o),E(!1)}},b=t=>{const{name:a,value:o}=t.target;Q(P=>({...P,[a]:o})),W&&m("")},xe=()=>!n.firstname||!n.lastname||!n.email||!n.password||!n.confirmPassword||!n.departmentId?(m("Please fill in all fields"),!1):n.password!==n.confirmPassword?(m("Passwords do not match"),!1):n.password.length<8?(m("Password must be at least 8 characters long"),!1):!0,pe=async t=>{if(t.preventDefault(),!!xe()){K(!0),m(""),T(!1);try{const a={...n};delete a.confirmPassword,(await L.register(a)).data&&(T(!0),Q({firstname:"",lastname:"",email:"",password:"",confirmPassword:"",departmentId:"",role:"department_head"}),setTimeout(()=>{Y(0),T(!1),m("")},2e3))}catch(a){const o=a.response?.data?.message||"Registration failed. Please try again.";m(o)}finally{K(!1)}}},he=(t,a)=>{Y(a),w(""),m("")};return g&&!C?e.jsx(Fe,{overlay:!0,message:"Loading login..."}):e.jsxs(c,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",background:r.palette.mode==="dark"?r.palette.background.default:`linear-gradient(to right bottom, ${r.palette.primary.light}, ${r.palette.primary.main})`,py:8,position:"relative",overflow:"hidden"},children:[e.jsxs(fe,{component:"main",maxWidth:"sm",children:[e.jsx(Te,{}),e.jsx(be,{direction:"up",in:!0,timeout:800,children:e.jsxs(oe,{elevation:r.palette.mode==="dark"?2:8,sx:{p:{xs:3,sm:6},display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:r.palette.mode==="dark"?r.palette.background.paper:r.palette.common.white,borderRadius:3,position:"relative",backdropFilter:"blur(10px)",border:`1px solid ${r.palette.mode==="dark"?"rgba(255,255,255,0.1)":"rgba(255,255,255,0.2)"}`,boxShadow:r.palette.mode==="dark"?"0 8px 32px rgba(0,0,0,0.3)":"0 8px 32px rgba(0,0,0,0.1)"},children:[e.jsx(S,{in:!0,timeout:1200,children:e.jsx(c,{sx:{width:80,height:80,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",mb:2,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:e.jsx(c,{component:"img",src:Re,alt:"Mito Logo",sx:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"}})})}),e.jsxs(je,{value:h,onChange:he,sx:{mb:3},centered:!0,children:[e.jsx(ae,{label:"Sign In"}),e.jsx(ae,{label:"Sign Up"})]}),h===0&&e.jsxs(c,{sx:{textAlign:"center",mb:2},children:[e.jsx(x,{variant:"h4",color:"primary",sx:{fontWeight:"bold",fontSize:24,mt:.75},children:"Welcome Back"}),e.jsx(x,{variant:"body1",color:"text.secondary",sx:{fontSize:14,mt:.25},children:"Sign in to continue"})]}),h===0&&e.jsxs("form",{onSubmit:ue,style:{width:"100%"},children:[e.jsx(u,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:v.email,onChange:re,disabled:g||y,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(O,{color:"action"})})}}),e.jsx(u,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:R?"text":"password",id:"password",autoComplete:"current-password",value:v.password,onChange:re,disabled:g||y,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx($,{color:"action"})}),endAdornment:e.jsx(i,{position:"end",children:e.jsx(U,{"aria-label":"toggle password visibility",onClick:()=>ie(!R),edge:"end",disabled:g||y,children:R?e.jsx(N,{}):e.jsx(_,{})})})}}),e.jsx(c,{sx:{display:"flex",justifyContent:"flex-end",mt:1,mb:2},children:e.jsx(we,{component:"button",type:"button",variant:"body2",underline:"hover",onClick:t=>{t.preventDefault(),t.stopPropagation(),z(!0)},sx:{border:"none",background:"none",cursor:"pointer",color:r.palette.primary.main,"&:hover":{color:r.palette.primary.dark}},children:"Forgot password?"})}),C&&e.jsx(S,{in:!0,children:e.jsx(j,{severity:"error",sx:{width:"100%",mb:2},icon:e.jsx(G,{}),children:C})}),y&&e.jsx(S,{in:!0,children:e.jsx(j,{severity:"success",sx:{width:"100%",mb:2},icon:e.jsx(H,{}),children:"Login successful! Redirecting..."})}),e.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.2},disabled:g||y,children:g?e.jsx(V,{size:24,color:"inherit"}):"Sign In"})]}),h===1&&e.jsxs("form",{onSubmit:pe,style:{width:"100%"},children:[e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(u,{required:!0,fullWidth:!0,id:"firstname",label:"First Name",name:"firstname",autoComplete:"given-name",value:n.firstname,onChange:b,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(ne,{color:"action"})})}})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(u,{required:!0,fullWidth:!0,id:"lastname",label:"Last Name",name:"lastname",autoComplete:"family-name",value:n.lastname,onChange:b,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(ne,{color:"action"})})}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(u,{required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",value:n.email,onChange:b,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(O,{color:"action"})})}})}),e.jsx(p,{item:!0,xs:12,children:e.jsxs(ye,{fullWidth:!0,required:!0,children:[e.jsx(ve,{id:"department-label",children:"Department"}),e.jsx(Pe,{labelId:"department-label",id:"departmentId",name:"departmentId",value:n.departmentId,label:"Department",onChange:b,disabled:l||d,startAdornment:e.jsx(i,{position:"start",children:e.jsx(Ce,{color:"action"})}),children:q.map(t=>e.jsx(Se,{value:t.id,children:t.name},t.id))})]})}),e.jsxs(p,{item:!0,xs:12,sm:6,children:[e.jsx(u,{required:!0,fullWidth:!0,name:"password",label:"Password",type:f?"text":"password",id:"register-password",autoComplete:"new-password",value:n.password,onChange:b,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx($,{color:"action"})}),endAdornment:e.jsx(i,{position:"end",children:e.jsx(U,{"aria-label":"toggle password visibility",onClick:()=>J(!f),edge:"end",disabled:l||d,children:f?e.jsx(N,{}):e.jsx(_,{})})})}}),e.jsx(Ee,{password:n.password})]}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(u,{required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:f?"text":"password",id:"register-confirm-password",autoComplete:"new-password",value:n.confirmPassword,onChange:b,disabled:l||d,InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx($,{color:"action"})}),endAdornment:e.jsx(i,{position:"end",children:e.jsx(U,{"aria-label":"toggle password visibility",onClick:()=>J(!f),edge:"end",disabled:l||d,children:f?e.jsx(N,{}):e.jsx(_,{})})})}})})]}),W&&e.jsx(S,{in:!0,children:e.jsx(j,{severity:"error",sx:{width:"100%",mt:2},icon:e.jsx(G,{}),children:W})}),d&&e.jsx(S,{in:!0,children:e.jsx(j,{severity:"success",sx:{width:"100%",mt:2},icon:e.jsx(H,{}),children:"Registration successful! You will be redirected to login in a few seconds..."})}),e.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.2},disabled:l||d,children:l?e.jsx(V,{size:24,color:"inherit"}):"Register"})]})]})})]}),e.jsxs(Ie,{open:ce,onClose:()=>z(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:r.palette.mode==="dark"?"0 8px 32px rgba(0,0,0,0.3)":"0 8px 32px rgba(0,0,0,0.1)"}},children:[e.jsx(ke,{sx:{pb:1,fontWeight:600,color:r.palette.text.primary},children:"Forgot Password"}),e.jsxs(Le,{sx:{pt:2},children:[e.jsx(x,{variant:"body2",sx:{mb:3,color:r.palette.text.secondary},children:"Enter your email address and we'll send you a link to reset your password."}),e.jsx(u,{label:"Email Address",type:"email",fullWidth:!0,margin:"normal",value:B,onChange:t=>me(t.target.value),disabled:I,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},InputProps:{startAdornment:e.jsx(i,{position:"start",children:e.jsx(O,{color:"action"})})}}),ee&&e.jsx(j,{severity:"error",sx:{mt:2},icon:e.jsx(G,{}),children:ee}),te&&e.jsx(j,{severity:"success",sx:{mt:2},icon:e.jsx(H,{}),children:te})]}),e.jsxs(Ae,{sx:{px:3,pb:3},children:[e.jsx(k,{onClick:()=>z(!1),disabled:I,sx:{color:r.palette.text.secondary,"&:hover":{color:r.palette.text.primary}},children:"Cancel"}),e.jsx(k,{onClick:async()=>{if(M(""),se(""),!B){M("Please enter your email address.");return}X(!0);try{await L.forgotPassword({email:B}),se("If an account with that email exists, a reset link has been sent.")}catch(t){M(t.response?.data?.error||"Failed to send reset email.")}finally{X(!1)}},variant:"contained",color:"primary",disabled:I,size:"small",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,minWidth:"120px",height:"36px"},children:I?e.jsx(V,{size:20,color:"inherit"}):"Send Reset Link"})]})]})]})};export{Ue as default};
