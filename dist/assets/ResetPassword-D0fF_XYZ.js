import{r as t,j as s,bd as y,am as I,a6 as h,B as n,F as A,a8 as q,a9 as F,ae as k,b as o,bg as H,av as T,aA as L,I as W,b9 as E,ar as Y,al as O,z as J,Z as M,J as Q}from"./mui-BfuGcMOQ.js";import{l as U}from"./index-C96xgESD.js";import{P as Z,R as _,r as f,h as $,p as G}from"./PasswordStrengthIndicator-BB1K_etI.js";import{a as K}from"./router-DwSTIDLU.js";import"./vendor-Ckhrjn13.js";function X(){return new URLSearchParams(K().search)}const os=()=>{const j=X().get("token"),[a,D]=t.useState(""),[u,V]=t.useState(""),[d,b]=t.useState(!1),[P,l]=t.useState(""),[p,v]=t.useState(""),[m,R]=t.useState({new:!1,confirm:!1}),[x,C]=t.useState({}),[i,z]=t.useState(!1),[g,w]=t.useState(null);if(!j)return s.jsx(y,{maxWidth:"sm",sx:{mt:8},children:s.jsx(I,{sx:{p:4,borderRadius:3,textAlign:"center"},children:s.jsx(h,{severity:"error",children:"Invalid or missing reset token."})})});const B=()=>{const e={};if(!a)e.newPassword="New password is required";else{const r=G.validate(a);r.isValid||(e.newPassword=r.errors[0])}return u?a!==u&&(e.confirmPassword="Passwords do not match"):e.confirmPassword="Please confirm your new password",C(e),Object.keys(e).length===0},S=(e,r)=>{e==="newPassword"?D(r):e==="confirmPassword"&&V(r),x[e]&&C(c=>({...c,[e]:""})),l("")},N=async e=>{if(e.preventDefault(),!f.canRetry("resetPassword")){const r=f.getRemainingRetryTime("resetPassword");l(`Please wait ${Math.ceil(r/1e3)} seconds before trying again.`);return}if(l(""),v(""),w(null),!!B()){b(!0);try{await U.resetPassword({token:j,password:a}),v("Password reset successful! You can now log in with your new password."),z(!0),f.clearRetryTimer("resetPassword")}catch(r){const c=$(r);c.type==="rate_limit"&&(w(r.rateLimitData||{error:r.message}),f.setRetryTimer("resetPassword",c.retryTime)),l(c.message)}finally{b(!1)}}};return i&&p?s.jsx(n,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:s.jsx(y,{maxWidth:"sm",children:s.jsx(A,{in:!0,timeout:800,children:s.jsx(q,{sx:{borderRadius:3,boxShadow:3,textAlign:"center",overflow:"visible"},children:s.jsxs(F,{sx:{p:{xs:4,sm:6}},children:[s.jsx(n,{sx:{display:"flex",justifyContent:"center",mb:3},children:s.jsx(k,{sx:{fontSize:64,color:"success.main"}})}),s.jsx(o,{variant:"h4",sx:{fontWeight:700,mb:2,color:"success.main"},children:"Password Reset Successful!"}),s.jsx(o,{variant:"body1",sx:{mb:3,color:"text.secondary"},children:"Your password has been successfully updated. You can now log in with your new password."}),s.jsxs(h,{severity:"success",sx:{mb:3,textAlign:"left"},children:[s.jsx(o,{variant:"body2",children:s.jsx("strong",{children:"What's next?"})}),s.jsxs(o,{variant:"body2",sx:{mt:1},children:["• Your password has been securely updated",s.jsx("br",{}),"• You can now log in with your new password",s.jsx("br",{}),"• The reset link is no longer valid for security",s.jsx("br",{}),"• You can navigate to the login page when ready"]})]})]})})})})}):s.jsx(n,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:s.jsx(y,{maxWidth:"sm",children:s.jsx(A,{in:!0,timeout:800,children:s.jsxs(I,{sx:{p:{xs:3,sm:6},borderRadius:3,boxShadow:3},children:[s.jsxs(n,{sx:{textAlign:"center",mb:4},children:[s.jsx(n,{sx:{display:"flex",justifyContent:"center",mb:2},children:s.jsx(H,{sx:{fontSize:48,color:"primary.main"}})}),s.jsx(o,{variant:"h5",sx:{fontWeight:700,mb:1},children:"Reset Your Password"}),s.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:"Create a strong password to secure your account"})]}),s.jsxs("form",{onSubmit:N,children:[s.jsx(T,{label:"New Password",type:m.new?"text":"password",fullWidth:!0,margin:"normal",value:a,onChange:e=>S("newPassword",e.target.value),disabled:d||i,error:!!x.newPassword,helperText:x.newPassword,InputProps:{endAdornment:s.jsx(L,{position:"end",children:s.jsx(W,{"aria-label":"toggle new password visibility",onClick:()=>R(e=>({...e,new:!e.new})),edge:"end",disabled:d||i,children:m.new?s.jsx(E,{}):s.jsx(Y,{})})})}}),a&&s.jsx(n,{sx:{mt:2,mb:2},children:s.jsx(Z,{password:a,showSuggestions:!0,defaultExpanded:!1})}),s.jsx(T,{label:"Confirm New Password",type:m.confirm?"text":"password",fullWidth:!0,margin:"normal",value:u,onChange:e=>S("confirmPassword",e.target.value),disabled:d||i,error:!!x.confirmPassword,helperText:x.confirmPassword,InputProps:{endAdornment:s.jsx(L,{position:"end",children:s.jsx(W,{"aria-label":"toggle confirm password visibility",onClick:()=>R(e=>({...e,confirm:!e.confirm})),edge:"end",disabled:d||i,children:m.confirm?s.jsx(E,{}):s.jsx(Y,{})})})}}),s.jsx(_,{isOpen:!!g,onClose:()=>w(null),rateLimitData:g,endpoint:"resetPassword",onRetry:()=>{w(null),l("")}}),P&&!g&&s.jsx(h,{severity:"error",sx:{mt:2},icon:s.jsx(O,{}),children:P}),p&&!i&&s.jsx(h,{severity:"success",sx:{mt:2},icon:s.jsx(k,{}),children:p}),s.jsx(J,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3,py:1.5},disabled:d||i||!a||!u,children:d?s.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(M,{size:20,color:"inherit"}),s.jsx(o,{variant:"body2",children:"Resetting Password..."})]}):"Reset Password"})]}),s.jsx(Q,{sx:{my:3}}),s.jsx(n,{sx:{textAlign:"center"},children:s.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:"Remember your password? You can log in anytime using the login page."})})]})})})})};export{os as default};
